
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Part3/">
      
      
        <link rel="next" href="../Part5/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Part4: Global Illumination - CS184 Assignments</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part4-global-illumination" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CS184 Assignments" class="md-header__button md-logo" aria-label="CS184 Assignments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.82 16.342 5.692-3.287A.98.98 0 0 0 24 12.21V5.635a.98.98 0 0 0-.488-.846l-5.693-3.286a.98.98 0 0 0-.977 0L11.15 4.789a.98.98 0 0 0-.489.846v11.747L6.67 19.686l-3.992-2.304v-4.61l3.992-2.304 2.633 1.52V8.896L7.158 7.658a.98.98 0 0 0-.977 0L.488 10.945a.98.98 0 0 0-.488.846v6.573a.98.98 0 0 0 .488.847l5.693 3.286a.981.981 0 0 0 .977 0l5.692-3.286a.98.98 0 0 0 .489-.846V6.618l.072-.041 3.92-2.263 3.99 2.305v4.609l-3.99 2.304-2.63-1.517v3.092l2.14 1.236a.981.981 0 0 0 .978 0v-.001Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CS184 Assignments
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part4: Global Illumination
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Homework1/Overview/" class="md-tabs__link">
          
  
  Homework1

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Homework2/Overview/" class="md-tabs__link">
          
  
  Homework2

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Overview/" class="md-tabs__link">
          
  
  Homework3

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Homework4/Overview/" class="md-tabs__link">
          
  
  Homework4

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CS184 Assignments" class="md-nav__button md-logo" aria-label="CS184 Assignments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.82 16.342 5.692-3.287A.98.98 0 0 0 24 12.21V5.635a.98.98 0 0 0-.488-.846l-5.693-3.286a.98.98 0 0 0-.977 0L11.15 4.789a.98.98 0 0 0-.489.846v11.747L6.67 19.686l-3.992-2.304v-4.61l3.992-2.304 2.633 1.52V8.896L7.158 7.658a.98.98 0 0 0-.977 0L.488 10.945a.98.98 0 0 0-.488.846v6.573a.98.98 0 0 0 .488.847l5.693 3.286a.981.981 0 0 0 .977 0l5.692-3.286a.98.98 0 0 0 .489-.846V6.618l.072-.041 3.92-2.263 3.99 2.305v4.609l-3.99 2.304-2.63-1.517v3.092l2.14 1.236a.981.981 0 0 0 .978 0v-.001Z"/></svg>

    </a>
    CS184 Assignments
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Homework1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework 1: Rasterizer Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Task1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 1: Drawing Single-Color Triangles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Task2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 2: Antialiasing by Supersampling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Task3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 3: Transforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Task4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 4: Barycentric coordinates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Task5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 5: "Pixel sampling" for texture mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework1/Task6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 6: "Level sampling" with mipmaps for texture mapping
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Homework2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework2: Meshedit Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Section1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Section1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Section1/Part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1: Bezier Curves with 1D de Casteljau Subdivision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Section1/Part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part2: Bezier Surfaces with Separable 1D de Casteljau
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Section2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Section2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Section2/Part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3: Area-Weighted Vertex Normals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Section2/Part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part2: Bezier Surfaces with Separable 1D de Casteljau
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Section2/Part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5: Edge Split
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework2/Section2/Part6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6: Loop Subdivision for Mesh Upsampling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Homework3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Homework3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework3: Pathtracer Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part1: Ray Generation and Scene Intersection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2: Bounding Volume Hierarchy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part3: Direct Illumination
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Part4: Global Illumination
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Part4: Global Illumination
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sampling-with-diffuse-bsdf" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling with Diffuse BSDF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sampling with Diffuse BSDF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-illumination-with-up-to-n-bounces-of-light" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination with up to N Bounces of Light
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Global Illumination with up to N Bounces of Light">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methodology_1" class="md-nav__link">
    <span class="md-ellipsis">
      Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at_least_one_bounce_radiance" class="md-nav__link">
    <span class="md-ellipsis">
      at_least_one_bounce_radiance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#est_radiance_global_illumination" class="md-nav__link">
    <span class="md-ellipsis">
      est_radiance_global_illumination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-illumination-with-russian-roulette" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination with Russian Roulette
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Global Illumination with Russian Roulette">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methodology_2" class="md-nav__link">
    <span class="md-ellipsis">
      Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#here-are-some-direct-and-indirect-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Here are some direct and indirect illumination.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direct" class="md-nav__link">
    <span class="md-ellipsis">
      Direct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indirectonly-sum-m2345" class="md-nav__link">
    <span class="md-ellipsis">
      Indirect(only sum m=2,3,4,5)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare" class="md-nav__link">
    <span class="md-ellipsis">
      Compare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-are-the-results-for-rendering-the-mth-bounce-of-light-with-max_ray_depth-set-to-0-1-2-3-4-and-5-and-isaccumbouncesfalse-for-cbbunnydae" class="md-nav__link">
    <span class="md-ellipsis">
      Here are the results for rendering the mth bounce of light with max_ray_depth set to 0, 1, 2, 3, 4, and 5, and isAccumBounces=false, for CBbunny.dae
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m0" class="md-nav__link">
    <span class="md-ellipsis">
      m=0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m1" class="md-nav__link">
    <span class="md-ellipsis">
      m=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2" class="md-nav__link">
    <span class="md-ellipsis">
      m=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3" class="md-nav__link">
    <span class="md-ellipsis">
      m=3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4" class="md-nav__link">
    <span class="md-ellipsis">
      m=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m5" class="md-nav__link">
    <span class="md-ellipsis">
      m=5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason" class="md-nav__link">
    <span class="md-ellipsis">
      Reason
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-are-the-results-for-rendered-views-with-max_ray_depth-set-to-0-1-2-3-4-and-5-for-cbbunnydae" class="md-nav__link">
    <span class="md-ellipsis">
      Here are the results for rendered views with max_ray_depth set to 0, 1, 2, 3, 4, and 5 for CBbunny.dae
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m0_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m1_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m5_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare_1" class="md-nav__link">
    <span class="md-ellipsis">
      Compare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-are-the-results-for-outputing-the-russian-roulette-rendering-with-max_ray_depth-set-to-0-1-2-3-4-and-100-for-cbbunnydae" class="md-nav__link">
    <span class="md-ellipsis">
      Here are the results for outputing the Russian Roulette rendering with max_ray_depth set to 0, 1, 2, 3, 4, and 100 for CBbunny.dae
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m0_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m1_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m100" class="md-nav__link">
    <span class="md-ellipsis">
      m=100
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-following-are-rendering-pictures-of-the-same-scene-with-different-sampling-rates" class="md-nav__link">
    <span class="md-ellipsis">
      The following are rendering pictures of the same scene with different sampling rates.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate1" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate2" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate4" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate8" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate16" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate64" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=64
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate1024" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=1024
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare_2" class="md-nav__link">
    <span class="md-ellipsis">
      Compare
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part5: Adaptive Sampling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Homework4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework4/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework4: Clothsim Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework4/Part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1: Masses and springs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework4/Part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2: Simulation via numerical integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework4/Part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3: Handling collisions with other objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework4/Part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part4: Handling self-collisions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Homework4/Part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part5: Shaders
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sampling-with-diffuse-bsdf" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling with Diffuse BSDF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sampling with Diffuse BSDF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-illumination-with-up-to-n-bounces-of-light" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination with up to N Bounces of Light
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Global Illumination with up to N Bounces of Light">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methodology_1" class="md-nav__link">
    <span class="md-ellipsis">
      Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#at_least_one_bounce_radiance" class="md-nav__link">
    <span class="md-ellipsis">
      at_least_one_bounce_radiance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#est_radiance_global_illumination" class="md-nav__link">
    <span class="md-ellipsis">
      est_radiance_global_illumination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-illumination-with-russian-roulette" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination with Russian Roulette
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Global Illumination with Russian Roulette">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methodology_2" class="md-nav__link">
    <span class="md-ellipsis">
      Methodology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#here-are-some-direct-and-indirect-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Here are some direct and indirect illumination.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#direct" class="md-nav__link">
    <span class="md-ellipsis">
      Direct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indirectonly-sum-m2345" class="md-nav__link">
    <span class="md-ellipsis">
      Indirect(only sum m=2,3,4,5)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare" class="md-nav__link">
    <span class="md-ellipsis">
      Compare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-are-the-results-for-rendering-the-mth-bounce-of-light-with-max_ray_depth-set-to-0-1-2-3-4-and-5-and-isaccumbouncesfalse-for-cbbunnydae" class="md-nav__link">
    <span class="md-ellipsis">
      Here are the results for rendering the mth bounce of light with max_ray_depth set to 0, 1, 2, 3, 4, and 5, and isAccumBounces=false, for CBbunny.dae
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m0" class="md-nav__link">
    <span class="md-ellipsis">
      m=0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m1" class="md-nav__link">
    <span class="md-ellipsis">
      m=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2" class="md-nav__link">
    <span class="md-ellipsis">
      m=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3" class="md-nav__link">
    <span class="md-ellipsis">
      m=3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4" class="md-nav__link">
    <span class="md-ellipsis">
      m=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m5" class="md-nav__link">
    <span class="md-ellipsis">
      m=5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason" class="md-nav__link">
    <span class="md-ellipsis">
      Reason
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-are-the-results-for-rendered-views-with-max_ray_depth-set-to-0-1-2-3-4-and-5-for-cbbunnydae" class="md-nav__link">
    <span class="md-ellipsis">
      Here are the results for rendered views with max_ray_depth set to 0, 1, 2, 3, 4, and 5 for CBbunny.dae
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m0_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m1_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m5_1" class="md-nav__link">
    <span class="md-ellipsis">
      m=5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare_1" class="md-nav__link">
    <span class="md-ellipsis">
      Compare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-are-the-results-for-outputing-the-russian-roulette-rendering-with-max_ray_depth-set-to-0-1-2-3-4-and-100-for-cbbunnydae" class="md-nav__link">
    <span class="md-ellipsis">
      Here are the results for outputing the Russian Roulette rendering with max_ray_depth set to 0, 1, 2, 3, 4, and 100 for CBbunny.dae
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m0_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m1_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4_2" class="md-nav__link">
    <span class="md-ellipsis">
      m=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m100" class="md-nav__link">
    <span class="md-ellipsis">
      m=100
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-following-are-rendering-pictures-of-the-same-scene-with-different-sampling-rates" class="md-nav__link">
    <span class="md-ellipsis">
      The following are rendering pictures of the same scene with different sampling rates.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate1" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate2" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate4" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate8" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate16" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate64" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=64
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-per-pixel-rate1024" class="md-nav__link">
    <span class="md-ellipsis">
      sample-per-pixel rate=1024
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare_2" class="md-nav__link">
    <span class="md-ellipsis">
      Compare
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                


    <a href="../../print_page/" title="Print Site" class="md-content__button md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 3H6v4h12m1 5a1 1 0 0 1-1-1 1 1 0 0 1 1-1 1 1 0 0 1 1 1 1 1 0 0 1-1 1m-3 7H8v-5h8m3-6H5a3 3 0 0 0-3 3v6h4v4h12v-4h4v-6a3 3 0 0 0-3-3Z"/></svg>
    </a>



                  


<h1 id="part4-global-illumination">Part4: Global Illumination</h1>
<h2 id="sampling-with-diffuse-bsdf">Sampling with Diffuse BSDF</h2>
<h3 id="methodology">Methodology</h3>
<p>Using <span class="arithmatex">\(sampler.get_sample(pdf)\)</span>, a random sample direction is obtained from the cosine-weighted hemisphere distribution. Next, the obtained sample direction <span class="arithmatex">\(wi\)</span> is used as the incoming light direction, and the <span class="arithmatex">\(f\)</span> function is called to compute the BSDF evaluation of the diffuse material at <span class="arithmatex">\((wo, *wi)\)</span>.</p>
<h3 id="implementation">Implementation</h3>
<p>The function <span class="arithmatex">\(f\)</span> is defined in Part 3.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">  </span><span class="o">*</span><span class="n">wi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampler</span><span class="p">.</span><span class="n">get_sample</span><span class="p">(</span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">wo</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">wi</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="global-illumination-with-up-to-n-bounces-of-light">Global Illumination with up to N Bounces of Light</h2>
<h3 id="methodology_1">Methodology</h3>
<p>The following is the rendering equation.</p>
<p><a class="glightbox" href="../../images/hw3/part4/example1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rendering equation" src="../../images/hw3/part4/example1.png" /></a></p>
<p>Simplify:</p>
<p><a class="glightbox" href="../../images/hw3/part4/example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rendering equation simplify" src="../../images/hw3/part4/example2.png" /></a></p>
<p><a class="glightbox" href="../../images/hw3/part4/example3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rendering equation K" src="../../images/hw3/part4/example3.png" /></a></p>
<p>Solve the equation:</p>
<p><a class="glightbox" href="../../images/hw3/part4/example4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="solve" src="../../images/hw3/part4/example4.png" /></a></p>
<h3 id="implementation_1">Implementation</h3>
<h4 id="at_least_one_bounce_radiance">at_least_one_bounce_radiance</h4>
<p>If <span class="arithmatex">\(r.depth == max_ray_depth - 1\)</span>, this means the maximum depth has been reached. L_out just needs to add the value of this diffuse reflection, which is the function <span class="arithmatex">\(one_bounce_radiance\)</span>.</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAccumBounces</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
Check if the maximum depth is reached. If true, return the L_out. Otherwise, continue operating the rest of the code.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>Now, calculate the radiance from extra bounces. First, obtain a ray from the hit point to the sample direction. </p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">pdf</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_incoming_light</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="n">Ray</span><span class="w"> </span><span class="n">ray</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="n">Intersection</span><span class="w"> </span><span class="n">isect_light</span><span class="p">;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="c1">// sample the next direction</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">sample_f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="c1">// transform the sample direction to object space</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="n">wi_sample_w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="c1">// generate a ray from the hit point to the sample direction</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">.</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="n">norm</span><span class="p">();</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">  </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">);</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span>
</span></code></pre></div>
<p>Next, recurse this equation until reaching max_ray_depth(this was checked before).</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect_light</span><span class="p">))</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="c1">// calculate the radiance from the extra bounces</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="w">    </span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h4 id="est_radiance_global_illumination">est_radiance_global_illumination</h4>
<p>Just need to accumulate the result each time.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<h2 id="global-illumination-with-russian-roulette">Global Illumination with Russian Roulette</h2>
<h3 id="methodology_2">Methodology</h3>
<p>Now we have set a probability between 0.3 and 0.4 (implemented as 0.35) as the probability for early termination. Due to the influence of probability, we need to normalize the result. The core idea is shown in the diagram below.</p>
<p><a class="glightbox" href="../../images/hw3/part4/example5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rus" src="../../images/hw3/part4/example5.png" /></a></p>
<h3 id="implementation_2">Implementation</h3>
<p>We just need to make some small adjustments to the function <span class="arithmatex">\(at_least_one_bounce_radiance\)</span>. The adjusted code is as follows.</p>
<p>First, set the possibility.</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">possibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.35</span><span class="p">;</span>
</span></code></pre></div>
Next, check whether to terminate early.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">coin_flip</span><span class="p">(</span><span class="n">possibility</span><span class="p">)){</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="c1">//Here, a lot of code has been omitted.</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p>At last, normalize. Note that the code below has an additional parameter <span class="arithmatex">\(probability\)</span>.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">  </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">possibility</span><span class="p">;</span>
</span></code></pre></div>
<p>Finally, here is the overall code. This is very similar to the previous section, so you don't need to pay too much attention to these codes.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAccumBounces</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="c1">// check if the maximum depth is reached</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">  </span><span class="c1">// if not, calculate the radiance from extra bounces</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">pdf</span><span class="p">;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_incoming_light</span><span class="p">;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">  </span><span class="n">Ray</span><span class="w"> </span><span class="n">ray</span><span class="p">;</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">  </span><span class="n">Intersection</span><span class="w"> </span><span class="n">isect_light</span><span class="p">;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">  </span><span class="c1">// sample the next direction</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">  </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">sample_f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">  </span><span class="c1">// transform the sample direction to object space</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">  </span><span class="n">wi_sample_w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">;</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">  </span><span class="c1">// generate a ray from the hit point to the sample direction</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">norm</span><span class="p">();</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">  </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">);</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">coin_flip</span><span class="p">(</span><span class="n">possibility</span><span class="p">))</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">    </span><span class="c1">// calculate the radiance from the extra bounces</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">    </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">possibility</span><span class="p">;</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="results">Results</h2>
<h3 id="here-are-some-direct-and-indirect-illumination">Here are some direct and indirect illumination.</h3>
<h3 id="direct">Direct</h3>
<p><a class="glightbox" href="../../images/hw3/part4/direct_example1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/direct_example1.png" /></a></p>
<p><a class="glightbox" href="../../images/hw3/part4/direct_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/direct_example2.png" /></a></p>
<p><a class="glightbox" href="../../images/hw3/part4/direct_example3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/direct_example3.png" /></a></p>
<h3 id="indirectonly-sum-m2345">Indirect(only sum m=2,3,4,5)</h3>
<p><a class="glightbox" href="../../images/hw3/part4/indirect_example1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/indirect_example1.png" /></a></p>
<p><a class="glightbox" href="../../images/hw3/part4/indirect_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/indirect_example2.png" /></a></p>
<p><a class="glightbox" href="../../images/hw3/part4/indirect_example3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/indirect_example3.png" /></a></p>
<h3 id="compare">Compare</h3>
<p><a class="glightbox" href="../../images/hw3/part4/direct_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/direct_example2.png" /></a></p>
<p><a class="glightbox" href="../../images/hw3/part4/indirect_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/indirect_example2.png" /></a></p>
<p>We can find that the direct illumination is more smooth and lighter than the indirect one.</p>
<h3 id="here-are-the-results-for-rendering-the-mth-bounce-of-light-with-max_ray_depth-set-to-0-1-2-3-4-and-5-and-isaccumbouncesfalse-for-cbbunnydae">Here are the results for rendering the mth bounce of light with max_ray_depth set to 0, 1, 2, 3, 4, and 5, and isAccumBounces=false, for CBbunny.dae</h3>
<h3 id="m0">m=0</h3>
<p><a class="glightbox" href="../../images/hw3/part4/notsum_m%3D00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/notsum_m%3D00.png" /></a></p>
<h3 id="m1">m=1</h3>
<p><a class="glightbox" href="../../images/hw3/part4/notsum_m%3D10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=1" src="../../images/hw3/part4/notsum_m%3D10.png" /></a></p>
<h3 id="m2">m=2</h3>
<p><a class="glightbox" href="../../images/hw3/part4/notsum_m%3D20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=2" src="../../images/hw3/part4/notsum_m%3D20.png" /></a></p>
<h3 id="m3">m=3</h3>
<p><a class="glightbox" href="../../images/hw3/part4/notsum_m%3D30.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=3" src="../../images/hw3/part4/notsum_m%3D30.png" /></a></p>
<h3 id="m4">m=4</h3>
<p><a class="glightbox" href="../../images/hw3/part4/notsum_m%3D40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=4" src="../../images/hw3/part4/notsum_m%3D40.png" /></a></p>
<h3 id="m5">m=5</h3>
<p><a class="glightbox" href="../../images/hw3/part4/notsum_m%3D50.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=5" src="../../images/hw3/part4/notsum_m%3D50.png" /></a></p>
<h3 id="reason">Reason</h3>
<p>This is because each time the light reflects off a surface, some of its energy is absorbed or scattered, leading to an overall decrease in brightness with each subsequent bounce. As the number of reflections increases for the second and third bounces of light, the intensity of light diminishes, resulting in the images becoming progressively darker. </p>
<p>The main reason it improves the quality of rendered images is that multiple reflections simulate the paths of real light in the physical world, making the images more closely resemble what we see in reality. This enhances the realism of the images. For example, multiple reflections result in more accurate and realistic shadows, which contribute to a more lifelike appearance.</p>
<h3 id="here-are-the-results-for-rendered-views-with-max_ray_depth-set-to-0-1-2-3-4-and-5-for-cbbunnydae">Here are the results for rendered views with max_ray_depth set to 0, 1, 2, 3, 4, and 5  for CBbunny.dae</h3>
<h3 id="m0_1">m=0</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sum_m%3D00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sum_m%3D00.png" /></a></p>
<h3 id="m1_1">m=1</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sum_m%3D10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=1" src="../../images/hw3/part4/sum_m%3D10.png" /></a></p>
<h3 id="m2_1">m=2</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sum_m%3D20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=2" src="../../images/hw3/part4/sum_m%3D20.png" /></a></p>
<h3 id="m3_1">m=3</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sum_m%3D30.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=3" src="../../images/hw3/part4/sum_m%3D30.png" /></a></p>
<h3 id="m4_1">m=4</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sum_m%3D40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=4" src="../../images/hw3/part4/sum_m%3D40.png" /></a></p>
<h3 id="m5_1">m=5</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sum_m%3D50.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=5" src="../../images/hw3/part4/sum_m%3D50.png" /></a></p>
<h3 id="compare_1">Compare</h3>
<p>We can find that as m increases, the picture becomes brighter and brighter.</p>
<h3 id="here-are-the-results-for-outputing-the-russian-roulette-rendering-with-max_ray_depth-set-to-0-1-2-3-4-and-100-for-cbbunnydae">Here are the results for outputing the Russian Roulette rendering with max_ray_depth set to 0, 1, 2, 3, 4, and 100  for CBbunny.dae</h3>
<h3 id="m0_2">m=0</h3>
<p><a class="glightbox" href="../../images/hw3/part4/rus_sum_m%3D00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/rus_sum_m%3D00.png" /></a></p>
<h3 id="m1_2">m=1</h3>
<p><a class="glightbox" href="../../images/hw3/part4/rus_sum_m%3D10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=1" src="../../images/hw3/part4/rus_sum_m%3D10.png" /></a></p>
<h3 id="m2_2">m=2</h3>
<p><a class="glightbox" href="../../images/hw3/part4/rus_sum_m%3D20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=2" src="../../images/hw3/part4/rus_sum_m%3D20.png" /></a></p>
<h3 id="m3_2">m=3</h3>
<p><a class="glightbox" href="../../images/hw3/part4/rus_sum_m%3D30.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=3" src="../../images/hw3/part4/rus_sum_m%3D30.png" /></a></p>
<h3 id="m4_2">m=4</h3>
<p><a class="glightbox" href="../../images/hw3/part4/rus_sum_m%3D40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=4" src="../../images/hw3/part4/rus_sum_m%3D40.png" /></a></p>
<h3 id="m100">m=100</h3>
<p><a class="glightbox" href="../../images/hw3/part4/rus_sum_m%3D1000.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=100" src="../../images/hw3/part4/rus_sum_m%3D1000.png" /></a></p>
<h3 id="the-following-are-rendering-pictures-of-the-same-scene-with-different-sampling-rates">The following are rendering pictures of the same scene with different sampling rates.</h3>
<h3 id="sample-per-pixel-rate1">sample-per-pixel rate=1</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample1.png" /></a></p>
<h3 id="sample-per-pixel-rate2">sample-per-pixel rate=2</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample2.png" /></a></p>
<h3 id="sample-per-pixel-rate4">sample-per-pixel rate=4</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample4.png" /></a></p>
<h3 id="sample-per-pixel-rate8">sample-per-pixel rate=8</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample8.png" /></a></p>
<h3 id="sample-per-pixel-rate16">sample-per-pixel rate=16</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample16.png" /></a></p>
<h3 id="sample-per-pixel-rate64">sample-per-pixel rate=64</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample64.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample64.png" /></a></p>
<h3 id="sample-per-pixel-rate1024">sample-per-pixel rate=1024</h3>
<p><a class="glightbox" href="../../images/hw3/part4/sample12.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../../images/hw3/part4/sample12.png" /></a></p>
<h3 id="compare_2">Compare</h3>
<p>As the sample-per-pixel rate increases, the image will become smoother and smoother. At the same time, the brightness will also increase slightly.</p>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>