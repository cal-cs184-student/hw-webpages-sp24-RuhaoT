
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Print Site - CS184 Assignments</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CS184 Assignments" class="md-header__button md-logo" aria-label="CS184 Assignments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.82 16.342 5.692-3.287A.98.98 0 0 0 24 12.21V5.635a.98.98 0 0 0-.488-.846l-5.693-3.286a.98.98 0 0 0-.977 0L11.15 4.789a.98.98 0 0 0-.489.846v11.747L6.67 19.686l-3.992-2.304v-4.61l3.992-2.304 2.633 1.52V8.896L7.158 7.658a.98.98 0 0 0-.977 0L.488 10.945a.98.98 0 0 0-.488.846v6.573a.98.98 0 0 0 .488.847l5.693 3.286a.981.981 0 0 0 .977 0l5.692-3.286a.98.98 0 0 0 .489-.846V6.618l.072-.041 3.92-2.263 3.99 2.305v4.609l-3.99 2.304-2.63-1.517v3.092l2.14 1.236a.981.981 0 0 0 .978 0v-.001Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CS184 Assignments
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Homework1/Overview/" class="md-tabs__link">
          
  
  Homework1

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Homework2/Overview/" class="md-tabs__link">
          
  
  Homework2

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Homework3/Overview/" class="md-tabs__link">
          
  
  Homework3

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Homework4/Overview/" class="md-tabs__link">
          
  
  Homework4

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CS184 Assignments" class="md-nav__button md-logo" aria-label="CS184 Assignments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.82 16.342 5.692-3.287A.98.98 0 0 0 24 12.21V5.635a.98.98 0 0 0-.488-.846l-5.693-3.286a.98.98 0 0 0-.977 0L11.15 4.789a.98.98 0 0 0-.489.846v11.747L6.67 19.686l-3.992-2.304v-4.61l3.992-2.304 2.633 1.52V8.896L7.158 7.658a.98.98 0 0 0-.977 0L.488 10.945a.98.98 0 0 0-.488.846v6.573a.98.98 0 0 0 .488.847l5.693 3.286a.981.981 0 0 0 .977 0l5.692-3.286a.98.98 0 0 0 .489-.846V6.618l.072-.041 3.92-2.263 3.99 2.305v4.609l-3.99 2.304-2.63-1.517v3.092l2.14 1.236a.981.981 0 0 0 .978 0v-.001Z"/></svg>

    </a>
    CS184 Assignments
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Homework1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework 1: Rasterizer Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Task1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 1: Drawing Single-Color Triangles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Task2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 2: Antialiasing by Supersampling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Task3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 3: Transforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Task4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 4: Barycentric coordinates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Task5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 5: "Pixel sampling" for texture mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework1/Task6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task 6: "Level sampling" with mipmaps for texture mapping
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Homework2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework2: Meshedit Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Section1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Section1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Section1/Part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1: Bezier Curves with 1D de Casteljau Subdivision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Section1/Part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part2: Bezier Surfaces with Separable 1D de Casteljau
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Section2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Section2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Section2/Part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3: Area-Weighted Vertex Normals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Section2/Part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part2: Bezier Surfaces with Separable 1D de Casteljau
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Section2/Part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5: Edge Split
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework2/Section2/Part6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6: Loop Subdivision for Mesh Upsampling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Homework3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework3/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework3: Pathtracer Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework3/Part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part1: Ray Generation and Scene Intersection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework3/Part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2: Bounding Volume Hierarchy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework3/Part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part3: Direct Illumination
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework3/Part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part4: Global Illumination
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework3/Part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part5: Adaptive Sampling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Homework4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework4/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homework4: Clothsim Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework4/Part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1: Masses and springs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework4/Part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2: Simulation via numerical integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework4/Part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3: Handling collisions with other objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework4/Part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part4: Handling self-collisions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Homework4/Part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part5: Shaders
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#" class="md-nav__link">
    <span class="md-ellipsis">
      1. Home
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-homework1" class="md-nav__link">
    <span class="md-ellipsis">
      I. Homework1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="I. Homework1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#homework1-overview" class="md-nav__link">
    <span class="md-ellipsis">
      2. Homework 1: Rasterizer Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework1-task1" class="md-nav__link">
    <span class="md-ellipsis">
      3. Task 1: Drawing Single-Color Triangles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework1-task2" class="md-nav__link">
    <span class="md-ellipsis">
      4. Task 2: Antialiasing by Supersampling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework1-task3" class="md-nav__link">
    <span class="md-ellipsis">
      5. Task 3: Transforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework1-task4" class="md-nav__link">
    <span class="md-ellipsis">
      6. Task 4: Barycentric coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework1-task5" class="md-nav__link">
    <span class="md-ellipsis">
      7. Task 5: "Pixel sampling" for texture mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework1-task6" class="md-nav__link">
    <span class="md-ellipsis">
      8. Task 6: "Level sampling" with mipmaps for texture mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-homework2" class="md-nav__link">
    <span class="md-ellipsis">
      II. Homework2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="II. Homework2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#homework2-overview" class="md-nav__link">
    <span class="md-ellipsis">
      9. Homework2: Meshedit Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-homework3" class="md-nav__link">
    <span class="md-ellipsis">
      III. Homework3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="III. Homework3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#homework3-overview" class="md-nav__link">
    <span class="md-ellipsis">
      10. Homework3: Pathtracer Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework3-part1" class="md-nav__link">
    <span class="md-ellipsis">
      11. Part1: Ray Generation and Scene Intersection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework3-part2" class="md-nav__link">
    <span class="md-ellipsis">
      12. Part 2: Bounding Volume Hierarchy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework3-part3" class="md-nav__link">
    <span class="md-ellipsis">
      13. Part3: Direct Illumination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework3-part4" class="md-nav__link">
    <span class="md-ellipsis">
      14. Part4: Global Illumination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework3-part5" class="md-nav__link">
    <span class="md-ellipsis">
      15. Part5: Adaptive Sampling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-homework4" class="md-nav__link">
    <span class="md-ellipsis">
      IV. Homework4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IV. Homework4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#homework4-overview" class="md-nav__link">
    <span class="md-ellipsis">
      16. Homework4: Clothsim Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework4-part1" class="md-nav__link">
    <span class="md-ellipsis">
      17. Part 1: Masses and springs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework4-part2" class="md-nav__link">
    <span class="md-ellipsis">
      18. Part 2: Simulation via numerical integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework4-part3" class="md-nav__link">
    <span class="md-ellipsis">
      19. Part 3: Handling collisions with other objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework4-part4" class="md-nav__link">
    <span class="md-ellipsis">
      20. Part4: Handling self-collisions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homework4-part5" class="md-nav__link">
    <span class="md-ellipsis">
      21. Part5: Shaders
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                




                  


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        
                        <h1 class='nav-section-title' id='section-homework1'>
                            Homework1 <a class='headerlink' href='#section-homework1' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="homework1-overview"><h1 id="homework1-overview-homework-1-rasterizer-overview">Homework 1: Rasterizer Overview</h1>
<h2 id="homework1-overview-overview">Overview</h2>
<p>In this homework, we implement a rasterizer that:</p>
<ul>
<li>Able to rasterize triangles, points and lines</li>
<li>Support supersampling</li>
<li>Support multiple sampling techniques: nearest and bilinear</li>
<li>Support level sampling</li>
<li>Support multiple level sampling techniques: level 0, nearest and interpolation</li>
</ul>
<p>We also implement the translation, scaling and rotation of SVG elements, and created our own SVG robot figure.</p>
<p>We build up our documentation website using markdown and GitHub Pages. Which is the site(or the PDF file) you are currently viewing. We add navigation bar, table of contents, code syntax highlighting and many other details to make the website more readable.</p>
<p>You can find the detailed implementation and explanation of each task in the following pages. Happy reading!</p>
<details class="warning">
<summary>Note for PDF</summary>
<p>Some features of the website, such as picture lightbox, may not be available in the PDF version. We recommend reading the <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-RuhaoT">website</a> directly for the best experience.</p>
</details></section><section class="print-page" id="homework1-task1"><h1 id="homework1-task1-task-1-drawing-single-color-triangles">Task 1: Drawing Single-Color Triangles</h1>
<h2 id="homework1-task1-method">Method</h2>
<p>The high-level idea of drawing triangles comes in two steps:</p>
<ol>
<li>
<p><strong>Bounding Box</strong>: Find the bounding box of the triangle, which is the smallest rectangle that contains the triangle. This is done by finding the minimum and maximum x and y coordinates of the triangle.</p>
</li>
<li>
<p><strong>Rasterization</strong>: For each pixel in the bounding box, check if it is inside the triangle. If it is, color it with the triangle's color.</p>
</li>
</ol>
<h2 id="homework1-task1-implementation">Implementation</h2>
<h3 id="homework1-task1-bounding-box">Bounding Box</h3>
<p>Given the three vertices of the triangle, finding x limits and y limits is straightforward. However, the limits are not necessarily integers. In order to ensure the bounding box fully covers the triangle, we need to take the ceiling and floor of the limits. To elaborate, the x minimum and y minimum should be rounded down when finding the boundary pixels, vice versa.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework1-task1-__codelineno-0-1"></a><span class="w">    </span><span class="c1">// Step 1: Find the bounding box of the triangle</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework1-task1-__codelineno-0-2"></a><span class="w">    </span><span class="c1">// The bounding box should at least cover the triangle, so for the left side, we take the floor of the minimum x coordinate of the triangle</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework1-task1-__codelineno-0-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_x_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">)));</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework1-task1-__codelineno-0-4"></a><span class="w">    </span><span class="c1">// For the right side, we take the ceiling of the maximum x coordinate of the triangle</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework1-task1-__codelineno-0-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_x_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ceil</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">)));</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework1-task1-__codelineno-0-6"></a><span class="w">    </span><span class="c1">// The same implementation for the y coordinate--floor for the bottom and ceiling for the top</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework1-task1-__codelineno-0-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_y_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">y2</span><span class="p">)));</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework1-task1-__codelineno-0-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_y_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ceil</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">y2</span><span class="p">)));</span>
</span></code></pre></div>
<h3 id="homework1-task1-rasterization">Rasterization</h3>
<p>Implicit line equations are implemented to determine whether a sample position is inside or on the edge of the triangle:</p>
<div class="arithmatex">\[
L(x,y) = -(x - x_0)dX + (y - y_0)dY
\]</div>
<p>If <span class="arithmatex">\(P_0(x_0,y_0)\)</span> and <span class="arithmatex">\(P_1(x_1,y_1)\)</span> are two points on the line, then <span class="arithmatex">\(dX = x_1 - x_0\)</span>, <span class="arithmatex">\(dY = y_1 - y_0\)</span>.</p>
<p>If <span class="arithmatex">\(L\)</span> yields all positive results for the three edge, then the sample position is considered inside the triangle. When <span class="arithmatex">\(L = 0\)</span>, the sample position is on the edge. Both situations the sample position should be colored.</p>
<p>Through the above method, each pixel's color could be determined through a one-time iteration.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework1-task1-__codelineno-1-1"></a><span class="w">    </span><span class="c1">// Step 2: Iterate through all the pixels in the bounding box</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework1-task1-__codelineno-1-2"></a><span class="w">    </span><span class="c1">// Initializing variables</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework1-task1-__codelineno-1-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">current_x_position</span><span class="p">,</span><span class="w"> </span><span class="n">current_y_position</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework1-task1-__codelineno-1-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework1-task1-__codelineno-1-5"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y0</span><span class="p">;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework1-task1-__codelineno-1-6"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework1-task1-__codelineno-1-7"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework1-task1-__codelineno-1-8"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#homework1-task1-__codelineno-1-9"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#homework1-task1-__codelineno-1-10"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line01_result</span><span class="p">,</span><span class="w"> </span><span class="n">line12_result</span><span class="p">,</span><span class="w"> </span><span class="n">line20_result</span><span class="p">;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#homework1-task1-__codelineno-1-11"></a><span class="w">    </span><span class="c1">// iterate through lines</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#homework1-task1-__codelineno-1-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounding_box_y_min</span><span class="p">;</span><span class="w"> </span><span class="n">current_y_position</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bounding_box_y_max</span><span class="p">;</span><span class="w"> </span><span class="n">current_y_position</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#homework1-task1-__codelineno-1-13"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#homework1-task1-__codelineno-1-14"></a><span class="w">        </span><span class="c1">// iterate through pixels in the line</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#homework1-task1-__codelineno-1-15"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounding_box_x_min</span><span class="p">;</span><span class="w"> </span><span class="n">current_x_position</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">bounding_box_x_max</span><span class="p">;</span><span class="w"> </span><span class="n">current_x_position</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#homework1-task1-__codelineno-1-16"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#homework1-task1-__codelineno-1-17"></a><span class="w">          </span><span class="c1">// check if the pixel is inside the triangle. If so, fill the corresponding buffer</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#homework1-task1-__codelineno-1-18"></a><span class="w">          </span><span class="c1">// note when calculating line results, we should use the CENTER of the pixel as position</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#homework1-task1-__codelineno-1-19"></a><span class="w">          </span><span class="n">line01_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="p">;</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#homework1-task1-__codelineno-1-20"></a><span class="w">          </span><span class="n">line12_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="p">;</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#homework1-task1-__codelineno-1-21"></a><span class="w">          </span><span class="n">line20_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="p">;</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#homework1-task1-__codelineno-1-22"></a>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#homework1-task1-__codelineno-1-23"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">line01_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">line12_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">line20_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="p">)</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#homework1-task1-__codelineno-1-24"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#homework1-task1-__codelineno-1-25"></a><span class="w">            </span><span class="n">fill_pixel</span><span class="p">(</span><span class="n">current_x_position</span><span class="p">,</span><span class="n">current_y_position</span><span class="p">,</span><span class="n">color</span><span class="p">);</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#homework1-task1-__codelineno-1-26"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#homework1-task1-__codelineno-1-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#homework1-task1-__codelineno-1-28"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<h2 id="homework1-task1-results">Results</h2>
<p>The following image is the rasterized result of <code>basic/test4.svg</code>:
<a class="glightbox" href="../images/hw1/hw1task1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Result of test4.svg" src="../images/hw1/hw1task1.png" /></a></p></section><section class="print-page" id="homework1-task2"><h1 id="homework1-task2-task-2-antialiasing-by-supersampling">Task 2: Antialiasing by Supersampling</h1>
<h2 id="homework1-task2-method">Method</h2>
<p>In task 2, antialiasing is implemented by supersampling and downsampling. The main steps involves:</p>
<ul>
<li>
<p><strong>Creating and maintaining sample buffer</strong>: To store the supersampling result, a sample buffer corresponding to the sample rate is created and managed throughout the render pipeline. When sample rate updates, the sample buffer should be updated accordingly.</p>
</li>
<li>
<p><strong>Supersampling with sample buffer</strong>: Sampling the triangle implements the sample buffer with the same method as in task 1 except the vertice position of triangle should be transformed to the sample buffer coordinate. However, lines and points should not be antialiased. They need to be zoomed in by the sample rate before populating the sample buffer.</p>
</li>
<li>
<p><strong>Downsampling and populating frame buffer</strong>: Downsampling the sample buffer to the frame buffer by mixing the color of the samples corresponding to the same pixel.</p>
</li>
</ul>
<h2 id="homework1-task2-implementation">Implementation</h2>
<h3 id="homework1-task2-creating-and-maintaining-sample-buffer">Creating and maintaining sample buffer</h3>
<p>When the sample rate is updated, sample buffer should be resized. As <code>RasterizerImp::set_sample_rate</code> updates sample rate, the buffer is resized when the function is called:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework1-task2-__codelineno-0-1"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">RasterizerImp::set_sample_rate</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rate</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework1-task2-__codelineno-0-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework1-task2-__codelineno-0-3"></a><span class="w">    </span><span class="c1">// TODO: Task 2: You may want to update this function for supersampling support</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework1-task2-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework1-task2-__codelineno-0-5"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">sample_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rate</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework1-task2-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework1-task2-__codelineno-0-7"></a><span class="w">    </span><span class="c1">// updated for supersampling</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework1-task2-__codelineno-0-8"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">sample_buffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sample_rate</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="o">::</span><span class="n">White</span><span class="p">);</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework1-task2-__codelineno-0-9"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p>The same applies to <code>RasterizerImp::set_framebuffer_target</code>:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework1-task2-__codelineno-1-1"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">RasterizerImp::set_framebuffer_target</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">rgb_framebuffer</span><span class="p">,</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework1-task2-__codelineno-1-2"></a><span class="w">                                             </span><span class="kt">size_t</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">height</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework1-task2-__codelineno-1-3"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework1-task2-__codelineno-1-4"></a><span class="w">    </span><span class="c1">// TODO: Task 2: You may want to update this function for supersampling support</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework1-task2-__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework1-task2-__codelineno-1-6"></a><span class="w">    </span><span class="c1">//cout &lt;&lt; &quot;set_framebuffer_target&quot; &lt;&lt; endl;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework1-task2-__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework1-task2-__codelineno-1-8"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#homework1-task2-__codelineno-1-9"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#homework1-task2-__codelineno-1-10"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">rgb_framebuffer_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rgb_framebuffer</span><span class="p">;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#homework1-task2-__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#homework1-task2-__codelineno-1-12"></a><span class="w">    </span><span class="c1">//updated for supersampling</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#homework1-task2-__codelineno-1-13"></a><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">sample_buffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sample_rate</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="o">::</span><span class="n">White</span><span class="p">);</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#homework1-task2-__codelineno-1-14"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="homework1-task2-supersampling-with-sample-buffer">Supersampling with sample buffer</h3>
<p>Define <span class="arithmatex">\(zoom\_coefficient = \sqrt{sample\_rate}\)</span>, the transformation of the vertice position of triangle to the sample buffer coordinate is:</p>
<div class="arithmatex">\[
(x_{transformed},y_{transformed}) = (x_{original},y_{original}) \times zoom\_coefficient
\]</div>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework1-task2-__codelineno-2-1"></a><span class="w">    </span><span class="c1">// Step 1: Convert the triangle vertices to the supersample buffer&#39;s coordinate system</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework1-task2-__codelineno-2-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework1-task2-__codelineno-2-3"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x0_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework1-task2-__codelineno-2-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y0_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework1-task2-__codelineno-2-5"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x1_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#homework1-task2-__codelineno-2-6"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y1_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#homework1-task2-__codelineno-2-7"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x2_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#homework1-task2-__codelineno-2-8"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y2_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span></code></pre></div>
<p>The sampling process is exactly the same as in task 1, except the result fills sample buffer instead of frame buffer.</p>
<p>For lines and points, they fill directly to the frame buffer pixels. This can be achieved by filling all the subpixels in the sample buffer with the same color. These subpixels form a square of size <span class="arithmatex">\(zoom\_coefficient \times zoom\_coefficient\)</span>. A double loop is implemented to iterate all the subpixels.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework1-task2-__codelineno-3-1"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">RasterizerImp::fill_pixel</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework1-task2-__codelineno-3-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework1-task2-__codelineno-3-3"></a><span class="w">    </span><span class="c1">// TODO: Task 2: You might need to this function to fix points and lines (such as the black rectangle border in test4.svg)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework1-task2-__codelineno-3-4"></a><span class="w">    </span><span class="c1">// NOTE: You are not required to implement proper supersampling for points and lines</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#homework1-task2-__codelineno-3-5"></a><span class="w">    </span><span class="c1">// It is sufficient to use the same color for all supersamples of a pixel for points and lines (not triangles)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#homework1-task2-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#homework1-task2-__codelineno-3-7"></a><span class="w">    </span><span class="c1">// Implementation by Ruhao Tian starts here</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#homework1-task2-__codelineno-3-8"></a><span class="w">    </span><span class="c1">// As points and lines are not required to be supersampled, we can simply fill the corresponding buffer with given color</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#homework1-task2-__codelineno-3-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#homework1-task2-__codelineno-3-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#homework1-task2-__codelineno-3-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#homework1-task2-__codelineno-3-12"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#homework1-task2-__codelineno-3-13"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#homework1-task2-__codelineno-3-14"></a><span class="w">        </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#homework1-task2-__codelineno-3-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#homework1-task2-__codelineno-3-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#homework1-task2-__codelineno-3-17"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="homework1-task2-downsampling-and-populating-frame-buffer">Downsampling and populating frame buffer</h3>
<p><code>RasterizerImp::resolve_to_framebuffer</code> resolves the sample buffer to the frame buffer. It iterates all the pixels in the frame buffer. For each pixel, its subpixel square is located. </p>
<p>The R, G, B values of all subpixels are averaged respectively and assigned to a temporary <code>Color</code> object <code>ds_color</code>:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework1-task2-__codelineno-4-1"></a><span class="w">        </span><span class="c1">// for each pixel, calculate the average color of all the samples</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework1-task2-__codelineno-4-2"></a><span class="w">        </span><span class="n">ds_color</span><span class="p">.</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework1-task2-__codelineno-4-3"></a><span class="w">        </span><span class="n">ds_color</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework1-task2-__codelineno-4-4"></a><span class="w">        </span><span class="n">ds_color</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework1-task2-__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#homework1-task2-__codelineno-4-6"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#homework1-task2-__codelineno-4-7"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#homework1-task2-__codelineno-4-8"></a><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#homework1-task2-__codelineno-4-9"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#homework1-task2-__codelineno-4-10"></a><span class="w">            </span><span class="n">ds_color</span><span class="p">.</span><span class="n">r</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#homework1-task2-__codelineno-4-11"></a><span class="w">            </span><span class="n">ds_color</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">].</span><span class="n">g</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#homework1-task2-__codelineno-4-12"></a><span class="w">            </span><span class="n">ds_color</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#homework1-task2-__codelineno-4-13"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#homework1-task2-__codelineno-4-14"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>Then the conversion of <code>ds_color</code> to <code>rgb_framebuffer_target</code> is the same as base code:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework1-task2-__codelineno-5-1"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework1-task2-__codelineno-5-2"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework1-task2-__codelineno-5-3"></a><span class="w">          </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">rgb_framebuffer_target</span><span class="p">[</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">ds_color</span><span class="p">.</span><span class="n">r</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework1-task2-__codelineno-5-4"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>The full implementation of <code>RasterizerImp::resolve_to_framebuffer</code> is:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework1-task2-__codelineno-6-1"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">RasterizerImp::resolve_to_framebuffer</span><span class="p">()</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#homework1-task2-__codelineno-6-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#homework1-task2-__codelineno-6-3"></a><span class="w">    </span><span class="c1">// TODO: Task 2: You will likely want to update this function for supersampling support</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#homework1-task2-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#homework1-task2-__codelineno-6-5"></a><span class="w">    </span><span class="c1">// Implementation by Ruhao Tian starts here</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#homework1-task2-__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#homework1-task2-__codelineno-6-7"></a><span class="w">    </span><span class="c1">//cout &lt;&lt; &quot;resolve_to_framebuffer&quot; &lt;&lt; endl;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#homework1-task2-__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#homework1-task2-__codelineno-6-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#homework1-task2-__codelineno-6-10"></a><span class="w">    </span><span class="n">Color</span><span class="w"> </span><span class="n">ds_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#homework1-task2-__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#homework1-task2-__codelineno-6-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#homework1-task2-__codelineno-6-13"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#homework1-task2-__codelineno-6-14"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#homework1-task2-__codelineno-6-15"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#homework1-task2-__codelineno-6-16"></a><span class="w">        </span><span class="c1">// for each pixel, calculate the average color of all the samples</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#homework1-task2-__codelineno-6-17"></a><span class="w">        </span><span class="n">ds_color</span><span class="p">.</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#homework1-task2-__codelineno-6-18"></a><span class="w">        </span><span class="n">ds_color</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#homework1-task2-__codelineno-6-19"></a><span class="w">        </span><span class="n">ds_color</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#homework1-task2-__codelineno-6-20"></a>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#homework1-task2-__codelineno-6-21"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#homework1-task2-__codelineno-6-22"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#homework1-task2-__codelineno-6-23"></a><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#homework1-task2-__codelineno-6-24"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#homework1-task2-__codelineno-6-25"></a><span class="w">            </span><span class="n">ds_color</span><span class="p">.</span><span class="n">r</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#homework1-task2-__codelineno-6-26"></a><span class="w">            </span><span class="n">ds_color</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">].</span><span class="n">g</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#homework1-task2-__codelineno-6-27"></a><span class="w">            </span><span class="n">ds_color</span><span class="p">.</span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sample_buffer</span><span class="p">[(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#homework1-task2-__codelineno-6-28"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#homework1-task2-__codelineno-6-29"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#homework1-task2-__codelineno-6-30"></a>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#homework1-task2-__codelineno-6-31"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="p">)</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#homework1-task2-__codelineno-6-32"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#homework1-task2-__codelineno-6-33"></a><span class="w">          </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">rgb_framebuffer_target</span><span class="p">[</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">ds_color</span><span class="p">.</span><span class="n">r</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#homework1-task2-__codelineno-6-34"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#homework1-task2-__codelineno-6-35"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#homework1-task2-__codelineno-6-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#homework1-task2-__codelineno-6-37"></a>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#homework1-task2-__codelineno-6-38"></a><span class="w">    </span><span class="c1">//cout &lt;&lt; &quot;resolve_to_framebuffer done&quot; &lt;&lt; endl;</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#homework1-task2-__codelineno-6-39"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h2 id="homework1-task2-results">Results</h2>
<p>The following images are the result of supersampling <code>basic/test4.svg</code> with sample rates 1, 4 and 16.</p>
<div class="admonition info">
<p class="admonition-title">Image displayed size too small?</p>
<p>Click on the image to activate lightbox mode.
In lightbox mode, click on the arrows on the left and right to navigate through images. This brings easy comparison.</p>
</div>
<p><a class="glightbox" href="../images/hw1/hw1task2_ss1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Sample rate 1" src="../images/hw1/hw1task2_ss1.png" width="32%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task2_ss4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Sample rate 4" src="../images/hw1/hw1task2_ss4.png" width="32%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task2_ss16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Sample rate 16" src="../images/hw1/hw1task2_ss16.png" width="32%\textwidth" /></a></p>
<p>The following images show a zoomed view of one triangle in <code>basic/test4.svg</code>. The left image is the result of sample rate 1 while the other one implements sample rate 16.</p>
<p><a class="glightbox" href="../images/hw1/hw1task2_ss1_zoom.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Sample rate 1 zoomed" src="../images/hw1/hw1task2_ss1_zoom.png" width="48%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task2_ss16_zoom.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Sample rate 16 zoomed" src="../images/hw1/hw1task2_ss16_zoom.png" width="48%\textwidth" /></a></p>
<p>In the left image, the top of the triangle seemed 'disconnected' from the other part. This is because, in the disconnected part, all the nearby sample points(center of pixels) are outside the triangle. When the sample rate increases, the subpixels inside the triangle are identified. This comparison shows the effectiveness of supersampling in antialiasing--it not only smooths the edges but also corrects the display of the image.</p></section><section class="print-page" id="homework1-task3"><h1 id="homework1-task3-task-3-transforms">Task 3: Transforms</h1>
<h2 id="homework1-task3-svg-design">SVG Design</h2>
<p>The overall idea is to design a robot with black hair, yellow skin, grey trousers and a T-shirt with Berkeley's iconic orange and blue color. The posture of robot is standing with right arm on the waist and left arm waving.</p>
<h2 id="homework1-task3-setting-up-colors">Setting up colors</h2>
<p>With the help of palette software, the RGB code of colors is obtained:</p>
<ul>
<li><span class="twemoji" style="color:#000000"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg></span> Black: #000000</li>
<li><span class="twemoji" style="color:#f3cb81"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg></span> Yellow: #f3cb81</li>
<li><span class="twemoji" style="color:#353535"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg></span> Grey: #353535</li>
<li><span class="twemoji" style="color:#e09811"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg></span> Orange: #e09811</li>
<li><span class="twemoji" style="color:#0b106e"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg></span> Blue: #0b106e</li>
</ul>
<p>Filling the colors in the SVG file, the robot is rendered as follows:</p>
<p><a class="glightbox" href="../images/hw1/hw1task3_color.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Robot with colors" src="../images/hw1/hw1task3_color.png" /></a></p>
<h2 id="homework1-task3-transforms">Transforms</h2>
<p>The right arm of the robot is rotated by -45 degrees, the forearm is rotated by -90, and the relative position is slightly adjusted:(modifications are highlighted in the code below)</p>
<div class="language-xml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">XML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#homework1-task3-__codelineno-0-51">51</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-52">52</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-53">53</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-54">54</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-55">55</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-56">56</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-57">57</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-58">58</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-59">59</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-60">60</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-61">61</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-62">62</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-63">63</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-64">64</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-65">65</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">        </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;translate(-90 -30)&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="hll"><span class="w">            </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;rotate(-45)&quot;</span><span class="nt">&gt;</span>
</span></span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">                </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;scale(.6 .2)&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">                    </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#e09811&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,-50 50,-50 -50,50 &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">                    </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#e09811&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,50 50,-50 50,50&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">                </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="hll"><span class="w">                </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;translate(-40 50)&quot;</span><span class="nt">&gt;</span>
</span></span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="hll"><span class="w">                    </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;rotate(-90)&quot;</span><span class="nt">&gt;</span>
</span></span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">                        </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;scale(.6 .2)&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">                            </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#f3cb81&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,-50 50,-50 -50,50 &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">                            </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#f3cb81&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,50 50,-50 50,50&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">                        </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">                    </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">                </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">            </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">        </span><span class="nt">&lt;/g&gt;</span>
</span></code></pre></div></td></tr></table></div>
<p>The left big arm and forearm of the robot are rotated by -45 degrees, their relative position is adjusted as well:</p>
<div class="language-xml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">XML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#homework1-task3-__codelineno-1-69">69</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-70">70</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-71">71</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-72">72</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-73">73</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-74">74</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-75">75</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-76">76</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-77">77</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-78">78</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-79">79</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-80">80</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-81">81</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-82">82</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-83">83</a></span>
<span class="normal"><a href="#homework1-task3-__codelineno-1-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="w">        </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;translate(90 -50)&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="hll"><span class="w">            </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;rotate(-45)&quot;</span><span class="nt">&gt;</span>
</span></span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="w">                </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;scale(.6 .2)&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="w">                    </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#0b106e&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,-50 50,-50 -50,50 &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="w">                    </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#0b106e&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,50 50,-50 50,50&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="w">                </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="hll"><span class="w">                </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;translate(70 -30)&quot;</span><span class="nt">&gt;</span>
</span></span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="hll"><span class="w">                    </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;rotate(-45)&quot;</span><span class="nt">&gt;</span>
</span></span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">                        </span><span class="nt">&lt;g</span><span class="w"> </span><span class="na">transform=</span><span class="s">&quot;scale(.6 .2)&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="w">                            </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#f3cb81&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,-50 50,-50 -50,50 &quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="w">                            </span><span class="nt">&lt;polygon</span><span class="w"> </span><span class="na">fill=</span><span class="s">&quot;#f3cb81&quot;</span><span class="w"> </span><span class="na">points=</span><span class="s">&quot;-50,50 50,-50 50,50&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80"></a><span class="w">                        </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81"></a><span class="w">                    </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82"></a><span class="w">                </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="w">            </span><span class="nt">&lt;/g&gt;</span>
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="w">        </span><span class="nt">&lt;/g&gt;</span>
</span></code></pre></div></td></tr></table></div>
<p>The robot is rendered as follows:</p>
<p><a class="glightbox" href="../images/hw1/hw1task3_final.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Robot with transforms" src="../images/hw1/hw1task3_final.png" /></a></p></section><section class="print-page" id="homework1-task4"><h1 id="homework1-task4-task-4-barycentric-coordinates">Task 4: Barycentric coordinates</h1>
<h2 id="homework1-task4-methodology">Methodology</h2>
<h3 id="homework1-task4-the-barycentric-coordinate-system">The Barycentric Coordinate System</h3>
<p>The barycentric coordinate presents a point in a triangle with the weighted sum of the triangle's vertice positions. Assume triangle vertices <span class="arithmatex">\(A(x_{A},y_{A})\)</span>, <span class="arithmatex">\(B(x_{B},y_{B})\)</span>, and <span class="arithmatex">\(C(x_{C},y_{C})\)</span>, position of any point <span class="arithmatex">\(P(x_{P},y_{P})\)</span> inside the triangle can be calculated as:</p>
<div class="arithmatex">\[
P = \alpha A + \beta B + \gamma C
\]</div>
<p>where <span class="arithmatex">\(\alpha + \beta + \gamma = 1\)</span>. In other words, <span class="arithmatex">\(\alpha\)</span>, <span class="arithmatex">\(\beta\)</span> and <span class="arithmatex">\(\gamma\)</span> are the weights showing how much each vertex contributes or is close to the point <span class="arithmatex">\(P\)</span>.</p>
<h3 id="homework1-task4-calculation">Calculation</h3>
<p>One way to represent how close a point is to a vertex is to calculate its proportional distance to the edge opposite to the vertex, as is shown in the following figure:</p>
<p><a class="glightbox" href="../images/hw1/hw1task4_BCdistance.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Barycentric coordinates" src="../images/hw1/hw1task4_BCdistance.png" /></a></p>
<p>Assume <span class="arithmatex">\(D_{BC}\)</span> to be the distance to edge <span class="arithmatex">\(BC\)</span>, the <span class="arithmatex">\(\alpha\)</span> weight can be calculated as:</p>
<div class="arithmatex">\[
\alpha = \frac{D_{BC}(x_{P},y_{P})}{D_{BC}(x_{A},y_{A})}
\]</div>
<p>Point-to-line distance formula can be used to calculate <span class="arithmatex">\(D\)</span>:</p>
<div class="arithmatex">\[
D_{BC}(x_{P},y_{P}) = -(x_{P} - x_{B})(y_{C} - y_{B}) + (y_{P} - y_{B})(x_{C} - x_{B})
\]</div>
<div class="arithmatex">\[
D_{BC}(x_{A},y_{A}) = -(x_{A} - x_{B})(y_{C} - y_{B}) + (y_{A} - y_{B})(x_{C} - x_{B})
\]</div>
<p>Replace <span class="arithmatex">\(D_{BC}\)</span> in the <span class="arithmatex">\(\alpha\)</span> formula, we get:</p>
<div class="arithmatex">\[
\alpha = \frac{-(x_{P} - x_{B})(y_{C} - y_{B}) + (y_{P} - y_{B})(x_{C} - x_{B})}{-(x_{A} - x_{B})(y_{C} - y_{B}) + (y_{A} - y_{B})(x_{C} - x_{B})}
\]</div>
<p>Similarly, <span class="arithmatex">\(\beta\)</span> and <span class="arithmatex">\(\gamma\)</span> can be calculated as:</p>
<div class="arithmatex">\[
\beta = \frac{-(x_{P} - x_{C})(y_{A} - y_{C}) + (y_{P} - y_{C})(x_{A} - x_{C})}{-(x_{B} - x_{C})(y_{A} - y_{C}) + (y_{B} - y_{C})(x_{A} - x_{C})}
\]</div>
<div class="arithmatex">\[
\gamma = \frac{-(x_{P} - x_{A})(y_{B} - y_{A}) + (y_{P} - y_{A})(x_{B} - x_{A})}{-(x_{C} - x_{A})(y_{B} - y_{A}) + (y_{C} - y_{A})(x_{B} - x_{A})}
\]</div>
<h3 id="homework1-task4-features-of-barycentric-coordinates">Features of Barycentric Coordinates</h3>
<p>The Barycentric coordinates' distinctive feature makes it suitable for geometric calculations in computer graphics. This includes but is not limited to:</p>
<ul>
<li><strong>Interpolation</strong>: Barycentric coordinates can be used to interpolate values smoothly varying across a triangle. This is useful in texture mapping, color blending, and shading.</li>
<li><strong>Invariance to affine transformations</strong>: Regardless of the affine transformation applied to the triangle, the relative position of the vertices remains the same. As Barycentric coordinates are based on the relative position of the vertices, it could simplify calculation when affine transformations are involved.</li>
</ul>
<h2 id="homework1-task4-implementation">Implementation</h2>
<p>To determine whether a point is inside a triangle with Barycentric coordinates, whether the three weights are all positive is the only thing needed to check. For the points inside the triangle, its color is the weighted sum of the triangle's vertices' color, where the weights are exactly the Barycentric coordinates' weights. Other parts of the rasterization process are the same as Task 2.</p>
<p>The following code shows the rasterization process with Barycentric coordinates, highlighted are the parts where Barycentric coordinates are involved:</p>
<div class="language-cpp highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#homework1-task4-__codelineno-0-202">202</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-203">203</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-204">204</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-205">205</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-206">206</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-207">207</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-208">208</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-209">209</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-210">210</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-211">211</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-212">212</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-213">213</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-214">214</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-215">215</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-216">216</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-217">217</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-218">218</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-219">219</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-220">220</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-221">221</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-222">222</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-223">223</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-224">224</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-225">225</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-226">226</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-227">227</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-228">228</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-229">229</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-230">230</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-231">231</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-232">232</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-233">233</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-234">234</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-235">235</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-236">236</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-237">237</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-238">238</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-239">239</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-240">240</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-241">241</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-242">242</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-243">243</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-244">244</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-245">245</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-246">246</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-247">247</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-248">248</a></span>
<span class="normal"><a href="#homework1-task4-__codelineno-0-249">249</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="w">    </span><span class="c1">// Step 1: Convert the triangle vertices to the supersample buffer&#39;s coordinate system</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">);</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x0_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y0_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x1_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y1_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x2_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">y2_ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="p">;</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="w">    </span><span class="c1">// Step 2: Find the bounding box of the triangle in the supersample buffer</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_x_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">x0_ss</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">x1_ss</span><span class="p">,</span><span class="w"> </span><span class="n">x2_ss</span><span class="p">)));</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_x_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ceil</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">x0_ss</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">x1_ss</span><span class="p">,</span><span class="w"> </span><span class="n">x2_ss</span><span class="p">)));</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_y_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">y0_ss</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">y1_ss</span><span class="p">,</span><span class="w"> </span><span class="n">y2_ss</span><span class="p">)));</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bounding_box_y_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ceil</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">y0_ss</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">y1_ss</span><span class="p">,</span><span class="w"> </span><span class="n">y2_ss</span><span class="p">)));</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="c1">// Step 3: Iterate through all the pixels in the bounding box</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="w">    </span><span class="c1">//cout &lt;&lt; &quot;iterating through pixels in the bounding box&quot; &lt;&lt; endl;</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">current_x_position</span><span class="p">,</span><span class="w"> </span><span class="n">current_y_position</span><span class="p">;</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0_ss</span><span class="p">;</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y0_ss</span><span class="p">;</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1_ss</span><span class="p">;</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y2_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1_ss</span><span class="p">;</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2_ss</span><span class="p">;</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y0_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2_ss</span><span class="p">;</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">weight_0</span><span class="p">,</span><span class="w"> </span><span class="n">weight_1</span><span class="p">,</span><span class="w"> </span><span class="n">weight_2</span><span class="p">;</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">    </span><span class="n">Color</span><span class="w"> </span><span class="n">current_color</span><span class="p">;</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounding_box_y_min</span><span class="p">;</span><span class="w"> </span><span class="n">current_y_position</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">bounding_box_y_max</span><span class="p">;</span><span class="w"> </span><span class="n">current_y_position</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounding_box_x_min</span><span class="p">;</span><span class="w"> </span><span class="n">current_x_position</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">bounding_box_x_max</span><span class="p">;</span><span class="w"> </span><span class="n">current_x_position</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="w">        </span><span class="c1">// calcuate the weights of the barycentric coordinates</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="hll"><span class="w">        </span><span class="n">weight_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x0_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y0_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="p">);</span>
</span></span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="hll"><span class="w">        </span><span class="n">weight_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x1_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y1_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="p">);</span>
</span></span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="hll"><span class="w">        </span><span class="n">weight_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y0_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x2_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y2_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y0_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="p">);</span>
</span></span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="w">        </span><span class="c1">// check if the pixel is inside the triangle</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weight_0</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">weight_1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">weight_2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="p">)</span>
</span></span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="w">          </span><span class="c1">// if so, calculate the color of the pixel</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="hll"><span class="w">          </span><span class="n">current_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_2</span><span class="p">;</span>
</span></span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="w">          </span><span class="c1">// fill the corresponding buffer</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="w">          </span><span class="n">sample_buffer</span><span class="p">[</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">current_x_position</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_color</span><span class="p">;</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="homework1-task4-results">Results</h2>
<p>The screenshot of <code>svg/basic/test7.svg</code> is shown below.</p>
<p><a class="glightbox" href="../images/hw1/hw1task4_test7reuslt.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Interpolated color with Barycentric coordinates" src="../images/hw1/hw1task4_test7reuslt.png" /></a></p></section><section class="print-page" id="homework1-task5"><h1 id="homework1-task5-task-5-pixel-sampling-for-texture-mapping">Task 5: "Pixel sampling" for texture mapping</h1>
<h2 id="homework1-task5-methodology">Methodology</h2>
<h3 id="homework1-task5-texture-coordinates-mapping">Texture Coordinates Mapping</h3>
<p><a class="glightbox" href="https://upload.wikimedia.org/wikipedia/commons/f/f2/Texture_mapping_demonstration_animation.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="left" alt="Texture Coordinates Mapping" src="https://upload.wikimedia.org/wikipedia/commons/f/f2/Texture_mapping_demonstration_animation.gif" /></a></p>
<p>Given an unfolded texture image and a 3D model, the mission is to 'wrap around' the texture onto the 3D model. During this process, the 2D texture image is divided into many triangles, each of which corresponds to a triangle on the 3D model. However, the 3D model has a different coordination system from the 2D image. Therefore, texture coordinates mapping is needed to map the 2D texture image to the 3D model.</p>
<p>As discussed in the previous task, the Barycentric coordinates remain the same however the triangle transforms affinely. Therefore, given a point on the 3D model, one can obtain its matching point on the 2D texture by finding out its Barycentric coordinates and then using the Barycentric coordinates to interpolate the texture coordinates. This lays the foundation for texture mapping.</p>
<h3 id="homework1-task5-pixel-sampling">Pixel Sampling</h3>
<p>Pixel sampling finds which color should be displayed on the screen pixel. First, the corresponding point on the 3D model of the pixel sample point is found, which is the job of the rasterizer. As the color of the triangle is decided by its texture, the next step is to find the corresponding color point on the texture. After that, the color is returned all the way back to the pixel point. This whole process is described in the following figure.</p>
<pre class="mermaid"><code>flowchart TB
  A[Start:
  Sample Point 
  in screen space]
  B[Rasterizer:
  Find the corresponding point 
  on the 3D model];
  C[Texture Mapping:
  Find the corresponding point 
  on the texture]
  A --&gt;|Sample Point Position| B;
  B --&gt;|Barycentric Coordinate Position| C;
  C --&gt;|Color| D[Rasterizer: Get color];
  D --&gt;|Color| E[Screen frame buffer: Get color];</code></pre>
<p>Featured by the density of sample points and texture texels, pixel sampling could be categorized into:</p>
<ul>
<li><strong>Magnification pixel sampling</strong>: Where texels surplus sample points and each sample point corresponds to several texels. Common sample methods are nearest sampling and bilinear sampling.</li>
<li><strong>Minification pixel sampling</strong>: Where sample points surplus texels and each texel corresponds to several sample points. Common sample methods include mipmap and anisotropic filtering.</li>
</ul>
<h3 id="homework1-task5-magnification-pixel-sampling">Magnification pixel sampling</h3>
<h4 id="homework1-task5-nearest-sampling">Nearest sampling</h4>
<p>Nearest sampling choose the closest texel to the sample point. Simple idea, low computational complexity, but nearest sampling does not ensure the color of sample pixels will change smoothly, so aliasing is common for nearest sampling. </p>
<h4 id="homework1-task5-bilinear-sampling">Bilinear sampling</h4>
<p><a class="glightbox" href="../images/hw1/hw1task5_bilinearcalc.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="right" alt="Calculation of bilinear sampling" src="../images/hw1/hw1task5_bilinearcalc.png" width="30%\textwidth" /></a></p>
<p>Bilinear sampling finds 4 closest texels around the sample point. Both horizontal and vertical interpolations are performed to get the final color. Assume <span class="arithmatex">\(u_{00}\)</span>, <span class="arithmatex">\(u_{01}\)</span>, <span class="arithmatex">\(u_{10}\)</span>, <span class="arithmatex">\(u_{11}\)</span> are the for texels and <span class="arithmatex">\(C\)</span> is the color of texel, the first and second linear interpolation calculate the color of two groups of horizontal texels, based on the proportional distance horizontally sample point is close to the texels:</p>
<div class="arithmatex">\[
C_{0} = (1 - s) \cdot C_{00} + s \cdot C_{10}
\]</div>
<div class="arithmatex">\[
C_{1} = (1 - s) \cdot C_{01} + s \cdot C_{11}
\]</div>
<p>Then, the final color is calculated by the third linear interpolation, based on the proportional distance vertically sample point is close to the texels:</p>
<div class="arithmatex">\[
C = (1 - t) \cdot C_{0} + t \cdot C_{1}
\]</div>
<p>Bilinear sampling is more complex than nearest sampling, but it can effectively reduce aliasing.</p>
<h2 id="homework1-task5-implementation">Implementation</h2>
<h3 id="homework1-task5-nearest-sampling_1">Nearest sampling</h3>
<p>The nearest texel of the sample point is exactly the texel sample point is in. Therefore, the position of the nearest texel is the integer part of the texture coordinates and can be easily calculated by <code>floor</code> function.</p>
<p>It is worth noting that, as mipmap size varies with the level, the input texture coordinates should be scaled to the mipmap size.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework1-task5-__codelineno-0-1"></a><span class="w">  </span><span class="n">Color</span><span class="w"> </span><span class="nf">Texture::sample_nearest</span><span class="p">(</span><span class="n">Vector2D</span><span class="w"> </span><span class="n">uv</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework1-task5-__codelineno-0-2"></a><span class="w">    </span><span class="c1">// TODO: Task 5: Fill this in.</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework1-task5-__codelineno-0-3"></a><span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mipmap</span><span class="p">[</span><span class="n">level</span><span class="p">];</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework1-task5-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework1-task5-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework1-task5-__codelineno-0-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">get_texel</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">width</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floor</span><span class="p">(</span><span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework1-task5-__codelineno-0-7"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="homework1-task5-bilinear-sampling_1">Bilinear sampling</h3>
<p>There is a special case for bilinear sampling: when the sample point is so close to the edge of the texture that the position of some closest texels is out of the texture. In this case, the closest texel inside texture is used to replace the out-of-bound texel. In implementation, the position of the out-of-bound texel could be replaced by the position of that closest texel. Take the horizontal direction as an example, the position of out-of-bound texel is replaced by the position of the closest texel inside the texture:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework1-task5-__codelineno-1-1"></a><span class="w">    </span><span class="c1">//find the x coordinate of four nearest texels, as well as the proportion of the distance</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework1-task5-__codelineno-1-2"></a><span class="w">    </span><span class="c1">// consider the edge case, if the sample point is on the edge, repeat the nearest texel</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework1-task5-__codelineno-1-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework1-task5-__codelineno-1-4"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework1-task5-__codelineno-1-5"></a><span class="w">      </span><span class="n">sampletexel_lu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework1-task5-__codelineno-1-6"></a><span class="w">      </span><span class="n">sampletexel_ru</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework1-task5-__codelineno-1-7"></a><span class="w">      </span><span class="n">sampletexel_ld</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework1-task5-__codelineno-1-8"></a><span class="w">      </span><span class="n">sampletexel_rd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#homework1-task5-__codelineno-1-9"></a><span class="w">      </span><span class="c1">// horizontally, the two nearest texels are the same</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#homework1-task5-__codelineno-1-10"></a><span class="w">      </span><span class="n">x_proportion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// could be any value</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#homework1-task5-__codelineno-1-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#homework1-task5-__codelineno-1-12"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#homework1-task5-__codelineno-1-13"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#homework1-task5-__codelineno-1-14"></a><span class="w">      </span><span class="n">sampletexel_lu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#homework1-task5-__codelineno-1-15"></a><span class="w">      </span><span class="n">sampletexel_ru</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#homework1-task5-__codelineno-1-16"></a><span class="w">      </span><span class="n">sampletexel_ld</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#homework1-task5-__codelineno-1-17"></a><span class="w">      </span><span class="n">sampletexel_rd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#homework1-task5-__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#homework1-task5-__codelineno-1-19"></a><span class="w">      </span><span class="n">x_proportion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#homework1-task5-__codelineno-1-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#homework1-task5-__codelineno-1-21"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#homework1-task5-__codelineno-1-22"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#homework1-task5-__codelineno-1-23"></a><span class="w">      </span><span class="n">sampletexel_lu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#homework1-task5-__codelineno-1-24"></a><span class="w">      </span><span class="n">sampletexel_ru</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#homework1-task5-__codelineno-1-25"></a><span class="w">      </span><span class="n">sampletexel_ld</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#homework1-task5-__codelineno-1-26"></a><span class="w">      </span><span class="n">sampletexel_rd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#homework1-task5-__codelineno-1-27"></a>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#homework1-task5-__codelineno-1-28"></a><span class="w">      </span><span class="n">x_proportion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">uv_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#homework1-task5-__codelineno-1-29"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>In the first two situations of <code>if</code> statement, because horizontally the two nearest texels are the same, their weighted color sum will always be the same, which means the proportion of the distance does not need to be calculated and this is why <code>x_proportion</code> is set to 0. In other cases, <code>floor(uv_x- 0.5)</code> gives the left two texels' x coordinates and this coordinate plus by one, equals <code>ceil(</code>uv_x - 0.5)`, giving the right ones. The same logic applies to the vertical direction.</p>
<p>After obtaining the position of the four nearest texels and the proportion of the distance, the color of the sample point is calculated by the formula mentioned above.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework1-task5-__codelineno-2-1"></a><span class="w">    </span><span class="c1">//get the color of four nearest texels</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework1-task5-__codelineno-2-2"></a><span class="w">    </span><span class="n">c_lu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">get_texel</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_lu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_lu</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework1-task5-__codelineno-2-3"></a><span class="w">    </span><span class="n">c_ru</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">get_texel</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_ru</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_ru</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework1-task5-__codelineno-2-4"></a><span class="w">    </span><span class="n">c_ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">get_texel</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_ld</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_ld</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework1-task5-__codelineno-2-5"></a><span class="w">    </span><span class="n">c_rd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mip</span><span class="p">.</span><span class="n">get_texel</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_rd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sampletexel_rd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#homework1-task5-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#homework1-task5-__codelineno-2-7"></a><span class="w">    </span><span class="c1">//bilinear interpolation</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#homework1-task5-__codelineno-2-8"></a><span class="w">    </span><span class="c1">// first lerp horizontally, then vertically</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#homework1-task5-__codelineno-2-9"></a><span class="w">    </span><span class="n">temp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_lu</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_proportion</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c_ru</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x_proportion</span><span class="p">;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#homework1-task5-__codelineno-2-10"></a><span class="w">    </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_ld</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_proportion</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c_rd</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x_proportion</span><span class="p">;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#homework1-task5-__codelineno-2-11"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y_proportion</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y_proportion</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework1-task5-results">Results</h2>
<p>The following images show the result of nearest sampling and bilinear sampling. From left to right are nearest sampling with supersample rate 1, nearest sampling with supersample rate 16, bilinear sampling with supersample rate 1, and bilinear sampling with supersample rate 16.</p>
<div class="admonition info">
<p class="admonition-title">Image displayed size too small?</p>
<p>Click on the image to activate lightbox mode.
In lightbox mode, click on the arrows on the left and right to navigate through images. This brings easy comparison.</p>
</div>
<p><a class="glightbox" href="../images/hw1/hw1task5_nearestss1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Nearest sampling with supersample rate 1" src="../images/hw1/hw1task5_nearestss1.png" width="24%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task5_nearestss16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Nearest sampling with supersample rate 16" src="../images/hw1/hw1task5_nearestss16.png" width="24%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task5_bilinearss1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Bilinear sampling with supersample rate 1" src="../images/hw1/hw1task5_bilinearss1.png" width="24%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task5_bilinearss16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Bilinear sampling with supersample rate 16" src="../images/hw1/hw1task5_bilinearss16.png" width="24%\textwidth" /></a></p>
<p>Examine the images, jaggies are visible in the nearest sampling with supersampling rate 16, at the end of "LET THERE BE", which does not appear in bilinear sampling with supersample rate 1.</p>
<h2 id="homework1-task5-discussion">Discussion</h2>
<p>It is clear that bilinear sampling is better than nearest sampling, even bilinear sampling with supersample rate 1 can achieve better results than nearest sampling with supersample rate 16. According to the code, bilinear sampling is certainly more costly, but it smooths the color transition, so images with many high-frequency elements would have a more obvious effect, like this twisted logo with a sharp orange-white transition. </p>
<p>Another noticeable thing is bilinear sampling is more effective than nearest sampling and supersampling combined. This is because supersampling can only smooth the color transition in the pixel level, while bilinear sampling smooths the color transition in the texel level. In magnification pixel sampling, many texels are mapped to one pixel, so bilinear sampling is more effective than supersampling.</p></section><section class="print-page" id="homework1-task6"><h1 id="homework1-task6-task-6-level-sampling-with-mipmaps-for-texture-mapping">Task 6: "Level sampling" with mipmaps for texture mapping</h1>
<h2 id="homework1-task6-methodology">Methodology</h2>
<h3 id="homework1-task6-texture-minification">Texture Minification</h3>
<p>Level sampling is a technique for solving issues in texture minification. As is described in Task 5, texture minification is the process of downsampling the texture, where multiple texels correspond to one pixel. Different ways of deciding the sample pixel's color will have a significant impact on the final image quality. </p>
<p><a class="glightbox" href="https://pic2.zhimg.com/v2-2a6b2b72a8b13bdc9e978d2da218634d_r.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="right" alt="Aliasing" src="https://pic2.zhimg.com/v2-2a6b2b72a8b13bdc9e978d2da218634d_r.jpg" width="30%\textwidth" /></a></p>
<p>Take nearest sampling as an example, the color of the sample pixel is the color of the nearest texel, and all the rest corresponding texels are ignored. This could cause serious aliasing.</p>
<p>As discussed in previous tasks, bilinear sampling has been proven effective in reducing aliasing. However, averaging the color of all corresponding texels is costly, as the corresponding texel number grows exponentially with the level of minification. Such difficulties are the motivation of mipmaps.</p>
<h3 id="homework1-task6-mipmaps-and-level-sampling">Mipmaps and Level Sampling</h3>
<h4 id="homework1-task6-overview">Overview</h4>
<p>The idea of mipmap is to store a series of downsampled textures, the downsampling process has averaged color ahead of time. When the rasterizer is doing texture mapping, it can choose the finest mipmap level in which each texel has a similar size to the sample pixel. This way, the rasterizer can avoid the expensive averaging process and still get a smooth color transition.</p>
<p>The key considerations of mipmaps is how to choose the mipmap level. Once mipmap level is chosen, normal sampling process, including nearest sampling and bilinear sampling, can be applied to the chosen mipmap.</p>
<h4 id="homework1-task6-mipmap-level-selection">Mipmap Level Selection</h4>
<p>According to the lecture, mipmap level selection can be done in several approaches:</p>
<ul>
<li><strong>Fixed mipmap level</strong>: The mipmap level is chosen ahead of time, and the same level is used for all sample pixels. This is the simplest approach, and very similar to sampling without mipmaps.</li>
<li><strong>Nearest level</strong>: Based on the size of the sample pixel, the level with the closest texel size is chosen. </li>
<li><strong>Nearest level with interpolation</strong>: Select two closest levels and sample them, this will result in two selected colors. Then, the final color is interpolated between the two colors based on the size of the sample pixel.</li>
</ul>
<h4 id="homework1-task6-calculation-of-closest-mipmap-level">Calculation of Closest Mipmap Level</h4>
<p>Assuming all mipmaps have the same aspect ratio as the original texture and the sample space, mipmap level could be calculated by inspecting the distance zoom ratio between two sample pixels and their corresponding texels. Let <span class="arithmatex">\(L\)</span> be the zoom level of distance, then the mipmap level <span class="arithmatex">\(D\)</span> can be calculated as:</p>
<div class="arithmatex">\[
D = \log_{2}L
\]</div>
<p>As each mipmap level is downsampled by a factor of 2.</p>
<p>However, mipmaps do not always have the same aspect ratio as the original texture and the sample space. In this case, the three nearest pixels of the sample pixel is selected, distance zoom ratio is calculated based on the sample pixel and the x-direction nearest, and y-direction nearest respectively. The mipmap level is then calculated based on the largest distance zoom ratio, as shown in the course slides.</p>
<figure>
  <a class="glightbox" href="https://cs184.eecs.berkeley.edu/public/sp24/lectures/lec-5-texture/slides/slide-65.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Mipmap level selection" src="https://cs184.eecs.berkeley.edu/public/sp24/lectures/lec-5-texture/slides/slide-65.jpg" width="70%\textwidth" /></a>
</figure>
<h3 id="homework1-task6-sample-combinations">Sample Combinations</h3>
<p>The final color of the sample pixel is the color of the chosen mipmap level's texel. The color of the texel is calculated by normal sampling process, including nearest sampling and bilinear sampling. The mipmap level is chosen via the method discussed above. Together, there are six combinations of sample processes.</p>
<p>When mipmap is sampled by bilinear sampling and the mipmap level is chosen via nearest level interpolation, the combination is called <strong>trilinear sampling</strong>.</p>
<h2 id="homework1-task6-implementation">Implementation</h2>
<h3 id="homework1-task6-the-rasterization-pipeline">The rasterization pipeline</h3>
<p>The rasterization pipeline is modified to include the level sampling process. The following flowchart shows the rasterization pipeline with level sampling:</p>
<pre class="mermaid"><code>flowchart TB
  A[Rasterization Pipeline:Start]
  B[Preprocess-Already done:
  Triangle vertices coordinate conversion
  Bounding box calculation];
  C[Nearest Point Set Selection:
  Check sample points' position
  Find the sample points' nearest points
  Calculate their texture coordinates];
  D[Level Sampling:
  Implement the sampler];
  E[Filling Frame Buffer];
  A --&gt; B;
  B --&gt; C;
  C --&gt;|SampleParameters| D;
  D --&gt;|Color| E;</code></pre>
<p>As the most part has been implemented in previous tasks, the focus of this task is the implementation of the Nearest point set selection and level sampling.</p>
<h3 id="homework1-task6-nearest-point-set-selection">Nearest Point Set Selection</h3>
<p>Given the sample pixel, typically its right next pixel and upper next pixel are included in the nearest point set. However, to avoid the potential risk of selecting pixels outside the sample space, when the sample pixel is on the right edge of the bounding box, the left next pixel is included instead of the right one:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework1-task6-__codelineno-0-1"></a><span class="w">        </span><span class="c1">// find the nearest sample points</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework1-task6-__codelineno-0-2"></a><span class="w">        </span><span class="c1">// the x and y coordinates of the nearest sample points</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework1-task6-__codelineno-0-3"></a><span class="w">        </span><span class="c1">// in the order of current sample point, x nearest sample point, y nearest sample point</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework1-task6-__codelineno-0-4"></a><span class="w">        </span><span class="c1">// consider the edge case</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework1-task6-__codelineno-0-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bounding_box_x_max</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework1-task6-__codelineno-0-6"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework1-task6-__codelineno-0-7"></a><span class="w">          </span><span class="n">current_nearest_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_x_position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework1-task6-__codelineno-0-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework1-task6-__codelineno-0-9"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#homework1-task6-__codelineno-0-10"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#homework1-task6-__codelineno-0-11"></a><span class="w">          </span><span class="n">current_nearest_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_x_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#homework1-task6-__codelineno-0-12"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>The same applies to the y direction.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework1-task6-__codelineno-1-1"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bounding_box_y_max</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework1-task6-__codelineno-1-2"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework1-task6-__codelineno-1-3"></a><span class="w">          </span><span class="n">current_nearest_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_y_position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework1-task6-__codelineno-1-4"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework1-task6-__codelineno-1-5"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework1-task6-__codelineno-1-6"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework1-task6-__codelineno-1-7"></a><span class="w">          </span><span class="n">current_nearest_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">current_y_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.5</span><span class="p">);</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework1-task6-__codelineno-1-8"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>Then, the Barycentric coordinates of the three points are calculated. The first, second and third weights of the Barycentric coordinates are stored in three 3D vectors, <code>weight_0</code>, <code>weight_1</code>, <code>weight_2</code> respectively.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework1-task6-__codelineno-2-1"></a><span class="w">        </span><span class="c1">// calcuate the weights of the barycentric coordinates</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework1-task6-__codelineno-2-2"></a><span class="w">        </span><span class="n">weight_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">current_nearest_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x1_ss</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">current_nearest_y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">y1_ss</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x0_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y0_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line12_delta_x</span><span class="p">);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework1-task6-__codelineno-2-3"></a><span class="w">        </span><span class="n">weight_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">current_nearest_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x2_ss</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">current_nearest_y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">y2_ss</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x1_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y1_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line20_delta_x</span><span class="p">);</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework1-task6-__codelineno-2-4"></a><span class="w">        </span><span class="n">weight_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">current_nearest_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x0_ss</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">current_nearest_y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">y0_ss</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x2_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y2_ss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y0_ss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">line01_delta_x</span><span class="p">);</span>
</span></code></pre></div>
<p>Next, the weight of the sample point is examined to check if the sample point is inside the triangle. If so, the texture coordinates of the nearest point set are calculated, and a new <code>SampleParams</code> object is created.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework1-task6-__codelineno-3-1"></a><span class="w">        </span><span class="c1">// check if the pixel is inside the triangle</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework1-task6-__codelineno-3-2"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weight_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">weight_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">weight_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="p">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework1-task6-__codelineno-3-3"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework1-task6-__codelineno-3-4"></a><span class="w">          </span><span class="c1">// if so, calculate the the uv coordinates of the corresponding texel</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#homework1-task6-__codelineno-3-5"></a><span class="w">          </span><span class="n">current_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_2</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#homework1-task6-__codelineno-3-6"></a><span class="w">          </span><span class="c1">// doesn&#39;t matter if dx or dy is negative, as we only need the magnitude</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#homework1-task6-__codelineno-3-7"></a><span class="w">          </span><span class="n">current_dx_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#homework1-task6-__codelineno-3-8"></a><span class="w">          </span><span class="n">current_dy_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Vector2D</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight_2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#homework1-task6-__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#homework1-task6-__codelineno-3-10"></a><span class="w">          </span><span class="c1">// create a SampleParams struct</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#homework1-task6-__codelineno-3-11"></a><span class="w">          </span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_uv</span><span class="p">;</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#homework1-task6-__codelineno-3-12"></a><span class="w">          </span><span class="n">sp</span><span class="p">.</span><span class="n">p_dx_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_dx_uv</span><span class="p">;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#homework1-task6-__codelineno-3-13"></a><span class="w">          </span><span class="n">sp</span><span class="p">.</span><span class="n">p_dy_uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_dy_uv</span><span class="p">;</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#homework1-task6-__codelineno-3-14"></a><span class="w">          </span><span class="n">sp</span><span class="p">.</span><span class="n">lsm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsm</span><span class="p">;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#homework1-task6-__codelineno-3-15"></a><span class="w">          </span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">psm</span><span class="p">;</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#homework1-task6-__codelineno-3-16"></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#homework1-task6-__codelineno-3-17"></a><span class="w">          </span><span class="c1">// call the tex.sample function</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#homework1-task6-__codelineno-3-18"></a><span class="w">          </span><span class="n">current_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tex</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sp</span><span class="p">);</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#homework1-task6-__codelineno-3-19"></a>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#homework1-task6-__codelineno-3-20"></a><span class="w">          </span><span class="c1">// fill the corresponding buffer</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#homework1-task6-__codelineno-3-21"></a><span class="w">          </span><span class="n">sample_buffer</span><span class="p">[</span><span class="n">current_y_position</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zoom_coefficient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">current_x_position</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_color</span><span class="p">;</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#homework1-task6-__codelineno-3-22"></a>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#homework1-task6-__codelineno-3-23"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>The <code>SampleParams</code> object is then passed to the level sampling process, which will finish the sample process and return the color of the sample pixel. The final step is to fill the corresponding buffer with the returned color.</p>
<h3 id="homework1-task6-sampler">Sampler</h3>
<p>The sampler requires a continuous mipmap level value to implement nearest level and interpolation sampling. This is done by <code>get_level</code> function.</p>
<p>The calculation process follows the method discussed in the methodology section. Noting that the texture coordinates should be scaled to the texture size.</p>
<p>The calculated level is only valid in the range of the mipmap levels. In the case of texture minification, the calculated level could be negative and need to be clamped to 0. In extreme cases, the calculated level could be larger than the number of mipmap levels and need to be clamped to the largest level.</p>
<p>To avoid calculating the largest level every time, the largest level is stored in the <code>Texture</code> class as a member variable.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework1-task6-__codelineno-4-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Texture</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework1-task6-__codelineno-4-2"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework1-task6-__codelineno-4-3"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework1-task6-__codelineno-4-4"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">MipLevel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mipmap</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework1-task6-__codelineno-4-5"></a><span class="hll"><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">numSubLevels</span><span class="p">;</span>
</span></span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#homework1-task6-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#homework1-task6-__codelineno-4-7"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">pixels</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="o">&amp;</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#homework1-task6-__codelineno-4-8"></a><span class="w">    </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="p">;</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#homework1-task6-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#homework1-task6-__codelineno-4-10"></a><span class="w">    </span><span class="c1">// A fancy C++11 feature. emplace_back constructs the element in place,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#homework1-task6-__codelineno-4-11"></a><span class="w">    </span><span class="c1">// and in this case it uses the new {} list constructor syntax.</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#homework1-task6-__codelineno-4-12"></a><span class="w">    </span><span class="n">mipmap</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">MipLevel</span><span class="p">{</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">pixels</span><span class="p">});</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#homework1-task6-__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#homework1-task6-__codelineno-4-14"></a><span class="w">    </span><span class="n">generate_mips</span><span class="p">();</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#homework1-task6-__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#homework1-task6-__codelineno-4-16"></a><span class="hll"><span class="w">    </span><span class="n">numSubLevels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">log2f</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">)));</span>
</span></span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#homework1-task6-__codelineno-4-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#homework1-task6-__codelineno-4-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Combining all these considerations, the <code>get_level</code> function is implemented as follows:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework1-task6-__codelineno-5-1"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">Texture::get_level</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SampleParams</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework1-task6-__codelineno-5-2"></a><span class="w">    </span><span class="c1">// TODO: Task 6: Fill this in.</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework1-task6-__codelineno-5-3"></a><span class="w">    </span><span class="c1">// calculate the level of the mipmap to sample from</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework1-task6-__codelineno-5-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Lx</span><span class="p">,</span><span class="w"> </span><span class="n">Ly</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#homework1-task6-__codelineno-5-5"></a><span class="w">    </span><span class="n">Lx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">((</span><span class="n">sp</span><span class="p">.</span><span class="n">p_dx_uv</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">((</span><span class="n">sp</span><span class="p">.</span><span class="n">p_dx_uv</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#homework1-task6-__codelineno-5-6"></a><span class="w">    </span><span class="n">Ly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">((</span><span class="n">sp</span><span class="p">.</span><span class="n">p_dy_uv</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">((</span><span class="n">sp</span><span class="p">.</span><span class="n">p_dy_uv</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#homework1-task6-__codelineno-5-7"></a><span class="w">    </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">Lx</span><span class="p">,</span><span class="w"> </span><span class="n">Ly</span><span class="p">);</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#homework1-task6-__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#homework1-task6-__codelineno-5-9"></a><span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#homework1-task6-__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#homework1-task6-__codelineno-5-11"></a><span class="w">    </span><span class="c1">// in texture magnification, many pixels are mapped to one texel, so the level should be 0</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#homework1-task6-__codelineno-5-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">D</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#homework1-task6-__codelineno-5-13"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#homework1-task6-__codelineno-5-14"></a><span class="w">      </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#homework1-task6-__codelineno-5-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#homework1-task6-__codelineno-5-16"></a>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#homework1-task6-__codelineno-5-17"></a><span class="w">    </span><span class="c1">// in extreme texture minification, one texel is mapped to many pixels, so the level should be the maximum level</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#homework1-task6-__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#homework1-task6-__codelineno-5-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">D</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">numSubLevels</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#homework1-task6-__codelineno-5-20"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#homework1-task6-__codelineno-5-21"></a><span class="w">      </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numSubLevels</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#homework1-task6-__codelineno-5-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#homework1-task6-__codelineno-5-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">D</span><span class="p">;</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#homework1-task6-__codelineno-5-24"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p>The rest part of the sampler is straightforward, which uses several <code>if</code> statements to cover all sample combinations.</p>
<p>Always sample at 0 level:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework1-task6-__codelineno-6-1"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">lsm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">L_ZERO</span><span class="p">)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#homework1-task6-__codelineno-6-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#homework1-task6-__codelineno-6-3"></a><span class="w">      </span><span class="c1">// sample from mipmap level 0</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#homework1-task6-__codelineno-6-4"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">P_NEAREST</span><span class="p">)</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#homework1-task6-__codelineno-6-5"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#homework1-task6-__codelineno-6-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sample_nearest</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#homework1-task6-__codelineno-6-7"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#homework1-task6-__codelineno-6-8"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">P_LINEAR</span><span class="p">)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#homework1-task6-__codelineno-6-9"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#homework1-task6-__codelineno-6-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sample_bilinear</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#homework1-task6-__codelineno-6-11"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#homework1-task6-__codelineno-6-12"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#homework1-task6-__codelineno-6-13"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#homework1-task6-__codelineno-6-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#homework1-task6-__codelineno-6-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#homework1-task6-__codelineno-6-16"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div></p>
<p>Nearest level sampling:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework1-task6-__codelineno-7-1"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">lsm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">L_NEAREST</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework1-task6-__codelineno-7-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#homework1-task6-__codelineno-7-3"></a><span class="w">      </span><span class="c1">// sample from the nearest mipmap level</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#homework1-task6-__codelineno-7-4"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">round</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">));</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#homework1-task6-__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#homework1-task6-__codelineno-7-6"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">P_NEAREST</span><span class="p">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#homework1-task6-__codelineno-7-7"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#homework1-task6-__codelineno-7-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sample_nearest</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="p">);</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#homework1-task6-__codelineno-7-9"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#homework1-task6-__codelineno-7-10"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">P_LINEAR</span><span class="p">)</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#homework1-task6-__codelineno-7-11"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#homework1-task6-__codelineno-7-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sample_bilinear</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="p">);</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#homework1-task6-__codelineno-7-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#homework1-task6-__codelineno-7-14"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#homework1-task6-__codelineno-7-15"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#homework1-task6-__codelineno-7-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#homework1-task6-__codelineno-7-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#homework1-task6-__codelineno-7-18"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div></p>
<p>Nearest level with interpolation sampling:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework1-task6-__codelineno-8-1"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">lsm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">L_LINEAR</span><span class="p">)</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#homework1-task6-__codelineno-8-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#homework1-task6-__codelineno-8-3"></a><span class="w">      </span><span class="c1">// sample from the two nearest mipmap levels and linearly interpolate</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#homework1-task6-__codelineno-8-4"></a><span class="w">      </span><span class="n">Color</span><span class="w"> </span><span class="n">c0</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#homework1-task6-__codelineno-8-5"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">P_NEAREST</span><span class="p">)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#homework1-task6-__codelineno-8-6"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#homework1-task6-__codelineno-8-7"></a><span class="w">        </span><span class="n">c0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_nearest</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)));</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#homework1-task6-__codelineno-8-8"></a><span class="w">        </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_nearest</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)));</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#homework1-task6-__codelineno-8-9"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#homework1-task6-__codelineno-8-10"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">psm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">P_LINEAR</span><span class="p">)</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#homework1-task6-__codelineno-8-11"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#homework1-task6-__codelineno-8-12"></a><span class="w">        </span><span class="n">c0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_bilinear</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)));</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#homework1-task6-__codelineno-8-13"></a><span class="w">        </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_bilinear</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">p_uv</span><span class="p">,</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)));</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#homework1-task6-__codelineno-8-14"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#homework1-task6-__codelineno-8-15"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#homework1-task6-__codelineno-8-16"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#homework1-task6-__codelineno-8-17"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#homework1-task6-__codelineno-8-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#homework1-task6-__codelineno-8-19"></a><span class="w">      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">get_level</span><span class="p">(</span><span class="n">sp</span><span class="p">)));</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#homework1-task6-__codelineno-8-20"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#homework1-task6-__codelineno-8-21"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
Where <code>c0</code> and <code>c1</code> are the colors of the two nearest mipmap levels, and <code>result</code> is the final color of the sample pixel. Two nearest levels are determined by the <code>floor</code> and <code>ceil</code> function.</p>
<h2 id="homework1-task6-results">Results</h2>
<p>A carefully selected example is used to demonstrate the effect of level sampling. The original texture is a 3840 * 2160 resolution screenshot of the computer game <em>Atomic Heart</em>.</p>
<figure>
  <a class="glightbox" href="../images/hw1/hw1task6_atomicheart2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Original Texture" src="../images/hw1/hw1task6_atomicheart2.png" width="90%\textwidth" /></a>
</figure>
<p>SVG <code>svg/texmap/test6.svg</code>is modified and stored as <code>docs/test6.svg</code> to apply the texture.</p>
<p>To recode the rasterizing time of SVG, <code>clock</code> function is applied to the draw end. The rasterization time of each sampling combination is recorded.</p>
<p>The following figures show the rasterization option of <em>(level 0 sampling, nearest sampling, sample rate 1)</em> and <em>(level 0 sampling, nearest sampling, sample rate 16)</em>. The left figure is the simplest case without any particular sampling technique, and the other one is used as an example of no aliasing.</p>
<p><a class="glightbox" href="../images/hw1/hw1task6_l0_nearest_ss1_0.013008.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Level 0, Nearest, 1" src="../images/hw1/hw1task6_l0_nearest_ss1_0.013008.png" width="48%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task6_I0_nearest_ss16_0.07369.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Level 0, Nearest, 16" src="../images/hw1/hw1task6_I0_nearest_ss16_0.07369.png" width="48%\textwidth" /></a></p>
<p>While the left one is aliased, it only takes <code>0.013008</code> seconds to rasterize. The right one is much smoother, but it takes <code>0.07369</code> seconds to rasterize. The rasterization time is increased by 5.66 times.</p>
<p>The following figures shows the effect of level sampling. The left figure has option <em>(nearest level sampling, nearest sampling, sample rate 1)</em> and the right one has option <em>(nearest level with interpolation sampling, nearest sampling, sample rate 1)</em>. The rasterization time of the two is <code>0.007655</code> and <code>0.017561</code> seconds respectively.</p>
<p><a class="glightbox" href="../images/hw1/hw1task6_nl_nearest_ss1_0.007655.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Nearest Level, Nearest, 1" src="../images/hw1/hw1task6_nl_nearest_ss1_0.007655.png" width="48%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1tast6_bl_nearest_ss1_0.017561.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Nearest Level with Interpolation, Nearest, 1" src="../images/hw1/hw1tast6_bl_nearest_ss1_0.017561.png" width="48%\textwidth" /></a></p>
<p>With nearest-level sampling, as the mipmap texture size is reduced, the rasterization time is even less than the original texture. While nearest-level sampling removed aliasing, because the texture level does not match precisely with the sample pixel's level, the text is blurred. By contrast, nearest level with interpolation sampling has a smoother result, but the rasterization time is increased by 2.3 times, which achieves a balance between the quality and the speed.</p>
<p>If level sampling technique is combined with bilinear sampling, the result is even better. The following figures show the comparison of trilinear sampling(left) and supersampling with sample rate 16(right).</p>
<p><a class="glightbox" href="../images/hw1/hw1task6_bl_bilinear_ss1_0.031648.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Trilinear Sampling, sample rate 1" src="../images/hw1/hw1task6_bl_bilinear_ss1_0.031648.png" width="48%\textwidth" /></a>
<a class="glightbox" href="../images/hw1/hw1task6_I0_nearest_ss16_0.07369.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Super Sampling, sample rate 16" src="../images/hw1/hw1task6_I0_nearest_ss16_0.07369.png" width="48%\textwidth" /></a></p>
<p>The rasterization time of the two is <code>0.031648</code> and <code>0.07369</code> seconds respectively. The trilinear takes only half of the time of super sampling, while the result is similar.</p>
<h2 id="homework1-task6-conclusion">Conclusion</h2>
<p>Level sampling is introduced to solve the aliasing problem in texture magnification and minification without the need for expensive supersampling. </p>
<p>Nearest-level sampling is one simple approach, because of the minification of the texture, the rasterization time is even less than the original texture, as well as the memory consumption. It can remove aliasing, but result might be blurred as the texture level does not match precisely with the sample pixel's level.</p>
<p>Nearest level with interpolation sampling has a smoother result, but loading two nearest levels and linearly interpolating color requires more time and memory. Based on the test, it achieves a balance between the quality and the speed.</p>
<p>Level sampling techniques can be combined with bilinear sampling to achieve even better results. For example, in our test, trilinear sampling achieves the best result along all sample combinations except for supersampling. While the rasterization time is also the second longest, it is trivial when compared to the time of supersampling, and the memory consumption is close to nearest level with interpolation sampling.</p></section><h1 class='nav-section-title-end'>Ended: Homework1</h1>
                        <h1 class='nav-section-title' id='section-homework2'>
                            Homework2 <a class='headerlink' href='#section-homework2' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="homework2-overview"><h1 id="homework2-overview-homework2-meshedit-overview">Homework2: Meshedit Overview</h1>
<h2 id="homework2-overview-overview">Overview</h2>
<p>From this homework, we learned and practiced the following concepts:
- <strong>Halfedge Mesh</strong>: We implemented a halfedge mesh data structure and various operations on it.
- <strong>MeshEdit</strong>: We implemented various mesh editing operations, such as edge flip, edge split, and vertex split.
- <strong>Bezier Curve and Patch</strong>: We implemented the de Casteljau's algorithm to evaluate points on a Bézier curve and patch.</p>
<p>Besides key concepts, throughout the homework, we also learned about the following:
- <strong>Debugging large codebase</strong>: We learned how to debug a large, unfamiliar codebase.
- <strong>Code organization</strong>: We learned how to make code more readable and maintainable.</p>
<h2 id="homework2-overview-updates-to-the-website">Updates to the website</h2>
<p>We implemented the following updates to the website:
- Added <code>.csv</code> table support
- Added print webpage button for each page</p>
<details class="warning">
<summary>Note for PDF</summary>
<p>Some features of the website, such as picture lightbox, may not be available in the PDF version. We recommend reading the <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-RuhaoT">website</a> directly for the best experience.</p>
</details></section>
                        <h2 class='nav-section-title' id='section-section1'>
                            Section1 <a class='headerlink' href='#section-section1' title='Permanent link'>↵</a>
                        </h2>
                        <section class="print-page" id="homework2-section1-part1"><h1 id="homework2-section1-part1-part-1-bezier-curves-with-1d-de-casteljau-subdivision">Part 1: Bezier Curves with 1D de Casteljau Subdivision</h1>
<h2 id="homework2-section1-part1-methodology">Methodology</h2>
<p>de Casteljau's algorithm is a recursive algorithm that can be used to evaluate a Bezier curve. A Bezier curve is defined by a set of control points, and the curve itself is a linear combination of these control points. Assuming <span class="arithmatex">\(t\)</span> to be the proportion of the curve that has been traversed, this algorithm can find the corresponding point's position <span class="arithmatex">\(B(t)\)</span> from the curve.</p>
<p>The de Casteljau's algorithm can be described as follows:</p>
<ol>
<li>
<p>Given a set of control points <span class="arithmatex">\(P_0, P_1, \dots, P_n\)</span>, an empty intermediate point set <span class="arithmatex">\(Q\)</span> and a parameter <span class="arithmatex">\(t\)</span>. Set <span class="arithmatex">\(Q = P\)</span>.</p>
</li>
<li>
<p>Check if the length of <span class="arithmatex">\(Q\)</span> is 1. If so, return the only point in <span class="arithmatex">\(Q\)</span>.</p>
</li>
<li>
<p>Otherwise, for each pair of points <span class="arithmatex">\(Q_i, Q_{i+1}\)</span> in <span class="arithmatex">\(Q\)</span>, calculate the point by linear interpolating:</p>
</li>
</ol>
<div class="arithmatex">\[
Q'_i = (1-t)Q_i + tQ_{i+1}.
\]</div>
<ol>
<li>Set <span class="arithmatex">\(Q = Q'\)</span> and repeat from step 2.</li>
</ol>
<p>Among each loop, the number of points in <span class="arithmatex">\(Q\)</span> will decrease by 1, and the last point in <span class="arithmatex">\(Q\)</span> will be the point on the Bezier curve. To draw a Bezier curve, we can progressively evaluate the curve at different <span class="arithmatex">\(t\)</span> values and connect the points together.</p>
<figure>
  <a class="glightbox" href="https://upload.wikimedia.org/wikipedia/commons/d/db/B%C3%A9zier_3_big.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Use de Casteljau's algorithm to draw Bezier curve" src="https://upload.wikimedia.org/wikipedia/commons/d/db/B%C3%A9zier_3_big.gif" width="90%\textwidth" /></a>
</figure>
<h2 id="homework2-section1-part1-implementation">Implementation</h2>
<p>In this task, we are required to implement the interpolate function of de Casteljau's algorithm. The function takes a list of intermediate points and a parameter <code>t</code>, and returns the new intermediate points after interpolation.</p>
<p>The implementation idea is simple: for each pair of points in the input <code>points</code> vector, calculate the intermediate point and store it in the <code>result</code> vector:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework2-section1-part1-__codelineno-0-1"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector2D</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BezierCurve</span><span class="o">::</span><span class="n">evaluateStep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector2D</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">points</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework2-section1-part1-__codelineno-0-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework2-section1-part1-__codelineno-0-3"></a><span class="w">    </span><span class="c1">// TODO Part 1.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework2-section1-part1-__codelineno-0-4"></a><span class="w">    </span><span class="c1">// Implement by Ruhao Tian starts here</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework2-section1-part1-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework2-section1-part1-__codelineno-0-6"></a><span class="w">    </span><span class="c1">// Create a vector iterator</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework2-section1-part1-__codelineno-0-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector2D</span><span class="o">&gt;::</span><span class="n">const_iterator</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework2-section1-part1-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework2-section1-part1-__codelineno-0-9"></a><span class="w">    </span><span class="c1">// Create a empty vector to store the result</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#homework2-section1-part1-__codelineno-0-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector2D</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#homework2-section1-part1-__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#homework2-section1-part1-__codelineno-0-12"></a><span class="w">    </span><span class="c1">// Loop through the points and calculate the intermediate points</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#homework2-section1-part1-__codelineno-0-13"></a><span class="w">    </span><span class="c1">// iterater should stop at the second last point</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#homework2-section1-part1-__codelineno-0-14"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="n">end</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#homework2-section1-part1-__codelineno-0-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#homework2-section1-part1-__codelineno-0-16"></a><span class="w">      </span><span class="c1">// Calculate the intermediate point</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#homework2-section1-part1-__codelineno-0-17"></a><span class="w">      </span><span class="n">Vector2D</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#homework2-section1-part1-__codelineno-0-18"></a><span class="w">      </span><span class="c1">// Add the intermediate point to the result vector</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#homework2-section1-part1-__codelineno-0-19"></a><span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">intermediate</span><span class="p">);</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#homework2-section1-part1-__codelineno-0-20"></a><span class="w">      </span><span class="c1">// Move the iterator to the next point</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#homework2-section1-part1-__codelineno-0-21"></a><span class="w">      </span><span class="n">it</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#homework2-section1-part1-__codelineno-0-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#homework2-section1-part1-__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#homework2-section1-part1-__codelineno-0-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#homework2-section1-part1-__codelineno-0-25"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<h2 id="homework2-section1-part1-results">Results</h2>
<p>A 6-point Bezier curve is created to test the implementation:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework2-section1-part1-__codelineno-1-1"></a>6
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework2-section1-part1-__codelineno-1-2"></a>0.200 0.350   0.300 0.600   0.500 0.750   0.700 0.450  1.000 0.900   0.800 0.800
</span></code></pre></div>
<p>The figures below show the drawn curve as well as levels of evaluation. The left one is the curve without moving control points, and the right one is the curve with control points manually moved.</p>
<p><a class="glightbox" href="../images/hw2/section1/hw2part1_curve3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="original curve" src="../images/hw2/section1/hw2part1_curve3.png" width="49%\textwidth" /></a> 
<a class="glightbox" href="../images/hw2/section1/hw2part1_curve3moved.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="moved curve" src="../images/hw2/section1/hw2part1_curve3moved.png" width="49%\textwidth" /></a></p></section><section class="print-page" id="homework2-section1-part2"><h1 id="homework2-section1-part2-part2-bezier-surfaces-with-separable-1d-de-casteljau">Part2: Bezier Surfaces with Separable 1D de Casteljau</h1>
<h2 id="homework2-section1-part2-methodology">Methodology</h2>
<p>The main way to use de Casteljau's algorithm on the surface is: 
First, split the two-dimensional control point matrix into n one-dimensional matrices. Then, apply a method similar to Part 1 to each of these n one-dimensional matrices, obtaining coordinates for n points. Finally, use these n points coordinates for one more calculation to get the target point.</p>
<p>The detailed steps are listed as follows:</p>
<ol>
<li>
<p>Given a two-dimensional control point matrix P (n rows and m columns). Split the two-dimensional control point matrix into n rows.</p>
</li>
<li>
<p>Apply the de Casteljau's algorithm separately to these n columns, and iterate m-1 times to obtain n final points. This operation is similar to Part 1, where n control points and parameter <span class="arithmatex">\(t\)</span> are used to obtain points on the Bézier curve, except here the parameter is <span class="arithmatex">\(u\)</span>.</p>
</li>
<li>
<p>Use these n points to perform the same operation(parameter is <span class="arithmatex">\(v\)</span>), obtaining a point that lies on the Bézier patch.</p>
</li>
</ol>
<p>Summary: A total of <span class="arithmatex">\(n * (m-1) + 1\)</span> iterations are required. There are n columns in total, each column requires m-1 iterations. Finally, the n points are iterated once more.</p>
<h2 id="homework2-section1-part2-implementation">Implementation</h2>
<p>The task requires returning a point that lies on the Bézier surface.</p>
<p>First, evaluates one step of de Casteljau's algorithm using the given points and the scalar parameter t.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework2-section1-part2-__codelineno-0-1"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3D</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BezierPatch</span><span class="o">::</span><span class="n">evaluateStep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3D</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework2-section1-part2-__codelineno-0-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework2-section1-part2-__codelineno-0-3"></a><span class="w">    </span><span class="c1">// TODO Part 2.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework2-section1-part2-__codelineno-0-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3D</span><span class="o">&gt;</span><span class="n">newPoints</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework2-section1-part2-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework2-section1-part2-__codelineno-0-6"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework2-section1-part2-__codelineno-0-7"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">points</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="mi">-1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework2-section1-part2-__codelineno-0-8"></a><span class="w">      </span><span class="n">x</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework2-section1-part2-__codelineno-0-9"></a><span class="w">      </span><span class="n">y</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#homework2-section1-part2-__codelineno-0-10"></a><span class="w">      </span><span class="n">z</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#homework2-section1-part2-__codelineno-0-11"></a><span class="w">      </span><span class="n">newPoints</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">);</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#homework2-section1-part2-__codelineno-0-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#homework2-section1-part2-__codelineno-0-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">newPoints</span><span class="p">;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#homework2-section1-part2-__codelineno-0-14"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<p>Second, fully evaluates de Casteljau's algorithm for a vector of points at scalar parameter t.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework2-section1-part2-__codelineno-1-1"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="nf">BezierPatch::evaluate1D</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3D</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework2-section1-part2-__codelineno-1-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework2-section1-part2-__codelineno-1-3"></a><span class="w">    </span><span class="c1">// TODO Part 2.</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework2-section1-part2-__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework2-section1-part2-__codelineno-1-5"></a><span class="w">    </span><span class="c1">//Below is for iteration. If its size==1, it is the goal point.</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework2-section1-part2-__codelineno-1-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3D</span><span class="o">&gt;</span><span class="n">operatePoints</span><span class="o">=</span><span class="n">points</span><span class="p">;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework2-section1-part2-__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework2-section1-part2-__codelineno-1-8"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#homework2-section1-part2-__codelineno-1-9"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">operatePoints</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#homework2-section1-part2-__codelineno-1-10"></a><span class="w">      </span><span class="n">operatePoints</span><span class="o">=</span><span class="n">evaluateStep</span><span class="p">(</span><span class="n">operatePoints</span><span class="p">,</span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#homework2-section1-part2-__codelineno-1-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#homework2-section1-part2-__codelineno-1-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">operatePoints</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#homework2-section1-part2-__codelineno-1-13"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<p>Finally, evaluate the Bezier patch at parameter (u, v)
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework2-section1-part2-__codelineno-2-1"></a><span class="n">Vector3D</span><span class="w"> </span><span class="nf">BezierPatch::evaluate</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework2-section1-part2-__codelineno-2-2"></a><span class="w">  </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework2-section1-part2-__codelineno-2-3"></a><span class="w">    </span><span class="c1">// TODO Part 2.</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework2-section1-part2-__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework2-section1-part2-__codelineno-2-5"></a><span class="w">    </span><span class="c1">//Fully evaluate de Casteljau&#39;s algorithm for each row of the </span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#homework2-section1-part2-__codelineno-2-6"></a><span class="w">    </span><span class="c1">//two-dimensional control. Result is rowPoints.</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#homework2-section1-part2-__codelineno-2-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vector3D</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rowPoints</span><span class="p">;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#homework2-section1-part2-__codelineno-2-8"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">controlPoints</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#homework2-section1-part2-__codelineno-2-9"></a><span class="w">      </span><span class="n">rowPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">evaluate1D</span><span class="p">(</span><span class="n">controlPoints</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">u</span><span class="p">));</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#homework2-section1-part2-__codelineno-2-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#homework2-section1-part2-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#homework2-section1-part2-__codelineno-2-12"></a><span class="w">    </span><span class="c1">//Fully evaluate de Casteljau&#39;s algorithm for rowPoints</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#homework2-section1-part2-__codelineno-2-13"></a><span class="w">    </span><span class="c1">//Result is patchPoint(the goal)</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#homework2-section1-part2-__codelineno-2-14"></a><span class="w">    </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">patchPoint</span><span class="p">;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#homework2-section1-part2-__codelineno-2-15"></a><span class="w">    </span><span class="n">patchPoint</span><span class="o">=</span><span class="n">evaluate1D</span><span class="p">(</span><span class="n">rowPoints</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#homework2-section1-part2-__codelineno-2-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">patchPoint</span><span class="p">;</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#homework2-section1-part2-__codelineno-2-17"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<h2 id="homework2-section1-part2-results">Results</h2>
<p>The figures below show the drawn picture of the teapot.bez</p>
<p><a class="glightbox" href="../images/hw2/section1/hw2part2_teapot.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="original curve" src="../images/hw2/section1/hw2part2_teapot.png" width="49%\textwidth" /></a> </p></section><h1 class='nav-section-title-end'>Ended: Section1</h1>
                        <h2 class='nav-section-title' id='section-section2'>
                            Section2 <a class='headerlink' href='#section-section2' title='Permanent link'>↵</a>
                        </h2>
                        <section class="print-page" id="homework2-section2-part3"><h1 id="homework2-section2-part3-part-3-area-weighted-vertex-normals">Part 3: Area-Weighted Vertex Normals</h1>
<h2 id="homework2-section2-part3-methodology">Methodology</h2>
<p>Given a vertex on the mesh, the normal vector of the vertex is the average of the normal vectors of all the triangles that share the vertex. Assume <span class="arithmatex">\(N_0, N_1, \dots, N_k\)</span> are the normal vectors of the triangles that share the vertex, the normal vector of the vertex is calculated as follows:</p>
<div class="arithmatex">\[
N = \frac{N_0 * A_0 + N_1 * A_1 + \dots + N_k * A_k}{||N_0 * A_0 + N_1 * A_1 + \dots + N_k * A_k||}
\]</div>
<p>where <span class="arithmatex">\(A_0, A_1, \dots, A_k\)</span> are the areas of the triangles that share the vertex. The normal vector is normalized to ensure it has a unit length.</p>
<h2 id="homework2-section2-part3-implementation">Implementation</h2>
<p>The general idea is to iterate through all faces and calculate the normal vector and area of each face. In halfedge data structure, each face has a corresponding halfedge, and visiting the next face counter-clockwise is equal to visiting its half edge:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework2-section2-part3-__codelineno-0-1"></a><span class="n">next_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span></code></pre></div>
<p>And when <code>current_halfedge == start_halfedge</code>, the iteration is finished.</p>
<p>For each face, the normal vector can be obtained by the provided <code>normal</code> function:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework2-section2-part3-__codelineno-1-1"></a><span class="n">current_face_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">face</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">normal</span><span class="p">();</span>
</span></code></pre></div></p>
<p>To calculate the area of the face, first, the three vertices of the face are obtained:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework2-section2-part3-__codelineno-2-1"></a><span class="w">      </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework2-section2-part3-__codelineno-2-2"></a><span class="w">      </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework2-section2-part3-__codelineno-2-3"></a><span class="w">      </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span></code></pre></div></p>
<p>Then the area of the face is calculated by the cross product of two edges of the face:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework2-section2-part3-__codelineno-3-1"></a><span class="w">    </span><span class="n">current_face_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div></p>
<p>During the iteration, the normal vector and area of each face are accumulated to an intermediate normal vector, which will be normalized and returned when the iteration is finished:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework2-section2-part3-__codelineno-4-1"></a><span class="w">      </span><span class="n">intermediate_normal</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">current_face_normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">current_triangle_area</span><span class="p">;</span>
</span></code></pre></div></p>
<p>Putting all the pieces together, the implementation of the <code>normal</code> function is as follows:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework2-section2-part3-__codelineno-5-1"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="nf">Vertex::normal</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework2-section2-part3-__codelineno-5-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework2-section2-part3-__codelineno-5-3"></a><span class="w">    </span><span class="c1">// TODO Part 3.</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework2-section2-part3-__codelineno-5-4"></a><span class="w">    </span><span class="c1">// Returns an approximate unit normal at this vertex, computed by</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#homework2-section2-part3-__codelineno-5-5"></a><span class="w">    </span><span class="c1">// taking the area-weighted average of the normals of neighboring</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#homework2-section2-part3-__codelineno-5-6"></a><span class="w">    </span><span class="c1">// triangles, then normalizing.</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#homework2-section2-part3-__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#homework2-section2-part3-__codelineno-5-8"></a><span class="w">    </span><span class="c1">// Implementaion by Ruhao Tian starts here</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#homework2-section2-part3-__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#homework2-section2-part3-__codelineno-5-10"></a><span class="w">    </span><span class="c1">// Prepare intermediate variables</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#homework2-section2-part3-__codelineno-5-11"></a><span class="w">    </span><span class="n">HalfedgeCIter</span><span class="w"> </span><span class="n">current_halfedge</span><span class="p">,</span><span class="w"> </span><span class="n">start_halfedge</span><span class="p">,</span><span class="w"> </span><span class="n">next_halfedge</span><span class="p">;</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#homework2-section2-part3-__codelineno-5-12"></a><span class="w">    </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">intermediate_normal</span><span class="p">,</span><span class="n">current_face_normal</span><span class="p">;</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#homework2-section2-part3-__codelineno-5-13"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">current_triangle_area</span><span class="p">;</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#homework2-section2-part3-__codelineno-5-14"></a><span class="w">    </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#homework2-section2-part3-__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#homework2-section2-part3-__codelineno-5-16"></a><span class="w">    </span><span class="c1">// Initialize the normal vector</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#homework2-section2-part3-__codelineno-5-17"></a><span class="w">    </span><span class="n">intermediate_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#homework2-section2-part3-__codelineno-5-18"></a><span class="w">    </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">();</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#homework2-section2-part3-__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#homework2-section2-part3-__codelineno-5-20"></a><span class="w">    </span><span class="c1">// Loop through the halfedges of the vertex</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#homework2-section2-part3-__codelineno-5-21"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#homework2-section2-part3-__codelineno-5-22"></a><span class="w">      </span><span class="c1">// for safety, first obtain the next halfedge, although this is not mandatory</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#homework2-section2-part3-__codelineno-5-23"></a><span class="w">      </span><span class="n">next_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#homework2-section2-part3-__codelineno-5-24"></a>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#homework2-section2-part3-__codelineno-5-25"></a><span class="w">      </span><span class="c1">// obtain the face normal</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#homework2-section2-part3-__codelineno-5-26"></a><span class="w">      </span><span class="n">current_face_normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">face</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">normal</span><span class="p">();</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#homework2-section2-part3-__codelineno-5-27"></a>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#homework2-section2-part3-__codelineno-5-28"></a><span class="w">      </span><span class="c1">// calculate the area of the triangle</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#homework2-section2-part3-__codelineno-5-29"></a><span class="w">      </span><span class="c1">// first, obtain the three vertices position</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#homework2-section2-part3-__codelineno-5-30"></a><span class="w">      </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#homework2-section2-part3-__codelineno-5-31"></a><span class="w">      </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#homework2-section2-part3-__codelineno-5-32"></a><span class="w">      </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#homework2-section2-part3-__codelineno-5-33"></a><span class="w">      </span><span class="c1">// use the cross product to calculate the area</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#homework2-section2-part3-__codelineno-5-34"></a><span class="w">      </span><span class="n">current_triangle_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vertex_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#homework2-section2-part3-__codelineno-5-35"></a>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#homework2-section2-part3-__codelineno-5-36"></a><span class="w">      </span><span class="c1">// add the area-weighted normal to the intermediate normal</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#homework2-section2-part3-__codelineno-5-37"></a><span class="w">      </span><span class="n">intermediate_normal</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">current_face_normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">current_triangle_area</span><span class="p">;</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#homework2-section2-part3-__codelineno-5-38"></a>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#homework2-section2-part3-__codelineno-5-39"></a><span class="w">      </span><span class="c1">// move to the next halfedge</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#homework2-section2-part3-__codelineno-5-40"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_halfedge</span><span class="p">;</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#homework2-section2-part3-__codelineno-5-41"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">start_halfedge</span><span class="p">);</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#homework2-section2-part3-__codelineno-5-42"></a>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#homework2-section2-part3-__codelineno-5-43"></a><span class="w">    </span><span class="c1">// normalize the intermediate normal</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#homework2-section2-part3-__codelineno-5-44"></a><span class="w">    </span><span class="n">intermediate_normal</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#homework2-section2-part3-__codelineno-5-45"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">intermediate_normal</span><span class="p">;</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#homework2-section2-part3-__codelineno-5-46"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<h2 id="homework2-section2-part3-results">Results</h2>
<p>The left figure below is the screenshot of <code>dae/teapot.dae</code> without normal vector shading and the right one is the same mesh with normal vector shading enabled. Compared with the left one, figure implemented normal vector clearly has smoother shading.</p>
<div class="admonition info">
<p class="admonition-title">Image displayed size too small?</p>
<p>Click on the image to activate lightbox mode.
In lightbox mode, click on the arrows on the left and right to navigate through images. This brings easy comparison.</p>
</div>
<p><a class="glightbox" href="../images/hw2/section2/hw2part3_withoutnormal.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Without normal shading" src="../images/hw2/section2/hw2part3_withoutnormal.png" width="49%\textwidth" /></a>
<a class="glightbox" href="../images/hw2/section2/hw2part3_withnormal.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="With normal shading" src="../images/hw2/section2/hw2part3_withnormal.png" width="49%\textwidth" /></a></p></section><section class="print-page" id="homework2-section2-part4"><h1 id="homework2-section2-part4-part2-bezier-surfaces-with-separable-1d-de-casteljau">Part2: Bezier Surfaces with Separable 1D de Casteljau</h1>
<h2 id="homework2-section2-part4-methodology">Methodology</h2>
<p>Get the flip image by modifying the given halfedge and related parameter pointers. Below is an example of modifications made to a halfedge:</p>
<p>As shown in the diagram, we now need to modify the pointers related to the halfedge h.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part4_flip_halfedge.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="example_halfedge" src="../images/hw2/section2/hw2part4_flip_halfedge.png" width="49%\textwidth" /></a></p>
<p>After modification:
1. The starting point of the halfedge becomes A, and it points to D.
2. The twin() of the halfedge remains unchanged, but it now points to the modified halfedge in the opposite direction.
3. The next() of the halfedge becomes CB.
4. The face which the halfedge points to becomes ABC.</p>
<p>Similar operations will also be performed on vertices, faces, and so on. This includes but is not limited to, the following changes:
The half-edge pointed to by A becomes h.
The faces change from ABD, BCD to ABC, ACD.</p>
<p>The rest of the operations are very similar, so I won't go into further detail. But you can see any information in code.</p>
<h2 id="homework2-section2-part4-implementation">Implementation</h2>
<p>Before providing my code, I would like to explain the parameters:</p>
<ol>
<li>h is the h shown in the diagram.</li>
<li>th=h-&gt;twin()</li>
<li>h/th_next=h/th-&gt;next()</li>
<li>h/th_pre-&gt;next()=h/th
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework2-section2-part4-__codelineno-0-1"></a><span class="w">  </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="n">e0</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">();</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework2-section2-part4-__codelineno-0-2"></a><span class="w">  </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">th</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">();</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework2-section2-part4-__codelineno-0-3"></a><span class="w">  </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">h_next</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework2-section2-part4-__codelineno-0-4"></a><span class="w">  </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">th_next</span><span class="o">=</span><span class="n">th</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework2-section2-part4-__codelineno-0-5"></a><span class="w">  </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">h_pre</span><span class="o">=</span><span class="n">h_next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework2-section2-part4-__codelineno-0-6"></a><span class="w">  </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">th_pre</span><span class="o">=</span><span class="n">th_next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span></code></pre></div></li>
</ol>
<p>v1,v2,v3,v4 is A,B,C,D
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework2-section2-part4-__codelineno-1-1"></a><span class="w">  </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v1</span><span class="o">=</span><span class="n">h_pre</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework2-section2-part4-__codelineno-1-2"></a><span class="w">  </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v2</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework2-section2-part4-__codelineno-1-3"></a><span class="w">  </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v4</span><span class="o">=</span><span class="n">th_pre</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework2-section2-part4-__codelineno-1-4"></a><span class="w">  </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v3</span><span class="o">=</span><span class="n">th</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span></code></pre></div></p>
<p>Total solution code:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework2-section2-part4-__codelineno-2-1"></a><span class="n">EdgeIter</span><span class="w"> </span><span class="nf">HalfedgeMesh::flipEdge</span><span class="p">(</span><span class="w"> </span><span class="n">EdgeIter</span><span class="w"> </span><span class="n">e0</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework2-section2-part4-__codelineno-2-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework2-section2-part4-__codelineno-2-3"></a><span class="w">    </span><span class="c1">// TODO Part 4.</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework2-section2-part4-__codelineno-2-4"></a><span class="w">    </span><span class="c1">// This method should flip the given edge and return an iterator to the flipped edge.</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework2-section2-part4-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#homework2-section2-part4-__codelineno-2-6"></a><span class="w">    </span><span class="c1">//edge is not allowed</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#homework2-section2-part4-__codelineno-2-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">e0</span><span class="o">-&gt;</span><span class="n">isBoundary</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">e0</span><span class="p">;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#homework2-section2-part4-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#homework2-section2-part4-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#homework2-section2-part4-__codelineno-2-10"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="n">e0</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">();</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#homework2-section2-part4-__codelineno-2-11"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">th</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">();</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#homework2-section2-part4-__codelineno-2-12"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">h_next</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#homework2-section2-part4-__codelineno-2-13"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">th_next</span><span class="o">=</span><span class="n">th</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#homework2-section2-part4-__codelineno-2-14"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">h_pre</span><span class="o">=</span><span class="n">h_next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#homework2-section2-part4-__codelineno-2-15"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">th_pre</span><span class="o">=</span><span class="n">th_next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#homework2-section2-part4-__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#homework2-section2-part4-__codelineno-2-17"></a><span class="w">    </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v1</span><span class="o">=</span><span class="n">h_pre</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#homework2-section2-part4-__codelineno-2-18"></a><span class="w">    </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v2</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#homework2-section2-part4-__codelineno-2-19"></a><span class="w">    </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v4</span><span class="o">=</span><span class="n">th_pre</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#homework2-section2-part4-__codelineno-2-20"></a><span class="w">    </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v3</span><span class="o">=</span><span class="n">th</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#homework2-section2-part4-__codelineno-2-21"></a>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#homework2-section2-part4-__codelineno-2-22"></a><span class="w">    </span><span class="n">FaceIter</span><span class="w"> </span><span class="n">f1</span><span class="o">=</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">face</span><span class="p">();</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#homework2-section2-part4-__codelineno-2-23"></a><span class="w">    </span><span class="n">FaceIter</span><span class="w"> </span><span class="n">f2</span><span class="o">=</span><span class="n">th</span><span class="o">-&gt;</span><span class="n">face</span><span class="p">();</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#homework2-section2-part4-__codelineno-2-24"></a>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#homework2-section2-part4-__codelineno-2-25"></a><span class="w">    </span><span class="c1">//change the halfedge pointer</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#homework2-section2-part4-__codelineno-2-26"></a><span class="w">    </span><span class="n">h</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">th_pre</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">(),</span><span class="n">f1</span><span class="p">);</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#homework2-section2-part4-__codelineno-2-27"></a><span class="w">    </span><span class="n">th_pre</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">h_next</span><span class="p">,</span><span class="n">th_pre</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">v4</span><span class="p">,</span><span class="n">th_pre</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">(),</span><span class="n">f1</span><span class="p">);</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#homework2-section2-part4-__codelineno-2-28"></a><span class="w">    </span><span class="n">h_next</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h_next</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">v3</span><span class="p">,</span><span class="n">h_next</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">(),</span><span class="n">f1</span><span class="p">);</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#homework2-section2-part4-__codelineno-2-29"></a><span class="w">    </span><span class="n">th</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">h_pre</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">(),</span><span class="n">f2</span><span class="p">);</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#homework2-section2-part4-__codelineno-2-30"></a><span class="w">    </span><span class="n">h_pre</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">th_next</span><span class="p">,</span><span class="n">h_pre</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">v1</span><span class="p">,</span><span class="n">h_pre</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">(),</span><span class="n">f2</span><span class="p">);</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#homework2-section2-part4-__codelineno-2-31"></a><span class="w">    </span><span class="n">th_next</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">th</span><span class="p">,</span><span class="n">th_next</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">v2</span><span class="p">,</span><span class="n">th_next</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">(),</span><span class="n">f2</span><span class="p">);</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#homework2-section2-part4-__codelineno-2-32"></a>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#homework2-section2-part4-__codelineno-2-33"></a><span class="w">    </span><span class="c1">//change the vertex pointer</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#homework2-section2-part4-__codelineno-2-34"></a><span class="w">    </span><span class="n">v1</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">=</span><span class="n">h</span><span class="p">;</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#homework2-section2-part4-__codelineno-2-35"></a><span class="w">    </span><span class="n">v2</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">=</span><span class="n">th_next</span><span class="p">;</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#homework2-section2-part4-__codelineno-2-36"></a><span class="w">    </span><span class="n">v3</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">=</span><span class="n">h_next</span><span class="p">;</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#homework2-section2-part4-__codelineno-2-37"></a><span class="w">    </span><span class="n">v4</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">=</span><span class="n">th</span><span class="p">;</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#homework2-section2-part4-__codelineno-2-38"></a>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#homework2-section2-part4-__codelineno-2-39"></a>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#homework2-section2-part4-__codelineno-2-40"></a><span class="w">    </span><span class="c1">//change the face pointer</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#homework2-section2-part4-__codelineno-2-41"></a><span class="w">    </span><span class="n">f1</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">=</span><span class="n">h</span><span class="p">;</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#homework2-section2-part4-__codelineno-2-42"></a><span class="w">    </span><span class="n">f2</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">=</span><span class="n">th</span><span class="p">;</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#homework2-section2-part4-__codelineno-2-43"></a>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#homework2-section2-part4-__codelineno-2-44"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">e0</span><span class="p">;</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#homework2-section2-part4-__codelineno-2-45"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<h2 id="homework2-section2-part4-results">Results</h2>
<p>The figure below shows the original teapot.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part4_before_flip.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="before flip" src="../images/hw2/section2/hw2part4_before_flip.png" width="49%\textwidth" /></a> </p>
<p>The following image shows the teapot after flipping 4 edges. I have highlighted the modifications with a yellow highlighter.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part4_after_flip.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="after flip" src="../images/hw2/section2/hw2part4_after_flip.png" width="49%\textwidth" /></a> </p>
<h2 id="homework2-section2-part4-debug-experience">Debug experience</h2>
<p>I used to make a very simple but fatal problem, which I used HalfedgeCIter instead of HalfedgeIter. So, I found the program always occurred crashed. Finally, with the assistance of my partner and the ChatGPT, I noticed and understood the difference between CIter and Iter.</p></section><section class="print-page" id="homework2-section2-part5"><h1 id="homework2-section2-part5-part-5-edge-split">Part 5: Edge Split</h1>
<h2 id="homework2-section2-part5-methodology">Methodology</h2>
<p>The method of edge splitting is similar to Part 4, but it will be a bit more complex. This requires us to consider a new vertex and the 6 new halfedges that are created. We adjust their values and pointers to accomplish the edge split. Here is a simple example explaining the adjustment of pointers for the halfedge h and the new vertex E.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part5_example.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="example" src="../images/hw2/section2/hw2part5_example.png" width="49%\textwidth" /></a> </p>
<p>for h after modification:</p>
<ol>
<li>The starting point of the halfedge remains B, but it points to E now.</li>
<li>The twin() becomes the EB.</li>
<li>The next() of the halfedge becomes EA.</li>
<li>The face that the halfedge points to becomes ABE.</li>
</ol>
<p>for e after modification:</p>
<ol>
<li>Its position is descripted by <span class="arithmatex">\((E_x,E_y)=0.5*[(B_x,B_y)+(D_x,D_y)]\)</span></li>
<li>It points to ED.</li>
</ol>
<p>Similar operations will also be performed on vertices, faces, and so on. This includes, but is not limited to, the following changes:</p>
<ul>
<li>The half-edge pointed to by A becomes AE</li>
<li>Now there are four faces (ABE, AED, DEC, BEC)</li>
</ul>
<p>The rest of the operations are similar.</p>
<h2 id="homework2-section2-part5-implementation">Implementation</h2>
<p>Notations of the implementation are shown in the following figure:</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part5_notations.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="notations" src="../images/hw2/section2/hw2part5_notations.png" /></a></p>
<p>To assist coding, data structures and relevant values before and after the edge split are listed in the following tables.</p>
<p>For the halfedges:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">name</th>
<th style="text-align: left;">next</th>
<th style="text-align: left;">twin</th>
<th style="text-align: left;">vertex</th>
<th style="text-align: left;">edge</th>
<th style="text-align: left;">face</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">j</td>
<td style="text-align: left;">k</td>
<td style="text-align: left;">j_twin</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">ab</td>
<td style="text-align: left;">f1</td>
</tr>
<tr>
<td style="text-align: left;">k</td>
<td style="text-align: left;">l</td>
<td style="text-align: left;">o</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">bc</td>
<td style="text-align: left;">f1</td>
</tr>
<tr>
<td style="text-align: left;">l</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">l_twin</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">ca</td>
<td style="text-align: left;">f1</td>
</tr>
<tr>
<td style="text-align: left;">m</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">m_twin</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">bd</td>
<td style="text-align: left;">f2</td>
</tr>
<tr>
<td style="text-align: left;">n</td>
<td style="text-align: left;">o</td>
<td style="text-align: left;">n_twin</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">dc</td>
<td style="text-align: left;">f2</td>
</tr>
<tr>
<td style="text-align: left;">o</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">k</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">bc</td>
<td style="text-align: left;">f2</td>
</tr>
<tr>
<td style="text-align: left;">j‘</td>
<td style="text-align: left;">x</td>
<td style="text-align: left;">j_twin</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">ab</td>
<td style="text-align: left;">f3</td>
</tr>
<tr>
<td style="text-align: left;">k’</td>
<td style="text-align: left;">l</td>
<td style="text-align: left;">o</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">ec(bc)</td>
<td style="text-align: left;">f1</td>
</tr>
<tr>
<td style="text-align: left;">l‘</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">l_twin</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">ca</td>
<td style="text-align: left;">f1</td>
</tr>
<tr>
<td style="text-align: left;">m’</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">m_twin</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">bd</td>
<td style="text-align: left;">f4</td>
</tr>
<tr>
<td style="text-align: left;">n‘</td>
<td style="text-align: left;">o</td>
<td style="text-align: left;">n_twin</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">dc</td>
<td style="text-align: left;">f2</td>
</tr>
<tr>
<td style="text-align: left;">o’</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">k</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">ec(bc)</td>
<td style="text-align: left;">f2</td>
</tr>
<tr>
<td style="text-align: left;">p‘</td>
<td style="text-align: left;">k</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">ae</td>
<td style="text-align: left;">f1</td>
</tr>
<tr>
<td style="text-align: left;">q’</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">ae</td>
<td style="text-align: left;">f3</td>
</tr>
<tr>
<td style="text-align: left;">r‘</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">ed</td>
<td style="text-align: left;">f2</td>
</tr>
<tr>
<td style="text-align: left;">s’</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">ed</td>
<td style="text-align: left;">f4</td>
</tr>
<tr>
<td style="text-align: left;">x‘</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">be</td>
<td style="text-align: left;">f3</td>
</tr>
<tr>
<td style="text-align: left;">y’</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">x</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">be</td>
<td style="text-align: left;">f4</td>
</tr>
</tbody>
</table>
<p>Where the new halfedges are marked with single quotes, the same applies to the vertices, edges and faces.</p>
<p>For the vertices:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">name</th>
<th style="text-align: left;">a</th>
<th style="text-align: left;">b</th>
<th style="text-align: left;">c</th>
<th style="text-align: left;">d</th>
<th style="text-align: left;">a'</th>
<th style="text-align: left;">b'</th>
<th style="text-align: left;">c'</th>
<th style="text-align: left;">d'</th>
<th style="text-align: left;">e'</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">halfedge</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">k/m</td>
<td style="text-align: left;">o/l</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">p/j</td>
<td style="text-align: left;">x/m</td>
<td style="text-align: left;">o/l</td>
<td style="text-align: left;">s/n</td>
<td style="text-align: left;">k</td>
</tr>
</tbody>
</table>
<p>For the edges:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">name</th>
<th style="text-align: left;">ab</th>
<th style="text-align: left;">bc</th>
<th style="text-align: left;">ca</th>
<th style="text-align: left;">bd</th>
<th style="text-align: left;">dc</th>
<th style="text-align: left;">ab'</th>
<th style="text-align: left;">be'</th>
<th style="text-align: left;">ea'</th>
<th style="text-align: left;">ec'(bc)</th>
<th style="text-align: left;">ca'</th>
<th style="text-align: left;">bd'</th>
<th style="text-align: left;">dc'</th>
<th style="text-align: left;">de'</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">halfedge</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">k/o</td>
<td style="text-align: left;">l</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">x/y</td>
<td style="text-align: left;">q/p</td>
<td style="text-align: left;">k</td>
<td style="text-align: left;">l</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">r/s</td>
</tr>
</tbody>
</table>
<p>For the faces:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">name</th>
<th style="text-align: left;">f1</th>
<th style="text-align: left;">f2</th>
<th style="text-align: left;">f1'</th>
<th style="text-align: left;">f2'</th>
<th style="text-align: left;">f3'</th>
<th style="text-align: left;">f4'</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">halfedge</td>
<td style="text-align: left;">j/k/l</td>
<td style="text-align: left;">m/n/o</td>
<td style="text-align: left;">l/p/k</td>
<td style="text-align: left;">o/r/n</td>
<td style="text-align: left;">j/x/q</td>
<td style="text-align: left;">m/s/y</td>
</tr>
</tbody>
</table>
<p>With help of the above tables, the implementation is simple as follows:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework2-section2-part5-__codelineno-0-1"></a><span class="n">VertexIter</span><span class="w"> </span><span class="nf">HalfedgeMesh::splitEdge</span><span class="p">(</span><span class="w"> </span><span class="n">EdgeIter</span><span class="w"> </span><span class="n">e0</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework2-section2-part5-__codelineno-0-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework2-section2-part5-__codelineno-0-3"></a><span class="w">    </span><span class="c1">// TODO Part 5.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework2-section2-part5-__codelineno-0-4"></a><span class="w">    </span><span class="c1">// This method should split the given edge and return an iterator to the newly inserted vertex.</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework2-section2-part5-__codelineno-0-5"></a><span class="w">    </span><span class="c1">// The halfedge of this vertex should point along the edge that was split, rather than the new edges.</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework2-section2-part5-__codelineno-0-6"></a><span class="w">    </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">j_new</span><span class="p">,</span><span class="w"> </span><span class="n">k_new</span><span class="p">,</span><span class="w"> </span><span class="n">l_new</span><span class="p">,</span><span class="w"> </span><span class="n">m_new</span><span class="p">,</span><span class="w"> </span><span class="n">n_new</span><span class="p">,</span><span class="w"> </span><span class="n">o_new</span><span class="p">,</span><span class="w"> </span><span class="n">p_new</span><span class="p">,</span><span class="w"> </span><span class="n">q_new</span><span class="p">,</span><span class="w"> </span><span class="n">r_new</span><span class="p">,</span><span class="w"> </span><span class="n">s_new</span><span class="p">,</span><span class="n">x_new</span><span class="p">,</span><span class="n">y_new</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework2-section2-part5-__codelineno-0-7"></a><span class="w">    </span><span class="n">k_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e0</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">();</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework2-section2-part5-__codelineno-0-8"></a><span class="w">    </span><span class="n">l_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework2-section2-part5-__codelineno-0-9"></a><span class="w">    </span><span class="n">j_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#homework2-section2-part5-__codelineno-0-10"></a><span class="w">    </span><span class="n">o_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e0</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">();</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#homework2-section2-part5-__codelineno-0-11"></a><span class="w">    </span><span class="n">m_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#homework2-section2-part5-__codelineno-0-12"></a><span class="w">    </span><span class="n">n_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#homework2-section2-part5-__codelineno-0-13"></a><span class="w">    </span><span class="n">p_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHalfedge</span><span class="p">();</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#homework2-section2-part5-__codelineno-0-14"></a><span class="w">    </span><span class="n">q_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHalfedge</span><span class="p">();</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#homework2-section2-part5-__codelineno-0-15"></a><span class="w">    </span><span class="n">r_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHalfedge</span><span class="p">();</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#homework2-section2-part5-__codelineno-0-16"></a><span class="w">    </span><span class="n">s_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHalfedge</span><span class="p">();</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#homework2-section2-part5-__codelineno-0-17"></a><span class="w">    </span><span class="n">x_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHalfedge</span><span class="p">();</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#homework2-section2-part5-__codelineno-0-18"></a><span class="w">    </span><span class="n">y_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHalfedge</span><span class="p">();</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#homework2-section2-part5-__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#homework2-section2-part5-__codelineno-0-20"></a><span class="w">    </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a_new</span><span class="p">,</span><span class="w"> </span><span class="n">b_new</span><span class="p">,</span><span class="w"> </span><span class="n">c_new</span><span class="p">,</span><span class="w"> </span><span class="n">d_new</span><span class="p">,</span><span class="w"> </span><span class="n">e_new</span><span class="p">;</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#homework2-section2-part5-__codelineno-0-21"></a><span class="w">    </span><span class="n">a_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#homework2-section2-part5-__codelineno-0-22"></a><span class="w">    </span><span class="n">b_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#homework2-section2-part5-__codelineno-0-23"></a><span class="w">    </span><span class="n">c_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#homework2-section2-part5-__codelineno-0-24"></a><span class="w">    </span><span class="n">d_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#homework2-section2-part5-__codelineno-0-25"></a><span class="w">    </span><span class="n">e_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newVertex</span><span class="p">();</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#homework2-section2-part5-__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#homework2-section2-part5-__codelineno-0-27"></a><span class="w">    </span><span class="n">EdgeIter</span><span class="w"> </span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">bc</span><span class="p">,</span><span class="w"> </span><span class="n">ca</span><span class="p">,</span><span class="w"> </span><span class="n">bd</span><span class="p">,</span><span class="w"> </span><span class="n">dc</span><span class="p">,</span><span class="w"> </span><span class="n">ab_new</span><span class="p">,</span><span class="w"> </span><span class="n">bc_new_ec</span><span class="p">,</span><span class="w"> </span><span class="n">ca_new</span><span class="p">,</span><span class="w"> </span><span class="n">bd_new</span><span class="p">,</span><span class="w"> </span><span class="n">dc_new</span><span class="p">,</span><span class="w"> </span><span class="n">ae_new</span><span class="p">,</span><span class="w"> </span><span class="n">be_new</span><span class="p">,</span><span class="w"> </span><span class="n">ed_new</span><span class="p">;</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#homework2-section2-part5-__codelineno-0-28"></a><span class="w">    </span><span class="n">ab_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">();</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#homework2-section2-part5-__codelineno-0-29"></a><span class="w">    </span><span class="n">bc_new_ec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">();</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#homework2-section2-part5-__codelineno-0-30"></a><span class="w">    </span><span class="n">ca_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">();</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#homework2-section2-part5-__codelineno-0-31"></a><span class="w">    </span><span class="n">bd_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">();</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#homework2-section2-part5-__codelineno-0-32"></a><span class="w">    </span><span class="n">dc_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">();</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#homework2-section2-part5-__codelineno-0-33"></a><span class="w">    </span><span class="n">ae_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newEdge</span><span class="p">();</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#homework2-section2-part5-__codelineno-0-34"></a><span class="w">    </span><span class="n">be_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newEdge</span><span class="p">();</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#homework2-section2-part5-__codelineno-0-35"></a><span class="w">    </span><span class="n">ed_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newEdge</span><span class="p">();</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#homework2-section2-part5-__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#homework2-section2-part5-__codelineno-0-37"></a><span class="w">    </span><span class="n">FaceIter</span><span class="w"> </span><span class="n">f1</span><span class="p">,</span><span class="w"> </span><span class="n">f2</span><span class="p">,</span><span class="w"> </span><span class="n">f1_new</span><span class="p">,</span><span class="w"> </span><span class="n">f2_new</span><span class="p">,</span><span class="w"> </span><span class="n">f3_new</span><span class="p">,</span><span class="w"> </span><span class="n">f4_new</span><span class="p">;</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#homework2-section2-part5-__codelineno-0-38"></a><span class="w">    </span><span class="n">f1_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">-&gt;</span><span class="n">face</span><span class="p">();</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#homework2-section2-part5-__codelineno-0-39"></a><span class="w">    </span><span class="n">f2_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="o">-&gt;</span><span class="n">face</span><span class="p">();</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#homework2-section2-part5-__codelineno-0-40"></a><span class="w">    </span><span class="n">f3_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFace</span><span class="p">();</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#homework2-section2-part5-__codelineno-0-41"></a><span class="w">    </span><span class="n">f4_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFace</span><span class="p">();</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#homework2-section2-part5-__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#homework2-section2-part5-__codelineno-0-43"></a><span class="w">    </span><span class="c1">// Update the halfedges</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#homework2-section2-part5-__codelineno-0-44"></a><span class="w">    </span><span class="n">j_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">f3_new</span><span class="p">);</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#homework2-section2-part5-__codelineno-0-45"></a><span class="w">    </span><span class="n">k_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">e_new</span><span class="p">,</span><span class="n">bc</span><span class="p">,</span><span class="n">f1</span><span class="p">);</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#homework2-section2-part5-__codelineno-0-46"></a><span class="w">    </span><span class="n">l_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">c</span><span class="p">,</span><span class="n">ca</span><span class="p">,</span><span class="n">f1</span><span class="p">);</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#homework2-section2-part5-__codelineno-0-47"></a><span class="w">    </span><span class="n">m_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">s_new</span><span class="p">,</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">b</span><span class="p">,</span><span class="n">bd</span><span class="p">,</span><span class="n">f4_new</span><span class="p">);</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#homework2-section2-part5-__codelineno-0-48"></a><span class="w">    </span><span class="n">n_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">n</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">(),</span><span class="n">d</span><span class="p">,</span><span class="n">dc</span><span class="p">,</span><span class="n">f2</span><span class="p">);</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#homework2-section2-part5-__codelineno-0-49"></a><span class="w">    </span><span class="n">o_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">r_new</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">bc</span><span class="p">,</span><span class="n">f2</span><span class="p">);</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#homework2-section2-part5-__codelineno-0-50"></a><span class="w">    </span><span class="n">p_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">q_new</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">ae_new</span><span class="p">,</span><span class="n">f1</span><span class="p">);</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#homework2-section2-part5-__codelineno-0-51"></a><span class="w">    </span><span class="n">q_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">p_new</span><span class="p">,</span><span class="n">e_new</span><span class="p">,</span><span class="n">ae_new</span><span class="p">,</span><span class="n">f3_new</span><span class="p">);</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#homework2-section2-part5-__codelineno-0-52"></a><span class="w">    </span><span class="n">r_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">n_new</span><span class="p">,</span><span class="n">s_new</span><span class="p">,</span><span class="n">e_new</span><span class="p">,</span><span class="n">ed_new</span><span class="p">,</span><span class="n">f2</span><span class="p">);</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#homework2-section2-part5-__codelineno-0-53"></a><span class="w">    </span><span class="n">s_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">y_new</span><span class="p">,</span><span class="n">r_new</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">ed_new</span><span class="p">,</span><span class="n">f4_new</span><span class="p">);</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#homework2-section2-part5-__codelineno-0-54"></a><span class="w">    </span><span class="n">x_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">q_new</span><span class="p">,</span><span class="n">y_new</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">be_new</span><span class="p">,</span><span class="n">f3_new</span><span class="p">);</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#homework2-section2-part5-__codelineno-0-55"></a><span class="w">    </span><span class="n">y_new</span><span class="o">-&gt;</span><span class="n">setNeighbors</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x_new</span><span class="p">,</span><span class="n">e_new</span><span class="p">,</span><span class="n">be_new</span><span class="p">,</span><span class="n">f4_new</span><span class="p">);</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#homework2-section2-part5-__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#homework2-section2-part5-__codelineno-0-57"></a><span class="w">    </span><span class="c1">// Update the vertices</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#homework2-section2-part5-__codelineno-0-58"></a><span class="w">    </span><span class="n">a_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#homework2-section2-part5-__codelineno-0-59"></a><span class="w">    </span><span class="n">b_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#homework2-section2-part5-__codelineno-0-60"></a><span class="w">    </span><span class="n">c_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#homework2-section2-part5-__codelineno-0-61"></a><span class="w">    </span><span class="n">d_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#homework2-section2-part5-__codelineno-0-62"></a><span class="w">    </span><span class="n">e_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#homework2-section2-part5-__codelineno-0-63"></a>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#homework2-section2-part5-__codelineno-0-64"></a><span class="w">    </span><span class="c1">// Update the edges</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#homework2-section2-part5-__codelineno-0-65"></a><span class="w">    </span><span class="n">ab_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#homework2-section2-part5-__codelineno-0-66"></a><span class="w">    </span><span class="n">be_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_new</span><span class="p">;</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#homework2-section2-part5-__codelineno-0-67"></a><span class="w">    </span><span class="n">ae_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q_new</span><span class="p">;</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#homework2-section2-part5-__codelineno-0-68"></a><span class="w">    </span><span class="n">bc_new_ec</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#homework2-section2-part5-__codelineno-0-69"></a><span class="w">    </span><span class="n">ca_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#homework2-section2-part5-__codelineno-0-70"></a><span class="w">    </span><span class="n">bd_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#homework2-section2-part5-__codelineno-0-71"></a><span class="w">    </span><span class="n">dc_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#homework2-section2-part5-__codelineno-0-72"></a><span class="w">    </span><span class="n">ed_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s_new</span><span class="p">;</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#homework2-section2-part5-__codelineno-0-73"></a>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#homework2-section2-part5-__codelineno-0-74"></a><span class="w">    </span><span class="c1">// Update the faces</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#homework2-section2-part5-__codelineno-0-75"></a><span class="w">    </span><span class="n">f1_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#homework2-section2-part5-__codelineno-0-76"></a><span class="w">    </span><span class="n">f2_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#homework2-section2-part5-__codelineno-0-77"></a><span class="w">    </span><span class="n">f3_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#homework2-section2-part5-__codelineno-0-78"></a><span class="w">    </span><span class="n">f4_new</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#homework2-section2-part5-__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#homework2-section2-part5-__codelineno-0-80"></a><span class="w">    </span><span class="c1">// Update the position of the new vertex</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#homework2-section2-part5-__codelineno-0-81"></a><span class="w">    </span><span class="c1">// The new vertex should be the average of the two original vertices, b and c</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#homework2-section2-part5-__codelineno-0-82"></a><span class="w">    </span><span class="n">e_new</span><span class="o">-&gt;</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#homework2-section2-part5-__codelineno-0-83"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">e_new</span><span class="p">;</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#homework2-section2-part5-__codelineno-0-84"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div></p>
<p>With careful consideration of the pointers and values, the implementation is one-shot correct and has undergone no debugging process.</p>
<h2 id="homework2-section2-part5-results">Results</h2>
<p>The figure below is the original teapot.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part5_teapot.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="original teapot" src="../images/hw2/section2/hw2part5_teapot.png" /></a></p>
<p>After some edge splits:</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part2_splite.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="split teapot" src="../images/hw2/section2/hw2part2_splite.png" /></a></p>
<p>After a combination of both edge splits and edge flips:</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part5_combination.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="combination teapot" src="../images/hw2/section2/hw2part5_combination.png" /></a></p></section><section class="print-page" id="homework2-section2-part6"><h1 id="homework2-section2-part6-part-6-loop-subdivision-for-mesh-upsampling">Part 6: Loop Subdivision for Mesh Upsampling</h1>
<h2 id="homework2-section2-part6-methodology">Methodology</h2>
<p>Loop subdivision is a mesh upsampling technique for triangle meshes. It is a simple and efficient way to increase the number of triangles in a mesh. The algorithm involves two main steps: triangle subdivision and vertex position update.</p>
<h3 id="homework2-section2-part6-triangle-subdivision">Triangle Subdivision</h3>
<p>The subdivision of a triangle is done by adding a new vertex at the center of each edge and connecting the new vertices to form 4 new triangles. </p>
<p><a class="glightbox" href="https://cs184.eecs.berkeley.edu/sp24/docs/hw2_sub.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Triangle Subdivision" src="https://cs184.eecs.berkeley.edu/sp24/docs/hw2_sub.jpg" /></a></p>
<p>Triangle subdivision can be decomposed into two steps:</p>
<ol>
<li>Split all edges of the mesh</li>
<li>For the new edges, flip the one that connects both new and old vertices</li>
</ol>
<h3 id="homework2-section2-part6-vertex-position-update">Vertex Position Update</h3>
<p>The position of vertices is determined by the surrounding vertices.</p>
<p><a class="glightbox" href="https://cs184.eecs.berkeley.edu/sp24/docs/hw2_vupdate.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Vertex Position Update" src="https://cs184.eecs.berkeley.edu/sp24/docs/hw2_vupdate.jpg" /></a></p>
<p>For a new vertex splitting edge <span class="arithmatex">\(AB\)</span>, the new position is calculated as:</p>
<div class="arithmatex">\[
\frac{3}{8}(A + B) + \frac{1}{8}(C + D)
\]</div>
<p>where <span class="arithmatex">\(C\)</span> and <span class="arithmatex">\(D\)</span> are the vertices of the adjacent triangles to the edge <span class="arithmatex">\(AB\)</span>.</p>
<p>For an existing vertex, the new position is updated as:</p>
<div class="arithmatex">\[
(1-n*u)*P + {u} * \sum_{i=1}^{n}P_i
\]</div>
<p>where <span class="arithmatex">\(P\)</span> is the original position of the vertex, <span class="arithmatex">\(P_i\)</span> is the position of the <span class="arithmatex">\(i^{th}\)</span> vertex connected to <span class="arithmatex">\(P\)</span>, and <span class="arithmatex">\(n\)</span> is degree of <span class="arithmatex">\(P\)</span>. <span class="arithmatex">\(u\)</span> is a constant that depends on <span class="arithmatex">\(n\)</span>, as described in the figure.</p>
<h2 id="homework2-section2-part6-implementation">Implementation</h2>
<h3 id="homework2-section2-part6-subdivision-overview">Subdivision Overview</h3>
<p>The recommended steps provided by the course website are followed to implement the Loop subdivision algorithm, as illustrated below:</p>
<pre class="mermaid"><code>flowchart TB
  A[Compute new positions for all the vertices in the input mesh]
  B[Compute the updated vertex positions associated with edges];
  C[Split every edge in the mesh];
  D[Flip any new edge that connects an old and new vertex];
  E[Copy the new vertex positions into final Vertex::position];
  A --&gt; B;
  B --&gt; C;
  C --&gt; D;
  D --&gt; E;</code></pre>
<p>Each step is explained in detail in the following sections.</p>
<h3 id="homework2-section2-part6-compute-existing-vertex-positions">Compute Existing Vertex Positions</h3>
<p>Given a vertex in the mesh, the calculation of its updated position involves obtaining all the surrounding vertices and computing the new position based on the degree of the vertex. </p>
<p>To iterate over all connected vertices, halfedge iterator <code>current_halfedge</code> and <code>start_halfedge</code> are used to control the traversal. The degree <code>n</code> is incremented for each visited vertex, and the position of the vertex is added to the sum <code>new_position</code>.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework2-section2-part6-__codelineno-0-1"></a><span class="w">      </span><span class="c1">// initialize the new position</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework2-section2-part6-__codelineno-0-2"></a><span class="w">      </span><span class="n">new_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework2-section2-part6-__codelineno-0-3"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">();</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework2-section2-part6-__codelineno-0-4"></a><span class="w">      </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework2-section2-part6-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework2-section2-part6-__codelineno-0-6"></a><span class="w">      </span><span class="c1">// loop through the halfedges of the vertex</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework2-section2-part6-__codelineno-0-7"></a><span class="w">      </span><span class="k">do</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework2-section2-part6-__codelineno-0-8"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework2-section2-part6-__codelineno-0-9"></a><span class="w">        </span><span class="c1">// add the position of the nearby vertex to the new position</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#homework2-section2-part6-__codelineno-0-10"></a><span class="w">        </span><span class="n">new_position</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#homework2-section2-part6-__codelineno-0-11"></a><span class="w">        </span><span class="n">n</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#homework2-section2-part6-__codelineno-0-12"></a><span class="w">        </span><span class="c1">// move to the next halfedge</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#homework2-section2-part6-__codelineno-0-13"></a><span class="w">        </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#homework2-section2-part6-__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#homework2-section2-part6-__codelineno-0-15"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">start_halfedge</span><span class="p">);</span>
</span></code></pre></div>
<p>When all the surrounding vertices are visited, the new position is updated using the formula provided in the methodology section.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework2-section2-part6-__codelineno-1-1"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework2-section2-part6-__codelineno-1-2"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework2-section2-part6-__codelineno-1-3"></a><span class="w">        </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">16.0</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework2-section2-part6-__codelineno-1-4"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework2-section2-part6-__codelineno-1-5"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework2-section2-part6-__codelineno-1-6"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework2-section2-part6-__codelineno-1-7"></a><span class="w">        </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">8.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework2-section2-part6-__codelineno-1-8"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#homework2-section2-part6-__codelineno-1-9"></a><span class="w">      </span><span class="c1">// calculate the new position</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#homework2-section2-part6-__codelineno-1-10"></a><span class="w">      </span><span class="n">new_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">new_position</span><span class="p">;</span>
</span></code></pre></div>
<p>The above process is repeated for all vertices in the mesh to obtain the updated positions.</p>
<h3 id="homework2-section2-part6-compute-new-vertex-positions">Compute New Vertex Positions</h3>
<p>A new vertex is added at the midpoint of each edge in the mesh. The new position is calculated using the positions of the two vertices connected by the edge and the positions of the vertices of the adjacent triangles.</p>
<p>First, the four vertices are obtained by halfedge traversal.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework2-section2-part6-__codelineno-2-1"></a><span class="w">      </span><span class="c1">// locate the four surrounding vertices</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework2-section2-part6-__codelineno-2-2"></a><span class="w">      </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework2-section2-part6-__codelineno-2-3"></a><span class="w">      </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework2-section2-part6-__codelineno-2-4"></a><span class="w">      </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework2-section2-part6-__codelineno-2-5"></a><span class="w">      </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">();</span>
</span></code></pre></div></p>
<p>Then, the new position is calculated using the formula provided in the methodology section.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework2-section2-part6-__codelineno-3-1"></a><span class="w">      </span><span class="c1">// calculate the new position for the new vertices</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework2-section2-part6-__codelineno-3-2"></a><span class="w">      </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">newPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">);</span>
</span></code></pre></div></p>
<p>This step is repeated for all edges in the mesh to obtain the new vertex positions.</p>
<h3 id="homework2-section2-part6-split-edges">Split Edges</h3>
<p>In loop subdivision, every edge in the mesh is split once and only once. To prevent repeated splitting, status of each edge need to be tracked. The starter code provides an `Edge::isNew`` flag to indicate whether the edge is new or not. </p>
<p>However, there are multiple definitions of new and old edges in this problem. </p>
<ul>
<li><strong>Logical New Edge</strong>: An edge that is created during the subdivision process. It is not present in the original mesh. <strong>When an old edge is split into two parts, these parts are treated as old edges.</strong></li>
<li><strong>Chronological New Edge</strong>: The edges formed after splitting an old edge are treated as new edges.</li>
</ul>
<p>For this subsection, both definitions are feasible. However, for the whole problem, only the logical new edge is practical. This will be discussed in the next section.</p>
<p>As logical new edge definition cannot decide whether an edge has been split or not, alternative method is used to track the status of each edge. For a newly split edge, it must connect one new vertex and one old vertex. This way, the edge split can be completed within a single iteration of the mesh edges.</p>
<p>First, all the current edges and vertices are marked as old ones:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework2-section2-part6-__codelineno-4-1"></a><span class="w">    </span><span class="c1">// now every edge in the mesh is old edge</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework2-section2-part6-__codelineno-4-2"></a><span class="w">    </span><span class="c1">// set the isNew flag to false for every edge</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework2-section2-part6-__codelineno-4-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">EdgeIter</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">edgesBegin</span><span class="p">();</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">edgesEnd</span><span class="p">();</span><span class="w"> </span><span class="n">e</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework2-section2-part6-__codelineno-4-4"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework2-section2-part6-__codelineno-4-5"></a><span class="w">      </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#homework2-section2-part6-__codelineno-4-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#homework2-section2-part6-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#homework2-section2-part6-__codelineno-4-8"></a><span class="w">    </span><span class="c1">// now every vertex in the mesh is old vertex</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#homework2-section2-part6-__codelineno-4-9"></a><span class="w">    </span><span class="c1">// set the isNew flag to false for every vertex</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#homework2-section2-part6-__codelineno-4-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">verticesBegin</span><span class="p">();</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">verticesEnd</span><span class="p">();</span><span class="w"> </span><span class="n">v</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#homework2-section2-part6-__codelineno-4-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#homework2-section2-part6-__codelineno-4-12"></a><span class="w">      </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#homework2-section2-part6-__codelineno-4-13"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div></p>
<p>Then the iteration begins. For specific edges, check if it is a chronological new edge:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework2-section2-part6-__codelineno-5-1"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework2-section2-part6-__codelineno-5-2"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework2-section2-part6-__codelineno-5-3"></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework2-section2-part6-__codelineno-5-4"></a><span class="w">      </span><span class="p">}</span>
</span></code></pre></div></p>
<p>After the edge is split, the chronologically new edges are marked as logically new and old edges:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework2-section2-part6-__codelineno-6-1"></a><span class="w">      </span><span class="c1">// split the edge</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#homework2-section2-part6-__codelineno-6-2"></a><span class="w">      </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">new_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">-&gt;</span><span class="n">newPosition</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#homework2-section2-part6-__codelineno-6-3"></a><span class="w">      </span><span class="n">VertexIter</span><span class="w"> </span><span class="n">new_vertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">splitEdge</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#homework2-section2-part6-__codelineno-6-4"></a><span class="w">      </span><span class="c1">// set the isNew flag to true for the new edges</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#homework2-section2-part6-__codelineno-6-5"></a><span class="w">      </span><span class="c1">// the original edge, which is now split into two edges, is regarded as a old edge</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#homework2-section2-part6-__codelineno-6-6"></a><span class="w">      </span><span class="n">HalfedgeIter</span><span class="w"> </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_vertex</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">();</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#homework2-section2-part6-__codelineno-6-7"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// one of the original edges</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#homework2-section2-part6-__codelineno-6-8"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#homework2-section2-part6-__codelineno-6-9"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// one new edge</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#homework2-section2-part6-__codelineno-6-10"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#homework2-section2-part6-__codelineno-6-11"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// one of the original edges</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#homework2-section2-part6-__codelineno-6-12"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">twin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">();</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#homework2-section2-part6-__codelineno-6-13"></a><span class="w">      </span><span class="n">current_halfedge</span><span class="o">-&gt;</span><span class="n">edge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// one new edge</span>
</span></code></pre></div></p>
<p>The last step is to process the new vertex. Besides setting it as a new vertex, we immediately assign its <code>newPosition</code>. This is because the edge containing its new position might be flipped in the next section and the pointer to it could be lost.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework2-section2-part6-__codelineno-7-1"></a><span class="w">      </span><span class="c1">// set the isNew flag to true for the new vertex</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework2-section2-part6-__codelineno-7-2"></a><span class="w">      </span><span class="n">new_vertex</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#homework2-section2-part6-__codelineno-7-3"></a><span class="w">      </span><span class="c1">// set the new position for the new vertex immediately</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#homework2-section2-part6-__codelineno-7-4"></a><span class="w">      </span><span class="c1">// because the edge containing the new vertex might be flipped, and the new position will be lost</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#homework2-section2-part6-__codelineno-7-5"></a><span class="w">      </span><span class="n">new_vertex</span><span class="o">-&gt;</span><span class="n">newPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_position</span><span class="p">;</span>
</span></code></pre></div></p>
<h3 id="homework2-section2-part6-flip-new-edges">Flip New Edges</h3>
<p>The edges that required flipping are the ones that:</p>
<ul>
<li><strong>Is logically new</strong>: This is why the logical new edge definition is used. Chronologically new edges are not necessarily flipped, like the ones that are two parts of a split edge.</li>
<li><strong>Connects an old vertex and a new vertex</strong>: As mentioned in the methodology section.</li>
</ul>
<p>The corresponding code is:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework2-section2-part6-__codelineno-8-1"></a><span class="w">      </span><span class="c1">// check if the edge is a new edge</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#homework2-section2-part6-__codelineno-8-2"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#homework2-section2-part6-__codelineno-8-3"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#homework2-section2-part6-__codelineno-8-4"></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#homework2-section2-part6-__codelineno-8-5"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#homework2-section2-part6-__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#homework2-section2-part6-__codelineno-8-7"></a><span class="w">      </span><span class="c1">// check if the edge connects an old and new vertex</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#homework2-section2-part6-__codelineno-8-8"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="o">==</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">halfedge</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">vertex</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">isNew</span><span class="p">)</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#homework2-section2-part6-__codelineno-8-9"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#homework2-section2-part6-__codelineno-8-10"></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#homework2-section2-part6-__codelineno-8-11"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#homework2-section2-part6-__codelineno-8-12"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#homework2-section2-part6-__codelineno-8-13"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#homework2-section2-part6-__codelineno-8-14"></a><span class="w">        </span><span class="c1">// flip the edge</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#homework2-section2-part6-__codelineno-8-15"></a><span class="w">        </span><span class="n">mesh</span><span class="p">.</span><span class="n">flipEdge</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#homework2-section2-part6-__codelineno-8-16"></a><span class="w">      </span><span class="p">}</span>
</span></code></pre></div></p>
<h3 id="homework2-section2-part6-copy-new-vertex-positions">Copy New Vertex Positions</h3>
<p>Because both the mesh's original vertices and the ones created by splitting edges have their 'newPosition' set, the final step is to copy the new positions to the original positions.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#homework2-section2-part6-__codelineno-9-1"></a><span class="w">    </span><span class="c1">// 5. Copy the new vertex positions into final Vertex::position.</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#homework2-section2-part6-__codelineno-9-2"></a><span class="w">    </span><span class="c1">// iterate through all vertices</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#homework2-section2-part6-__codelineno-9-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VertexIter</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">verticesBegin</span><span class="p">();</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">verticesEnd</span><span class="p">();</span><span class="w"> </span><span class="n">v</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#homework2-section2-part6-__codelineno-9-4"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#homework2-section2-part6-__codelineno-9-5"></a><span class="w">      </span><span class="c1">// update the position of the old vertex</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#homework2-section2-part6-__codelineno-9-6"></a><span class="w">      </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="o">-&gt;</span><span class="n">newPosition</span><span class="p">;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#homework2-section2-part6-__codelineno-9-7"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div></p>
<h2 id="homework2-section2-part6-results">Results</h2>
<p>The following images are the upsampling result of <code>dae/torus/input.dae</code> with level 0,1,2, and 3 loop subdivision. The mesh is clearly smoother as the level increases.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part6_torus_u0.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_torus_u0" src="../images/hw2/section2/hw2part6_torus_u0.png" width="49%" /></a>
<a class="glightbox" href="../images/hw2/section2/hw2part6_torus_u1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_torus_u1" src="../images/hw2/section2/hw2part6_torus_u1.png" width="49%" /></a>
<a class="glightbox" href="../images/hw2/section2/hw2part6_torus_u2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_torus_u2" src="../images/hw2/section2/hw2part6_torus_u2.png" width="49%" /></a>
<a class="glightbox" href="../images/hw2/section2/hw2part6_torus_u3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_torus_u3" src="../images/hw2/section2/hw2part6_torus_u3.png" width="49%" /></a></p>
<p>One problem is that the sharp edges are smoothed out. Inspecting loop subdivision from a qualitative perspective, the new position of a vertex is determined by its surrounding vertices. This means if a vertex is distant from its neighbors, its distinct position will be averaged out. So to preserve sharp edges, we need to add more vertex around them to strengthen their influence. The following images are the same mesh but with pre-processed outer faces at upsample level 0 and 2. The outer sharp edges are much better preserved.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part6_torus_pp_u0.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_torus_pp_u0" src="../images/hw2/section2/hw2part6_torus_pp_u0.png" width="49%" /></a>
<a class="glightbox" href="../images/hw2/section2/hw2part6_torus_pp_u2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_torus_pp_u2" src="../images/hw2/section2/hw2part6_torus_pp_u2.png" width="49%" /></a></p>
<p>The same applies to <code>dae/cube.dae</code>. Considering only the face towards us, corner <span class="arithmatex">\(A\)</span> is averaged by its three neighbors during upsampling, while corner <span class="arithmatex">\(B\)</span> is averaged by two. If we apply this idea recursively to the triangles created by subdivision, we can see that the influence of corner <span class="arithmatex">\(A\)</span> is much stronger than corner <span class="arithmatex">\(B\)</span>. This is why corner <span class="arithmatex">\(A\)</span> is much smoother than corner <span class="arithmatex">\(B\)</span> in the upsampled mesh.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part6_cube_corner.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_cube_corner" src="../images/hw2/section2/hw2part6_cube_corner.png" width="100%" /></a></p>
<p>This provides a hint to solve the asymmetric problem. We need to ensure the structure of neighboring vertices of the corners is symmetric. A simple pre-processing is used in the following figures. The asymmetry is removed after loop subdivision.</p>
<p><a class="glightbox" href="../images/hw2/section2/hw2part6_cube_pp_u0.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_cube_pp_u0" src="../images/hw2/section2/hw2part6_cube_pp_u0.png" width="49%" /></a>
<a class="glightbox" href="../images/hw2/section2/hw2part6_cube_pp_u1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="hw2part6_cube_pp_u1" src="../images/hw2/section2/hw2part6_cube_pp_u1.png" width="49%" /></a></p></section><h1 class='nav-section-title-end'>Ended: Section2</h1><h1 class='nav-section-title-end'>Ended: Homework2</h1>
                        <h1 class='nav-section-title' id='section-homework3'>
                            Homework3 <a class='headerlink' href='#section-homework3' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="homework3-overview"><h1 id="homework3-overview-homework3-pathtracer-overview">Homework3: Pathtracer Overview</h1>
<h2 id="homework3-overview-overview">Overview</h2>
<p>In this homework, we implemented a pathtracer that simulates the global illumination of a scene. The pathtracer is capable of simulating the following effects:</p>
<ul>
<li>Direct illumination</li>
<li>Indirect illumination</li>
<li>BVH acceleration</li>
<li>Importance sampling</li>
<li>Russian roulette</li>
</ul>
<details class="warning">
<summary>Note for PDF</summary>
<p>Some features of the website, such as picture lightbox, may not be available in the PDF version. We recommend reading the <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-RuhaoT">website</a> directly for the best experience.</p>
</details></section><section class="print-page" id="homework3-part1"><h1 id="homework3-part1-part1-ray-generation-and-scene-intersection">Part1: Ray Generation and Scene Intersection</h1>
<h2 id="homework3-part1-overview-the-ray-generation-and-intersection-pipeline">Overview: The ray generation and intersection pipeline</h2>
<p>In this part, we implemented the ray generation and intersection pipeline for the Pathtracer. The pipeline consists of the following steps:</p>
<pre class="mermaid"><code>flowchart TB
  A[Pixel Sample Generation];
  B[Camera Ray Generation];
  C[Ray-Triangle Intersection];
  D[Ray-Sphere Intersection];
  A --&gt; B;
  B --&gt; C;
  B --&gt; D;</code></pre>
<p>The above sections will be explained in detail in the following sections.</p>
<h2 id="homework3-part1-pixel-sample-generation">Pixel Sample Generation</h2>
<h3 id="homework3-part1-methodology">Methodology</h3>
<p>In the Pathtracer, each pixel of the image is sampled <code>ns_aa</code> times. The input pixel coordinates lie in the unnormalized image space, i.e., the range of the coordinates is from 0 to <code>width</code> and 0 to <code>height</code>. </p>
<p><a class="glightbox" href="../images/hw3/part1/hw3part1_psg.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="PixelSampleGeneration" src="../images/hw3/part1/hw3part1_psg.png" /></a></p>
<p>Each sample process consists of the following steps:</p>
<ol>
<li>Generate a random sample point in the pixel space.</li>
<li>Normalize the sample point to the camera space.</li>
<li>Generate a ray from the camera origin to the sample point.</li>
<li>Obtain the returned color and add it to the pixel color.</li>
</ol>
<h3 id="homework3-part1-implementation">Implementation</h3>
<p>The grid sampler provided in the starter code is used to generate the sample points:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework3-part1-__codelineno-0-1"></a><span class="w">      </span><span class="c1">// generate a random sample</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework3-part1-__codelineno-0-2"></a><span class="w">      </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gridSampler</span><span class="o">-&gt;</span><span class="n">get_sample</span><span class="p">();</span>
</span></code></pre></div>
<p>As the width and height of the camera space are 1, the sample point is normalized by dividing the sample point by the width and height of the sample buffer:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework3-part1-__codelineno-1-1"></a><span class="w">      </span><span class="n">xsample_normalized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sample</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleBuffer</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework3-part1-__codelineno-1-2"></a><span class="w">      </span><span class="n">ysample_normalized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sample</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleBuffer</span><span class="p">.</span><span class="n">h</span><span class="p">;</span>
</span></code></pre></div>
<p>Finally, the ray is generated from the camera origin to the sample point, and the returned color is added to the pixel color:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework3-part1-__codelineno-2-1"></a><span class="w">      </span><span class="c1">// generate a random ray</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework3-part1-__codelineno-2-2"></a><span class="w">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="o">-&gt;</span><span class="n">generate_ray</span><span class="p">(</span><span class="n">xsample_normalized</span><span class="p">,</span><span class="w"> </span><span class="n">ysample_normalized</span><span class="p">);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework3-part1-__codelineno-2-3"></a><span class="w">      </span><span class="c1">// trace the ray</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework3-part1-__codelineno-2-4"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">est_radiance_global_illumination</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
</span></code></pre></div>
<p>This process is repeated for <code>ns_aa</code> times to obtain the final pixel color. The result is averaged and assigned to the pixel buffer.</p>
<h2 id="homework3-part1-camera-ray-generation">Camera Ray Generation</h2>
<h3 id="homework3-part1-methodology_1">Methodology</h3>
<p>The given pixel position is in the normalized image space. After obtaining its position in the camera space, the ray direction in the camera space is determined. To generate the ray, this direction is transformed to the world space.</p>
<p><a class="glightbox" href="../images/hw3/part1/hw3part1_crg.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CameraRayGeneration" src="../images/hw3/part1/hw3part1_crg.png" /></a></p>
<p>Transforming pixel position from the normalized image space to the camera space involves translating the pixel position to the camera space and scaling it by the camera width and height. The translation matrix is given by:</p>
<div class="arithmatex">\[
\begin{bmatrix}
1 &amp; 0 &amp; -0.5 \\
0 &amp; 1 &amp; -0.5 \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<p>The scaling matrix is given by:</p>
<div class="arithmatex">\[
\begin{bmatrix}
2 \times \tan(\frac{hFov}{2}) &amp; 0 &amp; 0 \\
0 &amp; 2 \times \tan(\frac{vFov}{2}) &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<p>The ray direction in the camera space is the vector from the camera position to the sensor position. The sensor position is obtained by changing the third component of the pixel position to -1. </p>
<p>The camera-to-world matrix the given and does not need to be computed. </p>
<h3 id="homework3-part1-implementation_1">Implementation</h3>
<p>First, the translation matrix <code>move_to_center</code> and scaling matrix <code>scale_to_sensor</code> are defined:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework3-part1-__codelineno-3-1"></a><span class="w">  </span><span class="c1">// step 1: transform the input image coordinate to the virtual sensor plane coordinate</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework3-part1-__codelineno-3-2"></a><span class="w">  </span><span class="c1">// move the input image coordinate to the center of the image plane</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework3-part1-__codelineno-3-3"></a><span class="w">  </span><span class="n">Matrix3x3</span><span class="w"> </span><span class="n">move_to_center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3x3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework3-part1-__codelineno-3-4"></a><span class="w">  </span><span class="c1">// scale the input image coordinate to the sensor plane coordinate</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#homework3-part1-__codelineno-3-5"></a><span class="w">  </span><span class="c1">// the virtual sensor plane is 1 unit away from the camera</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#homework3-part1-__codelineno-3-6"></a><span class="w">  </span><span class="n">Matrix3x3</span><span class="w"> </span><span class="n">scale_to_sensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Matrix3x3</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">hFov</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">vFov</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></div>
<p>The pixel position is transformed to the sensor position by multiplying the translation and scaling matrices:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework3-part1-__codelineno-4-1"></a><span class="w">  </span><span class="c1">// apply the transformation</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework3-part1-__codelineno-4-2"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">input_image_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework3-part1-__codelineno-4-3"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">sensor_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scale_to_sensor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">move_to_center</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input_image_position</span><span class="p">;</span>
</span></code></pre></div>
<p>The ray direction in the camera space is the vector from the camera position to the sensor position:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework3-part1-__codelineno-5-1"></a><span class="w">  </span><span class="c1">// step 2: compute the ray direction in camera space</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework3-part1-__codelineno-5-2"></a><span class="w">  </span><span class="c1">// the ray direction is the vector from the camera position to the sensor position</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework3-part1-__codelineno-5-3"></a><span class="w">  </span><span class="c1">// in camera space, camera is at the origin</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework3-part1-__codelineno-5-4"></a><span class="w">  </span><span class="c1">// simply change the third component of the sensor position to -1</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#homework3-part1-__codelineno-5-5"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">ray_direction_in_camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">sensor_position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">};</span>
</span></code></pre></div>
<p>Finally, the ray direction is transformed to the world space, and the ray is initialized.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework3-part1-__codelineno-6-1"></a><span class="w">  </span><span class="c1">// step 3: transform the ray direction to world space</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#homework3-part1-__codelineno-6-2"></a><span class="w">  </span><span class="c1">// use the camera-to-world rotation matrix</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#homework3-part1-__codelineno-6-3"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">ray_direction_in_world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ray_direction_in_camera</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#homework3-part1-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#homework3-part1-__codelineno-6-5"></a><span class="w">  </span><span class="c1">// normalize the ray direction</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#homework3-part1-__codelineno-6-6"></a><span class="w">  </span><span class="n">ray_direction_in_world</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#homework3-part1-__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#homework3-part1-__codelineno-6-8"></a><span class="w">  </span><span class="n">Ray</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">ray_direction_in_world</span><span class="p">);</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#homework3-part1-__codelineno-6-9"></a><span class="w">  </span><span class="c1">// initialize the range of the ray</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#homework3-part1-__codelineno-6-10"></a><span class="w">  </span><span class="n">result</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nClip</span><span class="p">;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#homework3-part1-__codelineno-6-11"></a><span class="w">  </span><span class="n">result</span><span class="p">.</span><span class="n">max_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fClip</span><span class="p">;</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#homework3-part1-__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#homework3-part1-__codelineno-6-13"></a><span class="w">  </span><span class="k">return</span><span class="w">  </span><span class="n">result</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework3-part1-ray-triangle-intersection">Ray-Triangle Intersection</h2>
<h3 id="homework3-part1-methodology_2">Methodology</h3>
<p>We strictly followed the Moller-Trumbore algorithm to implement the ray-triangle intersection. The algorithm is based on the following steps:</p>
<p><a class="glightbox" href="https://cs184.eecs.berkeley.edu/public/sp24/lectures/lec-9-ray-tracing-and-acceleration-str/slides/slide-20.jpg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="RayTriangleIntersection" src="https://cs184.eecs.berkeley.edu/public/sp24/lectures/lec-9-ray-tracing-and-acceleration-str/slides/slide-20.jpg" /></a></p>
<h3 id="homework3-part1-implementation_2">Implementation</h3>
<p>First, the Barycentric coordinates of the intersection point and its <code>t</code> value are obtained by the Moller-Trumbore algorithm:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework3-part1-__codelineno-7-1"></a><span class="w">  </span><span class="c1">// Use Moller-Trumbore intersection algorithm</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework3-part1-__codelineno-7-2"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">E_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#homework3-part1-__codelineno-7-3"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">E_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#homework3-part1-__codelineno-7-4"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#homework3-part1-__codelineno-7-5"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">S_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">E_2</span><span class="p">);</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#homework3-part1-__codelineno-7-6"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">S_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">E_1</span><span class="p">);</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#homework3-part1-__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#homework3-part1-__codelineno-7-8"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">S_1</span><span class="p">,</span><span class="w"> </span><span class="n">E_1</span><span class="p">);</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#homework3-part1-__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#homework3-part1-__codelineno-7-10"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">denominator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#homework3-part1-__codelineno-7-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#homework3-part1-__codelineno-7-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#homework3-part1-__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#homework3-part1-__codelineno-7-14"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">S_2</span><span class="p">,</span><span class="w"> </span><span class="n">E_2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">denominator</span><span class="p">;</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#homework3-part1-__codelineno-7-15"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">S_1</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">denominator</span><span class="p">;</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#homework3-part1-__codelineno-7-16"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">S_2</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">denominator</span><span class="p">;</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#homework3-part1-__codelineno-7-17"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b2</span><span class="p">;</span>
</span></code></pre></div>
<p>Next, the intersection point is checked:</p>
<ul>
<li>If the Barycentric coordinates are inside the triangle.</li>
<li>If the <code>t</code> value is within the range of the ray.</li>
</ul>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework3-part1-__codelineno-8-1"></a><span class="w">  </span><span class="c1">// check if t is within the range</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#homework3-part1-__codelineno-8-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#homework3-part1-__codelineno-8-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#homework3-part1-__codelineno-8-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#homework3-part1-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#homework3-part1-__codelineno-8-6"></a><span class="w">  </span><span class="c1">// check if b1, b2, and b3 are within the range</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#homework3-part1-__codelineno-8-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#homework3-part1-__codelineno-8-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#homework3-part1-__codelineno-8-9"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p>If the intersection point is valid, the last step is to update the <code>max_t</code> value of the ray and return <code>true</code>.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#homework3-part1-__codelineno-9-1"></a><span class="w">  </span><span class="c1">// update the max_t value of the ray</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#homework3-part1-__codelineno-9-2"></a><span class="w">  </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#homework3-part1-__codelineno-9-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework3-part1-ray-sphere-intersection">Ray-Sphere Intersection</h2>
<h3 id="homework3-part1-methodology_3">Methodology</h3>
<p>For a sphere with center <code>c</code> and radius <code>r</code>, the ray-sphere intersection is calculated by solving the following quadratic equation:</p>
<div class="arithmatex">\[
(o + td - c) \cdot (o + td - c) = r^2
\]</div>
<p>where <code>o</code> is the ray origin, <code>d</code> is the ray direction, and <code>t</code> is the intersection point. The solution to the quadratic equation is given by:</p>
<div class="arithmatex">\[
\begin{align*}
t &amp;= \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} \\
a &amp;= d \cdot d \\
b &amp;= 2(d \cdot (o - c)) \\
c &amp;= (o - c) \cdot (o - c) - r^2
\end{align*}
\]</div>
<p>If the part inside the square root is negative, there is no intersection. For this task, we check:</p>
<ul>
<li>If there is an intersection.</li>
<li>If the <code>t</code> value is within the range of the ray.</li>
</ul>
<h3 id="homework3-part1-implementation_3">Implementation</h3>
<p>In the <code>test</code> function, whether the ray intersects with the sphere is tested:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#homework3-part1-__codelineno-10-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">Sphere::test</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Ray</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#homework3-part1-__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#homework3-part1-__codelineno-10-3"></a><span class="w">  </span><span class="c1">// TODO (Part 1.4):</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#homework3-part1-__codelineno-10-4"></a><span class="w">  </span><span class="c1">// Implement ray - sphere intersection test.</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#homework3-part1-__codelineno-10-5"></a><span class="w">  </span><span class="c1">// Return true if there are intersections and writing the</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#homework3-part1-__codelineno-10-6"></a><span class="w">  </span><span class="c1">// smaller of the two intersection times in t1 and the larger in t2.</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#homework3-part1-__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#homework3-part1-__codelineno-10-8"></a><span class="w">  </span><span class="c1">// Implementation by Ruhao Tian starts here</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#homework3-part1-__codelineno-10-9"></a><span class="w">  </span><span class="c1">// a t^2 + b t + c = 0</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#homework3-part1-__codelineno-10-10"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">norm2</span><span class="p">();</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#homework3-part1-__codelineno-10-11"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">o</span><span class="p">);</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#homework3-part1-__codelineno-10-12"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">o</span><span class="p">).</span><span class="n">norm2</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r2</span><span class="p">;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#homework3-part1-__codelineno-10-13"></a>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#homework3-part1-__codelineno-10-14"></a><span class="w">  </span><span class="c1">// check if there&#39;s valid solution</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#homework3-part1-__codelineno-10-15"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#homework3-part1-__codelineno-10-16"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#homework3-part1-__codelineno-10-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#homework3-part1-__codelineno-10-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#homework3-part1-__codelineno-10-19"></a>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#homework3-part1-__codelineno-10-20"></a><span class="w">  </span><span class="c1">// find the two solutions</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#homework3-part1-__codelineno-10-21"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrt_delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#homework3-part1-__codelineno-10-22"></a><span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sqrt_delta</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#homework3-part1-__codelineno-10-23"></a><span class="w">  </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt_delta</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#homework3-part1-__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#homework3-part1-__codelineno-10-25"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#homework3-part1-__codelineno-10-26"></a>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#homework3-part1-__codelineno-10-27"></a><span class="p">}</span>
</span></code></pre></div>
<p>The function <code>has_intersection</code> will call <code>test</code> and check further if the intersection point is within the range of the ray:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#homework3-part1-__codelineno-11-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">Sphere::has_intersection</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Ray</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#homework3-part1-__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#homework3-part1-__codelineno-11-3"></a><span class="w">  </span><span class="c1">// TODO (Part 1.4):</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#homework3-part1-__codelineno-11-4"></a><span class="w">  </span><span class="c1">// Implement ray - sphere intersection.</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#homework3-part1-__codelineno-11-5"></a><span class="w">  </span><span class="c1">// Note that you might want to use the the Sphere::test helper here.</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#homework3-part1-__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#homework3-part1-__codelineno-11-7"></a><span class="w">  </span><span class="c1">// Implementation by Ruhao Tian starts here</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#homework3-part1-__codelineno-11-8"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#homework3-part1-__codelineno-11-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">test</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#homework3-part1-__codelineno-11-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#homework3-part1-__codelineno-11-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#homework3-part1-__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#homework3-part1-__codelineno-11-13"></a><span class="w">  </span><span class="c1">// test if t1 is in the valid range</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#homework3-part1-__codelineno-11-14"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#homework3-part1-__codelineno-11-15"></a><span class="w">    </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#homework3-part1-__codelineno-11-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#homework3-part1-__codelineno-11-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#homework3-part1-__codelineno-11-18"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#homework3-part1-__codelineno-11-19"></a><span class="w">    </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#homework3-part1-__codelineno-11-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#homework3-part1-__codelineno-11-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#homework3-part1-__codelineno-11-22"></a>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#homework3-part1-__codelineno-11-23"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#homework3-part1-__codelineno-11-24"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="homework3-part1-results">Results</h2>
<p>After implementing the ray generation and intersection pipeline, we obtained the following results:</p>
<p><strong>CBspheres.dae</strong>
<a class="glightbox" href="../images/hw3/part1/hw3part1_spheres.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres" src="../images/hw3/part1/hw3part1_spheres.png" /></a></p>
<p><strong>CBgems.dae</strong>
<a class="glightbox" href="../images/hw3/part1/hw3part1_gems.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBgems" src="../images/hw3/part1/hw3part1_gems.png" /></a></p>
<p><strong>CBcoil.dae</strong>
<a class="glightbox" href="../images/hw3/part1/hw3part1_coil.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBcoil" src="../images/hw3/part1/hw3part1_coil.png" /></a></p></section><section class="print-page" id="homework3-part2"><h1 id="homework3-part2-part-2-bounding-volume-hierarchy">Part 2: Bounding Volume Hierarchy</h1>
<h2 id="homework3-part2-constructing-the-bvh">Constructing the BVH</h2>
<h3 id="homework3-part2-methodology">Methodology</h3>
<p>The method I use to construct the BVH (Bounding Volume Hierarchy) is based on splitting at the centroid as the midpoint. The specific choice of the splitting axis is completely random. This ensures that, in the vast majority of cases, the range of leaves will not be too flat.</p>
<p>The specific steps are as follows:</p>
<ol>
<li>Select Split Axis: Randomly choose one from the <span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span>, <span class="arithmatex">\(z\)</span> axes as the split axis.</li>
<li>Calculate Centroid for Selected Axis: Find the position of the centroid along the selected axis</li>
<li>Sort Pointers According to Coordinates on Selected Axis: Arrange the pointers at this point in order of their corresponding coordinates along the selected axis, from smallest to largest.</li>
<li>Splitting Nodes: The left subtree contains the first half of the pointers. The right subtree contains the second half of the pointers. Recur this process until the maximum value of nodes is reached.</li>
</ol>
<p><a class="glightbox" href="../images/hw3/part2/exampleBVH.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="BVH" src="../images/hw3/part2/exampleBVH.PNG" /></a></p>
<h3 id="homework3-part2-implementation">Implementation</h3>
<p>Determine whether the <span class="arithmatex">\(max_leaf_size\)</span> has been reached.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework3-part2-__codelineno-0-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_leaf_size</span><span class="p">){</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework3-part2-__codelineno-0-2"></a><span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework3-part2-__codelineno-0-3"></a><span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework3-part2-__codelineno-0-4"></a><span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework3-part2-__codelineno-0-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework3-part2-__codelineno-0-6"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>Randomly choose one axis. 0 for x, 1 for y and 2 for z.
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework3-part2-__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span>
</span></code></pre></div></p>
<p>Sort pointers according to coordinates on the selected axis.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework3-part2-__codelineno-2-1"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">axis</span><span class="p">](</span><span class="n">Primitive</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Primitive</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework3-part2-__codelineno-2-2"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">get_bbox</span><span class="p">().</span><span class="n">centroid</span><span class="p">()[</span><span class="n">axis</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">get_bbox</span><span class="p">().</span><span class="n">centroid</span><span class="p">()[</span><span class="n">axis</span><span class="p">];</span><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<p>Splitting nodes.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework3-part2-__codelineno-3-1"></a><span class="w">  </span><span class="n">left_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework3-part2-__codelineno-3-2"></a><span class="w">  </span><span class="n">right_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left_end</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework3-part2-__codelineno-3-3"></a><span class="w">  </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">construct_bvh</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">left_end</span><span class="p">,</span><span class="w"> </span><span class="n">max_leaf_size</span><span class="p">);</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework3-part2-__codelineno-3-4"></a><span class="w">  </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">construct_bvh</span><span class="p">(</span><span class="n">right_start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"> </span><span class="n">max_leaf_size</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="homework3-part2-intersecting-the-bounding-box">Intersecting the Bounding Box</h2>
<p>For most situations: Check the entry and exit times. If the entry time and exit time are in the range between t0 and t1, return True. In addition, the entry time is the maximum of the entry times along each axis, and the exit time is the minimum of the exit times along each axis.
Otherwise, return False.</p>
<p><a class="glightbox" href="../images/hw3/part2/example_inter.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="BVH_inter" src="../images/hw3/part2/example_inter.PNG" /></a></p>
<p>Special Case 1:</p>
<p>If the ray is parallel to one or more axes, let it(or one of them) as axis m.
If the value of axis m at the starting position of the ray is within the range of the node, then consider the entry time as negative infinity and the exit time as positive infinity at axis m.
Otherwise, return False.</p>
<p>Special Case 2:
If the origin of the ray is inside the bounding box, return True.</p>
<p>Special Case 3:
If the ray stops in the bounding box, return True.</p>
<h3 id="homework3-part2-implementation_1">Implementation</h3>
<p>Consider the common situations and the Special Case 1.
t[/][0] means the enter time at axis /.
t[/][1] means the exit time at axis /.
t[0] means axis x. Similarly, t[1] for y and t[2] for z.</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework3-part2-__codelineno-4-1"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework3-part2-__codelineno-4-2"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework3-part2-__codelineno-4-3"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="o">&lt;</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="o">||</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework3-part2-__codelineno-4-4"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">-99999</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework3-part2-__codelineno-4-5"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">999999</span><span class="p">;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#homework3-part2-__codelineno-4-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#homework3-part2-__codelineno-4-7"></a><span class="w">  </span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#homework3-part2-__codelineno-4-8"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">((</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,(</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#homework3-part2-__codelineno-4-9"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">((</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,(</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#homework3-part2-__codelineno-4-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#homework3-part2-__codelineno-4-11"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#homework3-part2-__codelineno-4-12"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="o">&lt;</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="o">||</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="o">&gt;</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#homework3-part2-__codelineno-4-13"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">-99999</span><span class="p">;</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#homework3-part2-__codelineno-4-14"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">999999</span><span class="p">;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#homework3-part2-__codelineno-4-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#homework3-part2-__codelineno-4-16"></a><span class="w">  </span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#homework3-part2-__codelineno-4-17"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">((</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">,(</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#homework3-part2-__codelineno-4-18"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">((</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">,(</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#homework3-part2-__codelineno-4-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#homework3-part2-__codelineno-4-20"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">z</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#homework3-part2-__codelineno-4-21"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="o">&lt;</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="o">||</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="o">&gt;</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#homework3-part2-__codelineno-4-22"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">-99999</span><span class="p">;</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#homework3-part2-__codelineno-4-23"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">999999</span><span class="p">;</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#homework3-part2-__codelineno-4-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#homework3-part2-__codelineno-4-25"></a><span class="w">  </span><span class="k">else</span><span class="p">{</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#homework3-part2-__codelineno-4-26"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">((</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">z</span><span class="p">,(</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#homework3-part2-__codelineno-4-27"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">((</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">z</span><span class="p">,(</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#homework3-part2-__codelineno-4-28"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
Initialize the entry and exit times as described earlier.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework3-part2-__codelineno-5-1"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t_enter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework3-part2-__codelineno-5-2"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t_exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
</span></code></pre></div>
<p>Check if the intersection is in the range of t0 and t1</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework3-part2-__codelineno-6-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t_exit</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t_enter</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">t_exit</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#homework3-part2-__codelineno-6-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#homework3-part2-__codelineno-6-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t_enter</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">t_enter</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t1</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#homework3-part2-__codelineno-6-4"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#homework3-part2-__codelineno-6-5"></a><span class="w">      </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_enter</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#homework3-part2-__codelineno-6-6"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#homework3-part2-__codelineno-6-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#homework3-part2-__codelineno-6-8"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
Consider the Special Case 2.</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework3-part2-__codelineno-7-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework3-part2-__codelineno-7-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#homework3-part2-__codelineno-7-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#homework3-part2-__codelineno-7-4"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
Consider the Special Case 3.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework3-part2-__codelineno-8-1"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">max_t</span><span class="p">;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#homework3-part2-__codelineno-8-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#homework3-part2-__codelineno-8-3"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#homework3-part2-__codelineno-8-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#homework3-part2-__codelineno-8-5"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h2 id="homework3-part2-intersecting-the-bvh">Intersecting the BVH</h2>
<h3 id="homework3-part2-methodology_1">Methodology</h3>
<p>The core idea is as follows:
If it is not a leaf node, recursively check the left and right child nodes.
If it is a leaf node, use the function generated in the previous step to check for intersection.</p>
<h3 id="homework3-part2-implementation_2">Implementation</h3>
<h4 id="homework3-part2-bvhaccelhas_intersection">BVHAccel:has_intersection</h4>
<p>If it is a leaf node.</p>
<p>'''cpp
  if (node-&gt;isLeaf()){
    // check if the ray intersects with a bounding box of the node
    if (!node-&gt;bb.intersect(ray, t0, t1))return false;
    // has intersection, check all primitives in the node
    for (auto p = node-&gt;start; p != node-&gt;end; p++){
      total_isects++;
      if ((*p)-&gt;has_intersection(ray))return true;
      }
    return false;
    }
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#homework3-part2-__codelineno-9-1"></a>If it is not a leaf node, recursively check the left and right child nodes.
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#homework3-part2-__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#homework3-part2-__codelineno-9-3"></a>```cpp
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#homework3-part2-__codelineno-9-4"></a>  bool left_result, right_result;
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#homework3-part2-__codelineno-9-5"></a>  left_result = has_intersection(ray, node-&gt;l);
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#homework3-part2-__codelineno-9-6"></a>  right_result = has_intersection(ray, node-&gt;r);
</span></code></pre></div></p>
<h4 id="homework3-part2-bvhaccelintersect">BVHAccel:intersect</h4>
<p>This is quite similar to the approach discussed earlier, so I will provide the code directly. More detailed explanations are provided in the comments.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#homework3-part2-__codelineno-10-1"></a><span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ray</span><span class="p">.</span><span class="n">max_t</span><span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#homework3-part2-__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#homework3-part2-__codelineno-10-3"></a><span class="w">      </span><span class="c1">// check if current node is leaf node</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#homework3-part2-__codelineno-10-4"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">isLeaf</span><span class="p">())</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#homework3-part2-__codelineno-10-5"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#homework3-part2-__codelineno-10-6"></a><span class="w">        </span><span class="c1">// check if the ray intersects with bounding box of the node</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#homework3-part2-__codelineno-10-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">bb</span><span class="p">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="p">))</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#homework3-part2-__codelineno-10-8"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#homework3-part2-__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#homework3-part2-__codelineno-10-10"></a><span class="w">        </span><span class="c1">// has intersection, check all primitives in the node</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#homework3-part2-__codelineno-10-11"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">has_isect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#homework3-part2-__codelineno-10-12"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#homework3-part2-__codelineno-10-13"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#homework3-part2-__codelineno-10-14"></a><span class="w">          </span><span class="n">total_isects</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#homework3-part2-__codelineno-10-15"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">has_intersection</span><span class="p">(</span><span class="n">ray</span><span class="p">))</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#homework3-part2-__codelineno-10-16"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#homework3-part2-__codelineno-10-17"></a><span class="w">            </span><span class="n">has_isect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#homework3-part2-__codelineno-10-18"></a>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#homework3-part2-__codelineno-10-19"></a><span class="w">            </span><span class="c1">// check the t value of the intersection</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#homework3-part2-__codelineno-10-20"></a><span class="w">            </span><span class="n">Intersection</span><span class="w"> </span><span class="n">temp_isect</span><span class="p">;</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#homework3-part2-__codelineno-10-21"></a><span class="w">            </span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">temp_isect</span><span class="p">);</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#homework3-part2-__codelineno-10-22"></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#homework3-part2-__codelineno-10-23"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp_isect</span><span class="p">.</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#homework3-part2-__codelineno-10-24"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#homework3-part2-__codelineno-10-25"></a><span class="w">              </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_isect</span><span class="p">.</span><span class="n">t</span><span class="p">;</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#homework3-part2-__codelineno-10-26"></a><span class="w">              </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">primitive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_isect</span><span class="p">.</span><span class="n">primitive</span><span class="p">;</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#homework3-part2-__codelineno-10-27"></a><span class="w">              </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_isect</span><span class="p">.</span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#homework3-part2-__codelineno-10-28"></a><span class="w">              </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">bsdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp_isect</span><span class="p">.</span><span class="n">bsdf</span><span class="p">;</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#homework3-part2-__codelineno-10-29"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#homework3-part2-__codelineno-10-30"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#homework3-part2-__codelineno-10-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#homework3-part2-__codelineno-10-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">has_isect</span><span class="p">;</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#homework3-part2-__codelineno-10-33"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#homework3-part2-__codelineno-10-34"></a>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#homework3-part2-__codelineno-10-35"></a><span class="w">      </span><span class="c1">// if current node is not leaf node</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#homework3-part2-__codelineno-10-36"></a><span class="w">      </span><span class="c1">// check if the ray intersects with bounding box of the node</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#homework3-part2-__codelineno-10-37"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">bb</span><span class="p">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="p">))</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#homework3-part2-__codelineno-10-38"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#homework3-part2-__codelineno-10-39"></a>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#homework3-part2-__codelineno-10-40"></a><span class="w">      </span><span class="c1">// has intersection, check left and right child</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#homework3-part2-__codelineno-10-41"></a><span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">left_result</span><span class="p">,</span><span class="w"> </span><span class="n">right_result</span><span class="p">;</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#homework3-part2-__codelineno-10-42"></a><span class="w">      </span><span class="n">left_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">);</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#homework3-part2-__codelineno-10-43"></a><span class="w">      </span><span class="n">right_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">);</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#homework3-part2-__codelineno-10-44"></a><span class="w">      </span><span class="c1">// NEVER use &#39;return intersect(ray, i, node-&gt;l) || intersect(ray, i, node-&gt;r);&#39;</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#homework3-part2-__codelineno-10-45"></a><span class="w">      </span><span class="c1">// because the right child might not be checked if the left child has intersection</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#homework3-part2-__codelineno-10-46"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">left_result</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">right_result</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework3-part2-result">Result</h2>
<p>Images with normal shading for a few large .dae files that I can only render with BVH acceleration.</p>
<p><a class="glightbox" href="../images/hw3/part2/example_bvh1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="BVH_1" src="../images/hw3/part2/example_bvh1.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part2/example_bvh2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="BVH_1" src="../images/hw3/part2/example_bvh2.png" /></a></p>
<p>I will compare running the following code with and without building the BVH:</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#homework3-part2-__codelineno-11-1"></a><span class="w">  </span><span class="p">.</span><span class="o">/</span><span class="n">pathtracer</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="mi">800</span><span class="w"> </span><span class="mi">600</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">cow</span><span class="p">.</span><span class="n">png</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="n">dae</span><span class="o">/</span><span class="n">meshedit</span><span class="o">/</span><span class="n">cow</span><span class="p">.</span><span class="n">dae</span>
</span></code></pre></div>
Without BVH:</p>
<p><a class="glightbox" href="../images/hw3/part2/time0.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="without" src="../images/hw3/part2/time0.PNG" /></a></p>
<p>It costs about 13s.</p>
<p>With BVH:</p>
<p><a class="glightbox" href="../images/hw3/part2/time1.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="with" src="../images/hw3/part2/time1.PNG" /></a></p>
<p>It costs less than 1s.</p>
<p>For the other images:</p>
<h3 id="homework3-part2-beastdae">beast.dae</h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code>            without BVH
</code></pre></div>
<p><a class="glightbox" href="../images/hw3/part2/time2.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="without" src="../images/hw3/part2/time2.PNG" /></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code>            with BVH
</code></pre></div>
<p><a class="glightbox" href="../images/hw3/part2/time3.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="with" src="../images/hw3/part2/time3.PNG" /></a></p>
<h3 id="homework3-part2-beetledae">beetle.dae</h3>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code>            without BVH
</code></pre></div>
<p><a class="glightbox" href="../images/hw3/part2/time4.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="without" src="../images/hw3/part2/time4.PNG" /></a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code>            with BVH
</code></pre></div>
<p><a class="glightbox" href="../images/hw3/part2/time5.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="with" src="../images/hw3/part2/time5.PNG" /></a></p>
<p>Summary: Using BVH can be nearly a thousand times faster compared to not using it. For example, rendering beast.dae without BVH takes 3 minutes, while using BVH takes less than half a second. The reason for this is that this structure reduces the number of intersection tests needed to find the intersection between a ray and an object in the scene.</p></section><section class="print-page" id="homework3-part3"><h1 id="homework3-part3-part3-direct-illumination">Part3: Direct Illumination</h1>
<h2 id="homework3-part3-overview">Overview</h2>
<p>Global illumination radiance from direct illumination is estimated in this part. The direct illumination consists of zero-bounce and one-bounce light transport, and the latter could be estimated by uniformly sampling the hemisphere or importance sampling the BRDF. The structure of the pipeline is as follows:</p>
<pre class="mermaid"><code>flowchart TB
    A[Direct Illumination of Single Ray];
    B[Zero-Bounce Light Transport];
    C[One-Bounce Light Transport];
    D[Uniform Sampling];
    E[Importance Sampling];
    A --&gt; B;
    A --&gt; C;
    C --&gt; D;
    C --&gt; E;</code></pre>
<p>The above sections will be explained in detail in the following sections.</p>
<h2 id="homework3-part3-zero-bounce-illumination">Zero-Bounce Illumination</h2>
<h3 id="homework3-part3-methodology">Methodology</h3>
<p>Zero-bounce illumination of a single ray is estimated by adding the emitted radiance from the light sources to the pixel color. The emitted radiance here only considers the light sources and does not consider the indirect illumination from the scene. The rendering equation for zero-bounce illumination is given by:</p>
<div class="arithmatex">\[
L_o(p, \omega_o) = L_e(p, \omega_o)
\]</div>
<p>where <span class="arithmatex">\(L_o(p, \omega_o)\)</span> is the radiance leaving the point <span class="arithmatex">\(p\)</span> in the direction <span class="arithmatex">\(\omega_o\)</span>, and <span class="arithmatex">\(L_e(p, \omega_o)\)</span> is the emitted radiance from the light sources.</p>
<h3 id="homework3-part3-implementation">Implementation</h3>
<p>In the starter code, the emitted radiance from the intersected light source of the ray is encapsulated in <code>BSDF::get_emission()</code>. The emitted radiance is added to the pixel color and returned:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework3-part3-__codelineno-0-1"></a><span class="w">    </span><span class="c1">// obtain the emission color of the intersection</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework3-part3-__codelineno-0-2"></a><span class="w">    </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">L_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">get_emission</span><span class="p">();</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework3-part3-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework3-part3-__codelineno-0-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework3-part3-uniform-hemisphere-sampling">Uniform Hemisphere Sampling</h2>
<h3 id="homework3-part3-methodology_1">Methodology</h3>
<p>In physical-based rendering, the reflected radiance from the surface is calculated by integrating the product of the BRDF and the incident radiance over the hemisphere:</p>
<div class="arithmatex">\[
L_o(p, \omega_o) = \int_{\Omega} f(p, \omega_i, \omega_o) L_i(p, \omega_i) \cos(\theta_i) d\omega_i
\]</div>
<p>where <span class="arithmatex">\(L_o(p, \omega_o)\)</span> is the radiance leaving the point <span class="arithmatex">\(p\)</span> in the direction <span class="arithmatex">\(\omega_o\)</span>, <span class="arithmatex">\(f(p, \omega_i, \omega_o)\)</span> is the BRDF, <span class="arithmatex">\(L_i(p, \omega_i)\)</span> is the incident radiance from the direction <span class="arithmatex">\(\omega_i\)</span>, and <span class="arithmatex">\(\theta_i\)</span> is the angle between the normal and the incident direction. </p>
<p>The integral is approximated by sampling the hemisphere uniformly and averaging the results using Monte Carlo integration:</p>
<div class="arithmatex">\[
L_o(p, \omega_o) \approx \frac{1}{N} \sum_{i=1}^{N} f(p, \omega_i, \omega_o) L_i(p, \omega_i) \cos(\theta_i)
\]</div>
<p>where <span class="arithmatex">\(N\)</span> is the number of samples. For uniform sampling, the possibility function is given by:</p>
<div class="arithmatex">\[
p(\omega_i) = \frac{1}{2\pi}
\]</div>
<p>The incident radiance can be obtained by zero-bounce illumination, and <span class="arithmatex">\(\cos(\theta_i)\)</span> is the dot product between the normal and the incident direction.</p>
<p>The uniform hemisphere sampling calculates <span class="arithmatex">\(L_o(p, \omega_o)\)</span> by sampling the hemisphere uniformly and averaging to produce the final result.</p>
<h3 id="homework3-part3-implementation_1">Implementation</h3>
<p>First, a random direction is sampled in the hemisphere space, and its corresponding vector in world space is also prepared to calculate <span class="arithmatex">\(\cos(\theta_i)\)</span>:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework3-part3-__codelineno-1-1"></a><span class="w">      </span><span class="c1">// sample a random direction in the hemisphere</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework3-part3-__codelineno-1-2"></a><span class="w">      </span><span class="n">wi_sample_o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hemisphereSampler</span><span class="o">-&gt;</span><span class="n">get_sample</span><span class="p">();</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework3-part3-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework3-part3-__codelineno-1-4"></a><span class="w">      </span><span class="c1">// transform the sample to world space</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework3-part3-__codelineno-1-5"></a><span class="w">      </span><span class="n">wi_sample_w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework3-part3-__codelineno-1-6"></a><span class="w">      </span><span class="n">wi_sample_w</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework3-part3-__codelineno-1-7"></a><span class="w">      </span><span class="c1">// find cos_theta, which is the dot product of the sample direction and the normal</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework3-part3-__codelineno-1-8"></a><span class="w">      </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">norm</span><span class="p">();</span>
</span></code></pre></div>
<p>Then a sample ray is generated in the direction of the sampled vector, and the incident radiance is calculated by zero-bounce illumination if the ray intersects with the scene:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework3-part3-__codelineno-2-1"></a><span class="w">      </span><span class="c1">// find the light coming from the sample direction</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework3-part3-__codelineno-2-2"></a><span class="w">      </span><span class="c1">// first construct a ray from the hit point to the sample direction</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework3-part3-__codelineno-2-3"></a><span class="w">      </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">);</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework3-part3-__codelineno-2-4"></a><span class="w">      </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework3-part3-__codelineno-2-5"></a><span class="w">      </span><span class="n">Intersection</span><span class="w"> </span><span class="n">sample_isect</span><span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#homework3-part3-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#homework3-part3-__codelineno-2-7"></a><span class="w">      </span><span class="c1">// then check if the ray intersects with any object</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#homework3-part3-__codelineno-2-8"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sample_isect</span><span class="p">))</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#homework3-part3-__codelineno-2-9"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#homework3-part3-__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#homework3-part3-__codelineno-2-11"></a><span class="w">        </span><span class="c1">// use zero bounce radiance to calculate the light coming from the sample direction</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#homework3-part3-__codelineno-2-12"></a><span class="w">        </span><span class="n">wi_sample_incoming_light</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero_bounce_radiance</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">sample_isect</span><span class="p">);</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#homework3-part3-__codelineno-2-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#homework3-part3-__codelineno-2-14"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#homework3-part3-__codelineno-2-15"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#homework3-part3-__codelineno-2-16"></a><span class="w">        </span><span class="c1">// else there&#39;s no light coming from the sample direction</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#homework3-part3-__codelineno-2-17"></a><span class="w">        </span><span class="n">wi_sample_incoming_light</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#homework3-part3-__codelineno-2-18"></a><span class="w">      </span><span class="p">}</span>
</span></code></pre></div>
<p>Finally, the partial result is calculated with Monte Carlo integration and added to the pixel color:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework3-part3-__codelineno-3-1"></a><span class="w">      </span><span class="c1">// for uniform sampling, the probability of each sample is 1 / (2 * PI)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework3-part3-__codelineno-3-2"></a><span class="w">      </span><span class="c1">// now put everything together</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework3-part3-__codelineno-3-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">num_samples</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">cos_theta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_incoming_light</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PI</span><span class="p">));</span>
</span></code></pre></div>
<p>This process is repeated for <code>num_samples</code> times, and the final result is returned.</p>
<h2 id="homework3-part3-importance-sampling">Importance Sampling</h2>
<h3 id="homework3-part3-methodology_2">Methodology</h3>
<p>Unlike uniform sampling, importance sampling only samples in the direction of light sources. The Monte Carlo integration is also implemented. The render equation is the same as the uniform sampling, but the possibility function is different.</p>
<h3 id="homework3-part3-implementation_2">Implementation</h3>
<p>The importance sampler will iterate through all the light sources in the scene. Each light source is first checked if it is a delta light(point light source), this is because the result of a point light source is deterministic and only needs to be calculated once. The area light sources are sampled based on their area, a <code>num_total_samples</code> is maintained to perform the normalizing step in the Monte Carlo integration.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework3-part3-__codelineno-4-1"></a><span class="w">      </span><span class="c1">// sample the light</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework3-part3-__codelineno-4-2"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">light</span><span class="o">-&gt;</span><span class="n">is_delta_light</span><span class="p">())</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework3-part3-__codelineno-4-3"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework3-part3-__codelineno-4-4"></a><span class="w">        </span><span class="n">num_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework3-part3-__codelineno-4-5"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#homework3-part3-__codelineno-4-6"></a><span class="w">      </span><span class="k">else</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#homework3-part3-__codelineno-4-7"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#homework3-part3-__codelineno-4-8"></a><span class="w">        </span><span class="n">num_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns_area_light</span><span class="p">;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#homework3-part3-__codelineno-4-9"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#homework3-part3-__codelineno-4-10"></a><span class="w">      </span><span class="n">num_total_samples</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">num_samples</span><span class="p">;</span>
</span></code></pre></div>
<p>For each sample of each light source, the starter code provides the <code>sample_L</code> function to sample as well as calculates the possibility function.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework3-part3-__codelineno-5-1"></a><span class="w">      </span><span class="c1">// sample the light</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework3-part3-__codelineno-5-2"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_samples</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework3-part3-__codelineno-5-3"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework3-part3-__codelineno-5-4"></a><span class="w">        </span><span class="n">wi_sample_incoming_light</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">sample_L</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dist_to_light</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pdf</span><span class="p">);</span>
</span></code></pre></div>
<p>Again, a ray is generated in the sample direction. However, in importance sampling it is checked that the ray does not hit anything until it reaches the light source.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework3-part3-__codelineno-6-1"></a><span class="w">        </span><span class="c1">// generate a ray from the hit point to the light, check if it hit anything</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#homework3-part3-__codelineno-6-2"></a><span class="w">        </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">);</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#homework3-part3-__codelineno-6-3"></a><span class="w">        </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#homework3-part3-__codelineno-6-4"></a><span class="w">        </span><span class="n">ray</span><span class="p">.</span><span class="n">max_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dist_to_light</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span><span class="w"> </span><span class="c1">// don&#39;t forget to subtract EPS_F to avoid self-intersection</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#homework3-part3-__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#homework3-part3-__codelineno-6-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">has_intersection</span><span class="p">(</span><span class="n">ray</span><span class="p">))</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#homework3-part3-__codelineno-6-7"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#homework3-part3-__codelineno-6-8"></a><span class="w">          </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#homework3-part3-__codelineno-6-9"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>If the ray does not hit anything, the partial result is calculated the same way as in uniform sampling and added to the pixel color.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework3-part3-__codelineno-7-1"></a><span class="w">        </span><span class="c1">// calculate cos_theta</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework3-part3-__codelineno-7-2"></a><span class="w">        </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">norm</span><span class="p">();</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#homework3-part3-__codelineno-7-3"></a><span class="w">        </span><span class="c1">// calculate the sample direction in object space</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#homework3-part3-__codelineno-7-4"></a><span class="w">        </span><span class="n">wi_sample_o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w2o</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#homework3-part3-__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#homework3-part3-__codelineno-7-6"></a><span class="w">        </span><span class="c1">// put everything together</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#homework3-part3-__codelineno-7-7"></a><span class="w">        </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">cos_theta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_incoming_light</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">;</span>
</span></code></pre></div>
<p>Finally, the result is normalized by <code>num_total_samples</code> and returned.</p>
<h2 id="homework3-part3-one-bounce-illumination-and-direct-illumination">One-Bounce Illumination and Direct Illumination</h2>
<p>One-Bounce Illumination function calls different sampling methods based on user selection:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework3-part3-__codelineno-8-1"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="nf">PathTracer::one_bounce_radiance</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Ray</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">,</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#homework3-part3-__codelineno-8-2"></a><span class="w">                                           </span><span class="k">const</span><span class="w"> </span><span class="n">Intersection</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#homework3-part3-__codelineno-8-3"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#homework3-part3-__codelineno-8-4"></a><span class="w">    </span><span class="c1">// TODO: Part 3, Task 3</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#homework3-part3-__codelineno-8-5"></a><span class="w">    </span><span class="c1">// Returns either the direct illumination by hemisphere or importance sampling</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#homework3-part3-__codelineno-8-6"></a><span class="w">    </span><span class="c1">// depending on `direct_hemisphere_sample`</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#homework3-part3-__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#homework3-part3-__codelineno-8-8"></a><span class="w">    </span><span class="c1">// Implementation by Ruhao Tian starts here</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#homework3-part3-__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#homework3-part3-__codelineno-8-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">direct_hemisphere_sample</span><span class="p">)</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#homework3-part3-__codelineno-8-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#homework3-part3-__codelineno-8-12"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">estimate_direct_lighting_hemisphere</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#homework3-part3-__codelineno-8-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#homework3-part3-__codelineno-8-14"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#homework3-part3-__codelineno-8-15"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#homework3-part3-__codelineno-8-16"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">estimate_direct_lighting_importance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#homework3-part3-__codelineno-8-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#homework3-part3-__codelineno-8-18"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p>The direct illumination is estimated by adding the zero-bounce and one-bounce illumination to the pixel color:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#homework3-part3-__codelineno-9-1"></a><span class="w">    </span><span class="c1">// add direct illumination to L_out</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#homework3-part3-__codelineno-9-2"></a><span class="w">    </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">zero_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#homework3-part3-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#homework3-part3-__codelineno-9-4"></a><span class="w">    </span><span class="c1">// TODO (Part 3): Return the direct illumination.</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#homework3-part3-__codelineno-9-5"></a><span class="w">    </span><span class="c1">// add one bounce radiance to L_out</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#homework3-part3-__codelineno-9-6"></a><span class="w">    </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="homework3-part3-results">Results</h2>
<p>The following images show the results of the direct illumination with uniform sampling and importance sampling.</p>
<p><strong>CBbunny.dae</strong></p>
<p>Uniform Sampling</p>
<p><a class="glightbox" href="../images/hw3/part3/hw3part3_CBbunny_64_32_H.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBbunny_uniform" src="../images/hw3/part3/hw3part3_CBbunny_64_32_H.png" /></a></p>
<p>Importance Sampling</p>
<p><a class="glightbox" href="../images/hw3/part3/hw3part3_CBbunny_64_32.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBbunny_importance" src="../images/hw3/part3/hw3part3_CBbunny_64_32.png" /></a></p>
<p><strong>CBspheres_lambertian.dae</strong></p>
<p>Uniform Sampling</p>
<p><a class="glightbox" href="../images/hw3/part3/hw3part3_CBspheres_L_64_32_H.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres_lambertian_uniform" src="../images/hw3/part3/hw3part3_CBspheres_L_64_32_H.png" /></a></p>
<p>Importance Sampling</p>
<p><a class="glightbox" href="../images/hw3/part3/hw3part3_CBspheres_L_64_32.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres_lambertian_importance" src="../images/hw3/part3/hw3part3_CBspheres_L_64_32.png" /></a></p>
<p>From the images, it can be observed that the importance sampling produces a smoother result than the uniform sampling. This is because, given the same amount of samples per pixel and per light source, the importance sampling will concentrate more samples on the light sources, which is more efficient than uniformly sampling the hemisphere. Uniform sampling, on the other hand, will waste samples on the directions that do not contribute to the final result, which is why the result is noisier.</p>
<p>The following images are the results of the importance sampling with 1, 4, 16, and 64 light rays and 1 sample per pixel of the <code>CBspheres_lambertian.dae</code> scene.</p>
<p><a class="glightbox" href="../images/hw3/part3/hw3part3_CBsphere_L_1_1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres_lambertian_importance_1" src="../images/hw3/part3/hw3part3_CBsphere_L_1_1.png" width="49%" /></a>
<a class="glightbox" href="../images/hw3/part3/hw3part3_CBsphere_L_1_4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres_lambertian_importance_4" src="../images/hw3/part3/hw3part3_CBsphere_L_1_4.png" width="49%" /></a>
<a class="glightbox" href="../images/hw3/part3/hw3part3_CBsphere_L_1_16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres_lambertian_importance_16" src="../images/hw3/part3/hw3part3_CBsphere_L_1_16.png" width="49%" /></a>
<a class="glightbox" href="../images/hw3/part3/hw3part3_CBsphere_L_1_64.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBspheres_lambertian_importance_64" src="../images/hw3/part3/hw3part3_CBsphere_L_1_64.png" width="49%" /></a></p>
<p>According to the images, the result becomes smoother as the number of light rays increases. This is because the more light rays are sampled, the more accurate the result will be. However, the result will also be more noisy if the number of samples per pixel is low. This is why the result is still noisy with 64 light rays and 1 sample per pixel. The result will be smoother if the number of samples per pixel is increased, but it will also be more computationally expensive. Therefore, the number of samples per pixel should be chosen based on the trade-off between the quality of the result and the computational cost.</p></section><section class="print-page" id="homework3-part4"><h1 id="homework3-part4-part4-global-illumination">Part4: Global Illumination</h1>
<h2 id="homework3-part4-sampling-with-diffuse-bsdf">Sampling with Diffuse BSDF</h2>
<h3 id="homework3-part4-methodology">Methodology</h3>
<p>Using <span class="arithmatex">\(sampler.get_sample(pdf)\)</span>, a random sample direction is obtained from the cosine-weighted hemisphere distribution. Next, the obtained sample direction <span class="arithmatex">\(wi\)</span> is used as the incoming light direction, and the <span class="arithmatex">\(f\)</span> function is called to compute the BSDF evaluation of the diffuse material at <span class="arithmatex">\((wo, *wi)\)</span>.</p>
<h3 id="homework3-part4-implementation">Implementation</h3>
<p>The function <span class="arithmatex">\(f\)</span> is defined in Part 3.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework3-part4-__codelineno-0-1"></a><span class="w">  </span><span class="o">*</span><span class="n">wi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampler</span><span class="p">.</span><span class="n">get_sample</span><span class="p">(</span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework3-part4-__codelineno-0-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">wo</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">wi</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="homework3-part4-global-illumination-with-up-to-n-bounces-of-light">Global Illumination with up to N Bounces of Light</h2>
<h3 id="homework3-part4-methodology_1">Methodology</h3>
<p>The following is the rendering equation.</p>
<p><a class="glightbox" href="../images/hw3/part4/example1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rendering equation" src="../images/hw3/part4/example1.png" /></a></p>
<p>Simplify:</p>
<p><a class="glightbox" href="../images/hw3/part4/example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rendering equation simplify" src="../images/hw3/part4/example2.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part4/example3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rendering equation K" src="../images/hw3/part4/example3.png" /></a></p>
<p>Solve the equation:</p>
<p><a class="glightbox" href="../images/hw3/part4/example4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="solve" src="../images/hw3/part4/example4.png" /></a></p>
<h3 id="homework3-part4-implementation_1">Implementation</h3>
<h4 id="homework3-part4-at_least_one_bounce_radiance">at_least_one_bounce_radiance</h4>
<p>If <span class="arithmatex">\(r.depth == max_ray_depth - 1\)</span>, this means the maximum depth has been reached. L_out just needs to add the value of this diffuse reflection, which is the function <span class="arithmatex">\(one_bounce_radiance\)</span>.</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework3-part4-__codelineno-1-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAccumBounces</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework3-part4-__codelineno-1-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework3-part4-__codelineno-1-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework3-part4-__codelineno-1-4"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
Check if the maximum depth is reached. If true, return the L_out. Otherwise, continue operating the rest of the code.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework3-part4-__codelineno-2-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework3-part4-__codelineno-2-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework3-part4-__codelineno-2-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework3-part4-__codelineno-2-4"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>Now, calculate the radiance from extra bounces. First, obtain a ray from the hit point to the sample direction. </p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework3-part4-__codelineno-3-1"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework3-part4-__codelineno-3-2"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">pdf</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework3-part4-__codelineno-3-3"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_incoming_light</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework3-part4-__codelineno-3-4"></a><span class="w">  </span><span class="n">Ray</span><span class="w"> </span><span class="n">ray</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#homework3-part4-__codelineno-3-5"></a><span class="w">  </span><span class="n">Intersection</span><span class="w"> </span><span class="n">isect_light</span><span class="p">;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#homework3-part4-__codelineno-3-6"></a><span class="w">  </span><span class="c1">// sample the next direction</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#homework3-part4-__codelineno-3-7"></a><span class="w">  </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">sample_f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#homework3-part4-__codelineno-3-8"></a><span class="w">  </span><span class="c1">// transform the sample direction to object space</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#homework3-part4-__codelineno-3-9"></a><span class="w">  </span><span class="n">wi_sample_w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#homework3-part4-__codelineno-3-10"></a><span class="w">  </span><span class="c1">// generate a ray from the hit point to the sample direction</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#homework3-part4-__codelineno-3-11"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">.</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#homework3-part4-__codelineno-3-12"></a><span class="w">    </span><span class="n">norm</span><span class="p">();</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#homework3-part4-__codelineno-3-13"></a><span class="w">  </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">);</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#homework3-part4-__codelineno-3-14"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#homework3-part4-__codelineno-3-15"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span>
</span></code></pre></div>
<p>Next, recurse this equation until reaching max_ray_depth(this was checked before).</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework3-part4-__codelineno-4-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect_light</span><span class="p">))</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework3-part4-__codelineno-4-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework3-part4-__codelineno-4-3"></a><span class="w">    </span><span class="c1">// calculate the radiance from the extra bounces</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework3-part4-__codelineno-4-4"></a><span class="w">    </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="w">    </span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework3-part4-__codelineno-4-5"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<h4 id="homework3-part4-est_radiance_global_illumination">est_radiance_global_illumination</h4>
<p>Just need to accumulate the result each time.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework3-part4-__codelineno-5-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework3-part4-__codelineno-5-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#homework3-part4-__codelineno-5-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#homework3-part4-__codelineno-5-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<h2 id="homework3-part4-global-illumination-with-russian-roulette">Global Illumination with Russian Roulette</h2>
<h3 id="homework3-part4-methodology_2">Methodology</h3>
<p>Now we have set a probability between 0.3 and 0.4 (implemented as 0.35) as the probability for early termination. Due to the influence of probability, we need to normalize the result. The core idea is shown in the diagram below.</p>
<p><a class="glightbox" href="../images/hw3/part4/example5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rus" src="../images/hw3/part4/example5.png" /></a></p>
<h3 id="homework3-part4-implementation_2">Implementation</h3>
<p>We just need to make some small adjustments to the function <span class="arithmatex">\(at_least_one_bounce_radiance\)</span>. The adjusted code is as follows.</p>
<p>First, set the possibility.</p>
<p><div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework3-part4-__codelineno-6-1"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">possibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.35</span><span class="p">;</span>
</span></code></pre></div>
Next, check whether to terminate early.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework3-part4-__codelineno-7-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">coin_flip</span><span class="p">(</span><span class="n">possibility</span><span class="p">)){</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework3-part4-__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#homework3-part4-__codelineno-7-3"></a><span class="w">  </span><span class="c1">//Here, a lot of code has been omitted.</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#homework3-part4-__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#homework3-part4-__codelineno-7-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#homework3-part4-__codelineno-7-6"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p>At last, normalize. Note that the code below has an additional parameter <span class="arithmatex">\(probability\)</span>.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework3-part4-__codelineno-8-1"></a><span class="w">  </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">possibility</span><span class="p">;</span>
</span></code></pre></div>
<p>Finally, here is the overall code. This is very similar to the previous section, so you don't need to pay too much attention to these codes.</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#homework3-part4-__codelineno-9-1"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAccumBounces</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#homework3-part4-__codelineno-9-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#homework3-part4-__codelineno-9-3"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">one_bounce_radiance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">);</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#homework3-part4-__codelineno-9-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#homework3-part4-__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#homework3-part4-__codelineno-9-6"></a><span class="w">  </span><span class="c1">// check if the maximum depth is reached</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#homework3-part4-__codelineno-9-7"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_ray_depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#homework3-part4-__codelineno-9-8"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#homework3-part4-__codelineno-9-9"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#homework3-part4-__codelineno-9-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#homework3-part4-__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#homework3-part4-__codelineno-9-12"></a><span class="w">  </span><span class="c1">// if not, calculate the radiance from extra bounces</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#homework3-part4-__codelineno-9-13"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#homework3-part4-__codelineno-9-14"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">pdf</span><span class="p">;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#homework3-part4-__codelineno-9-15"></a><span class="w">  </span><span class="n">Vector3D</span><span class="w"> </span><span class="n">wi_sample_incoming_light</span><span class="p">;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#homework3-part4-__codelineno-9-16"></a><span class="w">  </span><span class="n">Ray</span><span class="w"> </span><span class="n">ray</span><span class="p">;</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#homework3-part4-__codelineno-9-17"></a><span class="w">  </span><span class="n">Intersection</span><span class="w"> </span><span class="n">isect_light</span><span class="p">;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#homework3-part4-__codelineno-9-18"></a><span class="w">  </span><span class="c1">// sample the next direction</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#homework3-part4-__codelineno-9-19"></a><span class="w">  </span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">sample_f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wi_sample_o</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pdf</span><span class="p">);</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#homework3-part4-__codelineno-9-20"></a><span class="w">  </span><span class="c1">// transform the sample direction to object space</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#homework3-part4-__codelineno-9-21"></a><span class="w">  </span><span class="n">wi_sample_w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o2w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">;</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#homework3-part4-__codelineno-9-22"></a><span class="w">  </span><span class="c1">// generate a ray from the hit point to the sample direction</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#homework3-part4-__codelineno-9-23"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">wi_sample_w</span><span class="p">,</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">isect</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">norm</span><span class="p">();</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#homework3-part4-__codelineno-9-24"></a><span class="w">  </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ray</span><span class="p">(</span><span class="n">hit_p</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_w</span><span class="p">);</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#homework3-part4-__codelineno-9-25"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#homework3-part4-__codelineno-9-26"></a><span class="w">  </span><span class="n">ray</span><span class="p">.</span><span class="n">min_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPS_F</span><span class="p">;</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#homework3-part4-__codelineno-9-27"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bvh</span><span class="o">-&gt;</span><span class="n">intersect</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">coin_flip</span><span class="p">(</span><span class="n">possibility</span><span class="p">))</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#homework3-part4-__codelineno-9-28"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#homework3-part4-__codelineno-9-29"></a><span class="w">    </span><span class="c1">// calculate the radiance from the extra bounces</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#homework3-part4-__codelineno-9-30"></a><span class="w">    </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">isect</span><span class="p">.</span><span class="n">bsdf</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">(</span><span class="n">w_out</span><span class="p">,</span><span class="w"> </span><span class="n">wi_sample_o</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">at_least_one_bounce_radiance</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">isect_light</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos_theta</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pdf</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">possibility</span><span class="p">;</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#homework3-part4-__codelineno-9-31"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#homework3-part4-__codelineno-9-32"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">L_out</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework3-part4-results">Results</h2>
<h3 id="homework3-part4-here-are-some-direct-and-indirect-illumination">Here are some direct and indirect illumination.</h3>
<h3 id="homework3-part4-direct">Direct</h3>
<p><a class="glightbox" href="../images/hw3/part4/direct_example1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/direct_example1.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part4/direct_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/direct_example2.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part4/direct_example3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/direct_example3.png" /></a></p>
<h3 id="homework3-part4-indirectonly-sum-m2345">Indirect(only sum m=2,3,4,5)</h3>
<p><a class="glightbox" href="../images/hw3/part4/indirect_example1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/indirect_example1.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part4/indirect_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/indirect_example2.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part4/indirect_example3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/indirect_example3.png" /></a></p>
<h3 id="homework3-part4-compare">Compare</h3>
<p><a class="glightbox" href="../images/hw3/part4/direct_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/direct_example2.png" /></a></p>
<p><a class="glightbox" href="../images/hw3/part4/indirect_example2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/indirect_example2.png" /></a></p>
<p>We can find that the direct illumination is more smooth and lighter than the indirect one.</p>
<h3 id="homework3-part4-here-are-the-results-for-rendering-the-mth-bounce-of-light-with-max_ray_depth-set-to-0-1-2-3-4-and-5-and-isaccumbouncesfalse-for-cbbunnydae">Here are the results for rendering the mth bounce of light with max_ray_depth set to 0, 1, 2, 3, 4, and 5, and isAccumBounces=false, for CBbunny.dae</h3>
<h3 id="homework3-part4-m0">m=0</h3>
<p><a class="glightbox" href="../images/hw3/part4/notsum_m%3D00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/notsum_m%3D00.png" /></a></p>
<h3 id="homework3-part4-m1">m=1</h3>
<p><a class="glightbox" href="../images/hw3/part4/notsum_m%3D10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=1" src="../images/hw3/part4/notsum_m%3D10.png" /></a></p>
<h3 id="homework3-part4-m2">m=2</h3>
<p><a class="glightbox" href="../images/hw3/part4/notsum_m%3D20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=2" src="../images/hw3/part4/notsum_m%3D20.png" /></a></p>
<h3 id="homework3-part4-m3">m=3</h3>
<p><a class="glightbox" href="../images/hw3/part4/notsum_m%3D30.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=3" src="../images/hw3/part4/notsum_m%3D30.png" /></a></p>
<h3 id="homework3-part4-m4">m=4</h3>
<p><a class="glightbox" href="../images/hw3/part4/notsum_m%3D40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=4" src="../images/hw3/part4/notsum_m%3D40.png" /></a></p>
<h3 id="homework3-part4-m5">m=5</h3>
<p><a class="glightbox" href="../images/hw3/part4/notsum_m%3D50.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=5" src="../images/hw3/part4/notsum_m%3D50.png" /></a></p>
<h3 id="homework3-part4-reason">Reason</h3>
<p>This is because each time the light reflects off a surface, some of its energy is absorbed or scattered, leading to an overall decrease in brightness with each subsequent bounce. As the number of reflections increases for the second and third bounces of light, the intensity of light diminishes, resulting in the images becoming progressively darker. </p>
<p>The main reason it improves the quality of rendered images is that multiple reflections simulate the paths of real light in the physical world, making the images more closely resemble what we see in reality. This enhances the realism of the images. For example, multiple reflections result in more accurate and realistic shadows, which contribute to a more lifelike appearance.</p>
<h3 id="homework3-part4-here-are-the-results-for-rendered-views-with-max_ray_depth-set-to-0-1-2-3-4-and-5-for-cbbunnydae">Here are the results for rendered views with max_ray_depth set to 0, 1, 2, 3, 4, and 5  for CBbunny.dae</h3>
<h3 id="homework3-part4-m0_1">m=0</h3>
<p><a class="glightbox" href="../images/hw3/part4/sum_m%3D00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sum_m%3D00.png" /></a></p>
<h3 id="homework3-part4-m1_1">m=1</h3>
<p><a class="glightbox" href="../images/hw3/part4/sum_m%3D10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=1" src="../images/hw3/part4/sum_m%3D10.png" /></a></p>
<h3 id="homework3-part4-m2_1">m=2</h3>
<p><a class="glightbox" href="../images/hw3/part4/sum_m%3D20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=2" src="../images/hw3/part4/sum_m%3D20.png" /></a></p>
<h3 id="homework3-part4-m3_1">m=3</h3>
<p><a class="glightbox" href="../images/hw3/part4/sum_m%3D30.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=3" src="../images/hw3/part4/sum_m%3D30.png" /></a></p>
<h3 id="homework3-part4-m4_1">m=4</h3>
<p><a class="glightbox" href="../images/hw3/part4/sum_m%3D40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=4" src="../images/hw3/part4/sum_m%3D40.png" /></a></p>
<h3 id="homework3-part4-m5_1">m=5</h3>
<p><a class="glightbox" href="../images/hw3/part4/sum_m%3D50.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=5" src="../images/hw3/part4/sum_m%3D50.png" /></a></p>
<h3 id="homework3-part4-compare_1">Compare</h3>
<p>We can find that as m increases, the picture becomes brighter and brighter.</p>
<h3 id="homework3-part4-here-are-the-results-for-outputing-the-russian-roulette-rendering-with-max_ray_depth-set-to-0-1-2-3-4-and-100-for-cbbunnydae">Here are the results for outputing the Russian Roulette rendering with max_ray_depth set to 0, 1, 2, 3, 4, and 100  for CBbunny.dae</h3>
<h3 id="homework3-part4-m0_2">m=0</h3>
<p><a class="glightbox" href="../images/hw3/part4/rus_sum_m%3D00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/rus_sum_m%3D00.png" /></a></p>
<h3 id="homework3-part4-m1_2">m=1</h3>
<p><a class="glightbox" href="../images/hw3/part4/rus_sum_m%3D10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=1" src="../images/hw3/part4/rus_sum_m%3D10.png" /></a></p>
<h3 id="homework3-part4-m2_2">m=2</h3>
<p><a class="glightbox" href="../images/hw3/part4/rus_sum_m%3D20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=2" src="../images/hw3/part4/rus_sum_m%3D20.png" /></a></p>
<h3 id="homework3-part4-m3_2">m=3</h3>
<p><a class="glightbox" href="../images/hw3/part4/rus_sum_m%3D30.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=3" src="../images/hw3/part4/rus_sum_m%3D30.png" /></a></p>
<h3 id="homework3-part4-m4_2">m=4</h3>
<p><a class="glightbox" href="../images/hw3/part4/rus_sum_m%3D40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=4" src="../images/hw3/part4/rus_sum_m%3D40.png" /></a></p>
<h3 id="homework3-part4-m100">m=100</h3>
<p><a class="glightbox" href="../images/hw3/part4/rus_sum_m%3D1000.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=100" src="../images/hw3/part4/rus_sum_m%3D1000.png" /></a></p>
<h3 id="homework3-part4-the-following-are-rendering-pictures-of-the-same-scene-with-different-sampling-rates">The following are rendering pictures of the same scene with different sampling rates.</h3>
<h3 id="homework3-part4-sample-per-pixel-rate1">sample-per-pixel rate=1</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample1.png" /></a></p>
<h3 id="homework3-part4-sample-per-pixel-rate2">sample-per-pixel rate=2</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample2.png" /></a></p>
<h3 id="homework3-part4-sample-per-pixel-rate4">sample-per-pixel rate=4</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample4.png" /></a></p>
<h3 id="homework3-part4-sample-per-pixel-rate8">sample-per-pixel rate=8</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample8.png" /></a></p>
<h3 id="homework3-part4-sample-per-pixel-rate16">sample-per-pixel rate=16</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample16.png" /></a></p>
<h3 id="homework3-part4-sample-per-pixel-rate64">sample-per-pixel rate=64</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample64.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample64.png" /></a></p>
<h3 id="homework3-part4-sample-per-pixel-rate1024">sample-per-pixel rate=1024</h3>
<p><a class="glightbox" href="../images/hw3/part4/sample12.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="m=0" src="../images/hw3/part4/sample12.png" /></a></p>
<h3 id="homework3-part4-compare_2">Compare</h3>
<p>As the sample-per-pixel rate increases, the image will become smoother and smoother. At the same time, the brightness will also increase slightly.</p></section><section class="print-page" id="homework3-part5"><h1 id="homework3-part5-part5-adaptive-sampling">Part5: Adaptive Sampling</h1>
<h2 id="homework3-part5-methodology">Methodology</h2>
<p>The high-level idea of adaptive sampling is to reduce the sampling number of pixels that converge to a certain color quickly and focus on the pixels that take longer to converge. A variable <span class="arithmatex">\(I\)</span> is maintained to measure the convergence of the pixel:</p>
<div class="arithmatex">\[
I = 1.96 \frac{\sigma}{\sqrt{n}}
\]</div>
<p>where <span class="arithmatex">\(\sigma\)</span> is the standard deviation of the pixel color samples, and <span class="arithmatex">\(n\)</span> is the number of samples.</p>
<p><span class="arithmatex">\(I\)</span> decreases as the number of samples increases and the standard deviation decreases. When <span class="arithmatex">\(I\)</span> is less than a certain threshold, the pixel is considered to have converged, and the sampling process stops. The threshold is given by:</p>
<div class="arithmatex">\[
I_{\text{threshold}} = \text{maxTolerance} \times \mu
\]</div>
<p>where <span class="arithmatex">\(\mu\)</span> is the mean of the pixel color samples, and <span class="arithmatex">\(\text{maxTolerance}\)</span> is a user-defined parameter, which is set to 0.05 by default.</p>
<h2 id="homework3-part5-implementation">Implementation</h2>
<p>To calculate convergence, two variables <code>total_illumination</code> and <code>total_illumination_squared</code> are maintained:</p>
<div class="arithmatex">\[
\begin{aligned}
\text{total_illumination} &amp;= \sum_{k=1}^{n} x_{k} \\
\text{total_illumination_squared} &amp;= \sum_{k=1}^{n} x_{k}^{2}
\end{aligned}
\]</div>
<p>where <span class="arithmatex">\(x_{k}\)</span> is the illumination of sample <span class="arithmatex">\(k\)</span>.</p>
<p>For one sample, first, the normal sample process mentioned in Part1 is executed:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework3-part5-__codelineno-0-1"></a><span class="w">        </span><span class="c1">// generate a random sample</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework3-part5-__codelineno-0-2"></a><span class="w">        </span><span class="n">current_sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gridSampler</span><span class="o">-&gt;</span><span class="n">get_sample</span><span class="p">();</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework3-part5-__codelineno-0-3"></a><span class="w">        </span><span class="c1">// don&#39;t forget to normalize the sample</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework3-part5-__codelineno-0-4"></a><span class="w">        </span><span class="n">xsample_normalized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">current_sample</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleBuffer</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework3-part5-__codelineno-0-5"></a><span class="w">        </span><span class="n">ysample_normalized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">current_sample</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleBuffer</span><span class="p">.</span><span class="n">h</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework3-part5-__codelineno-0-6"></a><span class="w">        </span><span class="c1">// generate a random ray</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#homework3-part5-__codelineno-0-7"></a><span class="w">        </span><span class="n">current_ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="o">-&gt;</span><span class="n">generate_ray</span><span class="p">(</span><span class="n">xsample_normalized</span><span class="p">,</span><span class="w"> </span><span class="n">ysample_normalized</span><span class="p">);</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#homework3-part5-__codelineno-0-8"></a><span class="w">        </span><span class="c1">// trace the ray</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#homework3-part5-__codelineno-0-9"></a><span class="w">        </span><span class="n">current_radiance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">est_radiance_global_illumination</span><span class="p">(</span><span class="n">current_ray</span><span class="p">);</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#homework3-part5-__codelineno-0-10"></a><span class="w">        </span><span class="n">L_out</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">current_radiance</span><span class="p">;</span>
</span></code></pre></div>
<p>After the normal sample process, the illumination of the current sample is added to <code>total_illumination`` and</code>total_illumination_squared`:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework3-part5-__codelineno-1-1"></a><span class="w">        </span><span class="n">current_illumination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_radiance</span><span class="p">.</span><span class="n">illum</span><span class="p">();</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework3-part5-__codelineno-1-2"></a><span class="w">        </span><span class="n">total_illumination</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">current_illumination</span><span class="p">;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework3-part5-__codelineno-1-3"></a><span class="w">        </span><span class="n">total_illumination_squared</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">current_illumination</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">current_illumination</span><span class="p">;</span>
</span></code></pre></div>
<p>For more efficient processing, the convergence is tested every <code>samplesPerBatch</code> samples:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework3-part5-__codelineno-2-1"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">samplesPerBatch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#homework3-part5-__codelineno-2-2"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#homework3-part5-__codelineno-2-3"></a><span class="w">          </span><span class="c1">// check convergence of the pixel</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#homework3-part5-__codelineno-2-4"></a><span class="w">          </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total_illumination</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#homework3-part5-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#homework3-part5-__codelineno-2-6"></a><span class="w">          </span><span class="n">deviation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">((</span><span class="n">total_illumination_squared</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#homework3-part5-__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#homework3-part5-__codelineno-2-8"></a><span class="w">          </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.96</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deviation</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#homework3-part5-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#homework3-part5-__codelineno-2-10"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">maxTolerance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#homework3-part5-__codelineno-2-11"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#homework3-part5-__codelineno-2-12"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#homework3-part5-__codelineno-2-13"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#homework3-part5-__codelineno-2-14"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>If the pixel color is difficult to converge, it is sampled at most <code>ns_aa</code> time, which is the sample number in normal sampling in Part 1.</p>
<p>After the sample process is finished, total radiance <code>L_out</code> is normalized by the actual sample time <code>i</code> and assigned to the sample buffer:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework3-part5-__codelineno-3-1"></a><span class="w">      </span><span class="c1">// take the average of all the samples</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework3-part5-__codelineno-3-2"></a><span class="w">      </span><span class="n">L_out</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework3-part5-__codelineno-3-3"></a><span class="w">      </span><span class="c1">// update the sample buffer</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework3-part5-__codelineno-3-4"></a><span class="w">      </span><span class="n">sampleBuffer</span><span class="p">.</span><span class="n">update_pixel</span><span class="p">(</span><span class="n">L_out</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#homework3-part5-__codelineno-3-5"></a><span class="w">      </span><span class="n">sampleCountBuffer</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sampleBuffer</span><span class="p">.</span><span class="n">w</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="homework3-part5-result">Result</h2>
<p>The following figures are two scenes rendered with 2048 samples per pixel, a max ray depth of 5 and 1 sample per light.</p>
<p><strong>CBbunny.dae</strong></p>
<p>Render result</p>
<p><a class="glightbox" href="../images/hw3/part5/hw3part5_bunny.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBbunny" src="../images/hw3/part5/hw3part5_bunny.png" /></a></p>
<p>Sample rate image</p>
<p><a class="glightbox" href="../images/hw3/part5/hw3part5_bunny_rate.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBbunny" src="../images/hw3/part5/hw3part5_bunny_rate.png" /></a></p>
<p><strong>CBdragon.dae</strong></p>
<p>Render result</p>
<p><a class="glightbox" href="../images/hw3/part5/hw3part5_CBdragon.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBdragon" src="../images/hw3/part5/hw3part5_CBdragon.png" /></a></p>
<p>Sample rate image</p>
<p><a class="glightbox" href="../images/hw3/part5/hw3part5_CBdragon_rate.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="CBdragon" src="../images/hw3/part5/hw3part5_CBdragon_rate.png" /></a></p></section><h1 class='nav-section-title-end'>Ended: Homework3</h1>
                        <h1 class='nav-section-title' id='section-homework4'>
                            Homework4 <a class='headerlink' href='#section-homework4' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="homework4-overview"><h1 id="homework4-overview-homework4-clothsim-overview">Homework4: Clothsim Overview</h1>
<h2 id="homework4-overview-overview">Overview</h2>
<p>Working in progress...</p>
<details class="warning">
<summary>Note for PDF</summary>
<p>Some features of the website, such as picture lightbox, may not be available in the PDF version. We recommend reading the <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-RuhaoT">website</a> directly for the best experience.</p>
</details></section><section class="print-page" id="homework4-part1"><h1 id="homework4-part1-part-1-masses-and-springs">Part 1: Masses and springs</h1>
<h2 id="homework4-part1-results">Results</h2>
<p>Note: The blurriness comes from the low resolution of the screenshot.
The following images show the result of scene/pinned2.json at default parameters:</p>
<p><a class="glightbox" href="../images/hw4/part_1/pinned2_1.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="pinned2_1" src="../images/hw4/part_1/pinned2_1.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part_1/pinned2_2.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="pinned2_2" src="../images/hw4/part_1/pinned2_2.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part_1/pinned2_3.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="pinned2_3" src="../images/hw4/part_1/pinned2_3.PNG" width="49%" /></a></p>
<h3 id="homework4-part1-wireframe-with-specific-conditions">Wireframe with specific conditions</h3>
<p><strong>Without any shearing constraints</strong></p>
<p><a class="glightbox" href="../images/hw4/part_1/without.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="without" src="../images/hw4/part_1/without.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part_1/without2.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="without2" src="../images/hw4/part_1/without2.PNG" width="49%" /></a></p>
<p><strong>With only shearing constraints</strong></p>
<p><a class="glightbox" href="../images/hw4/part_1/onlywith.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="only with" src="../images/hw4/part_1/onlywith.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part_1/onlywith2.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="only with2" src="../images/hw4/part_1/onlywith2.PNG" width="49%" /></a></p>
<p><strong>With all constraints</strong></p>
<p><a class="glightbox" href="../images/hw4/part_1/withall.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="with all" src="../images/hw4/part_1/withall.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part_1/withall2.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="with all2" src="../images/hw4/part_1/withall2.PNG" width="49%" /></a></p></section><section class="print-page" id="homework4-part2"><h1 id="homework4-part2-part-2-simulation-via-numerical-integration">Part 2: Simulation via numerical integration</h1>
<p>Note: The units of the following data are all default units.</p>
<h2 id="homework4-part2-changing-the-spring-constant-ks">Changing the spring constant ks</h2>
<p><strong>ks=50000</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/highks.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="high ks" src="../images/hw4/part2/highks.PNG" width="49%" /></a></p>
<p><strong>ks=5000</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/defaultks.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="default ks" src="../images/hw4/part2/defaultks.PNG" width="49%" /></a></p>
<p><strong>ks=500</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/lowks.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="low ks" src="../images/hw4/part2/lowks.PNG" width="49%" /></a></p>
<p>Description: 
All these pictures are taken when the cloth becomes static. As ks increases,
the spring becomes more difficult to extend and compress. This will cause the fabric to feel tighter. In the picture, it is obvious that the lowest point in the middle of the fabric has been decreasing, and the wrinkles have also increased. Not only that, the acceleration of the cloth will also increase (in the same posture).</p>
<h2 id="homework4-part2-changing-the-density">Changing the density</h2>
<p><strong>density=150</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/highdensity.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="high density" src="../images/hw4/part2/highdensity.PNG" width="49%" /></a></p>
<p><strong>density=15</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/defaultdensity.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="default density" src="../images/hw4/part2/defaultdensity.PNG" width="49%" /></a></p>
<p><strong>density=1.5</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/lowdensity.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="low density" src="../images/hw4/part2/lowdensity.PNG" width="49%" /></a></p>
<p>Description:
All these pictures are taken when the cloth becomes static. The effect of changing this parameter is the same as changing ks (in the case of Part 2, i.e. collisions are not considered). Because density is proportional to gravity, gravity is equal to the change of the spring times ks. Therefore, as the density increases, the center becomes lower and lower, and there are more and more wrinkles. Not only that, the acceleration of the cloth will also increase (in the same posture)</p>
<h2 id="homework4-part2-changing-the-damping">Changing the damping</h2>
<p><strong>damping approximately equal to 0.9, time= 10s</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/highdamping.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="high damping" src="../images/hw4/part2/highdamping.PNG" width="49%" /></a></p>
<p><strong>damping approximately equal to 0.5, time= 10s</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/middamping.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="mid damping" src="../images/hw4/part2/middamping.PNG" width="49%" /></a></p>
<p><strong>damping approximately equal to 0.1, time= 10s</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/lowdamping.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="low damping" src="../images/hw4/part2/lowdamping.PNG" width="49%" /></a></p>
<p><strong>damping = 0</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/zerodamping.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="zero damping" src="../images/hw4/part2/zerodamping.PNG" width="49%" /></a></p>
<p><strong>The following are two images representing arbitrary damping when the cloth is still and does not change.</strong></p>
<p><a class="glightbox" href="../images/hw4/part2/stabilityhighdamping.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="stability high damping" src="../images/hw4/part2/stabilityhighdamping.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part2/stabilitylowdamping.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="stability low damping" src="../images/hw4/part2/stabilitylowdamping.PNG" width="49%" /></a></p>
<p>Description:
The three pictures above are images of the cloth running from the initial state for 10 seconds. Obviously, the smaller the damping, the faster the cloth will fall. The two pictures below show that when the object is stationary, changing the damping will have no effect (after all, it is not moving). The special case is that the damping is 0. The cloth will never stop due to energy conservation.</p>
<h2 id="homework4-part2-scenepinned4json-in-its-final-resting-state">scene/pinned4.json in its final resting state</h2>
<p><a class="glightbox" href="../images/hw4/part2/result1.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="result1" src="../images/hw4/part2/result1.PNG" width="49%" /></a></p>
<p><a class="glightbox" href="../images/hw4/part2/result2.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="result2" src="../images/hw4/part2/result2.PNG" width="49%" /></a></p></section><section class="print-page" id="homework4-part3"><h1 id="homework4-part3-part-3-handling-collisions-with-other-objects">Part 3: Handling collisions with other objects</h1>
<p>Note: The units of the following data are all default units.</p>
<h2 id="homework4-part3-scenespherejson-in-its-final-resting-state">scene/sphere.json in its final resting state</h2>
<p><strong>ks=50000</strong></p>
<p><a class="glightbox" href="../images/hw4/part3/high.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="high" src="../images/hw4/part3/high.PNG" width="49%" /></a></p>
<p><strong>ks=5000</strong></p>
<p><a class="glightbox" href="../images/hw4/part3/default.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="default" src="../images/hw4/part3/default.PNG" width="49%" /></a></p>
<p><strong>ks=500</strong></p>
<p><a class="glightbox" href="../images/hw4/part3/low.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="low" src="../images/hw4/part3/low.PNG" width="49%" /></a></p>
<p>Description:
This is because as the spring constant ks increases, the spring becomes harder to extend (or compress). This results in the fabric appearing tighter. The most noticeable effect is that as ks increases, the lowest point of the fabric rises.</p>
<h2 id="homework4-part3-shaded-cloth-lying-peacefully-at-rest-on-the-plane">Shaded cloth lying peacefully at rest on the plane</h2>
<p><a class="glightbox" href="../images/hw4/part3/plane.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="plane" src="../images/hw4/part3/plane.PNG" width="49%" /></a></p></section><section class="print-page" id="homework4-part4"><h1 id="homework4-part4-part4-handling-self-collisions">Part4: Handling self-collisions</h1>
<h2 id="homework4-part4-implementation">Implementation</h2>
<p>To generate a hash value for each point mass, we partitioned the space according to the instructions. To make the hash value unique, we scale the coordinate in each dimension by a factor that is larger than the maximum partition number of all dimensions. The space is partitioned by <span class="arithmatex">\(w * h * t\)</span>, where <span class="arithmatex">\(t = max(w,h)\)</span>, so the multiplication factor is <span class="arithmatex">\(t\)</span>. The hash value is calculated as follows:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework4-part4-__codelineno-0-1"></a><span class="w">  </span><span class="c1">// compute a unique float identifier</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework4-part4-__codelineno-0-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">box_position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">box_position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">box_position</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
</span></code></pre></div>
<p>Besides choosing the float identifier, the rest process of handling self-collisions is the same as the instruction.</p>
<h2 id="homework4-part4-results">Results</h2>
<p>The following images show the result at default parameters:</p>
<p><a class="glightbox" href="../images/hw4/part4/hw4part4_initial.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 1" src="../images/hw4/part4/hw4part4_initial.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part4/hw4part4_firstcollision.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 2" src="../images/hw4/part4/hw4part4_firstcollision.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part4/hw4part4_multiplecollision.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 3" src="../images/hw4/part4/hw4part4_multiplecollision.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part4/hw4part4_restfulstate.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 4" src="../images/hw4/part4/hw4part4_restfulstate.png" width="49%" /></a></p>
<p>Then we tested the simulation with different densities and spring constant.</p>
<details class="warning">
<summary>Note for PDF</summary>
<p>The following GIFs may not be displayed correctly in the PDF version. We recommend reading the <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-RuhaoT">website</a> directly for the best experience.</p>
</details>
<p><strong>Density = 150, ks = 5000 &amp; Density = 1.5, ks = 5000</strong></p>
<p><a class="glightbox" href="../images/hw4/part4/hw4part4d150k5000.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 5" src="../images/hw4/part4/hw4part4d150k5000.gif" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part4/hw4part4d1.5k5000.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 6" src="../images/hw4/part4/hw4part4d1.5k5000.gif" width="49%" /></a></p>
<p><strong>Density = 15, ks = 50000 &amp; Density = 15, ks = 500</strong></p>
<p><a class="glightbox" href="../images/hw4/part4/hw4part4d15k50000.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 7" src="../images/hw4/part4/hw4part4d15k50000.gif" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part4/hw4part4d15k500.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 8" src="../images/hw4/part4/hw4part4d15k500.gif" width="49%" /></a></p>
<p><strong>Density = 150, ks = 50000 &amp; Density = 1.5, ks = 500</strong></p>
<p><a class="glightbox" href="../images/hw4/part4/hw4part4d150k50000.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 9" src="../images/hw4/part4/hw4part4d150k50000.gif" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part4/hw4part4d1.5k500.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Self-Collisions 10" src="../images/hw4/part4/hw4part4d1.5k500.gif" width="49%" /></a></p>
<p>By varying the density and the spring constant the following effects can be observed:</p>
<ul>
<li><strong>Density</strong>: When density is particularly high, the cloth looks squished and the space between layers of cloth is very small, compared to the normal setting. When density is very low, the space between layers of cloth is larger, and the cloth looks weaker to bend.</li>
<li><strong>Spring Constant</strong>: When the spring constant is high, the internal force causes the cloth to better maintain its shape, quite similar to the effect of low density. When the spring constant is low, the cloth looks weaker to bend, and the space between layers of cloth is also smaller.</li>
<li><strong>Total effect</strong>: It is noticeable that as long as the multiplier of density and spring constant remains the same, the cloth will have similar behavior. For example, when the density is 150 and the spring constant is 5000, the cloth behaves similarly to when the density is 1.5 and the spring constant is 5000.</li>
</ul></section><section class="print-page" id="homework4-part5"><h1 id="homework4-part5-part5-shaders">Part5: Shaders</h1>
<h2 id="homework4-part5-task-1-shader-program-overview">Task 1: Shader program overview</h2>
<p>Shader programs execute on the GPU, run in parallel, and are written in GLSL in this assignment. These programs cover several parts of the graphic pipeline. In this assignment, two types of shaders are used: vertex and fragment shaders. The vertex shader is responsible for transforming the vertices of the object, while the fragment shader is responsible for coloring the pixels of the object.</p>
<p>The vertex shader takes the vertex position, normal, and texture coordinates as input and transforms the vertex position to the screen space. It may also change the normal and texture coordinates to achieve different effects, such as bump mapping. The processed information will be passed to the fragment shader for further processing.</p>
<p>The fragment shader takes the interpolated vertex position, normal, and texture coordinates as input and colors the pixel based on the lighting model and texture mapping. It will be automatically linked to the corresponding vertex shader program if there is one. Together, these two shaders form a shader program that renders objects will different materials and lighting effects.</p>
<p>This flowchart shows the general process of the shader program:
<pre class="mermaid"><code>flowchart TB
  A[Application];
  B[Vertex Shader];
  C[Fragment Shader];
  D[Screen Output];
  A --&gt;|Vertex Data| B;
  B --&gt;|Intepolated Data| C;
  C --&gt;|Pixel Color| D;</code></pre></p>
<h2 id="homework4-part5-task-2-bling-phong-shading">Task 2: Bling Phong Shading</h2>
<h3 id="homework4-part5-methodology">Methodology</h3>
<p>In this part, we implement the Bling Phong shading model in the fragment shader. The Bling Phong shading model consists of three components: ambient, diffuse, and specular. </p>
<div class="arithmatex">\[
L = L_\text{ambient} + L_\text{diffuse} + L_\text{specular}
\]</div>
<p>The ambient component is the light that is reflected by the object from the environment. Bling-Phong shading assumes that the ambient light is constant for each part of the object. The ambient component is calculated by multiplying the ambient coefficient, i.e., how much ambient light is reflected, with the ambient light intensity:</p>
<div class="arithmatex">\[
L_\text{ambient} = k_\text{ambient} \cdot I_\text{ambient}
\]</div>
<p>The diffuse component is the diffuse reflection of the object. It is equal to the total irradiance arriving at the surface. Given the radiosity <span class="arithmatex">\(I\)</span> of the light source at unit distance, the radiosity of the light source at distance <span class="arithmatex">\(r\)</span> is <span class="arithmatex">\(I/r^2\)</span>. However, according to Lambert's cosine law, the irradiance is proportional to the cosine of the angle between the light source and the normal of the object. Therefore, the diffuse component is calculated as follows:</p>
<div class="arithmatex">\[
L_\text{diffuse} = k_\text{diffuse} \cdot \left(I / r^2 \right) \cdot \max(0, \vec{L} \cdot \vec{N})
\]</div>
<p>The specular component is the specular reflection of the object. Specular reflection can only be observed within a certain range of angles. In Bling-Phong shading, a half-vector is used to calculate the specular reflection. The half-vector is the vector that bisects the angle between the light source direction <span class="arithmatex">\(\vec{l}\)</span> and the eye direction <span class="arithmatex">\(\vec{v}\)</span>. The angle between the half-vector and the normal vector <span class="arithmatex">\(\vec{n}\)</span> is used to calculate the degradation of the specular reflection:</p>
<div class="arithmatex">\[
cos(\theta)^{p} = \frac{\vec{h} \cdot \vec{n}}{\left\| \vec{h} \right\| \cdot \left\| \vec{n} \right\|}
\]</div>
<p>Where <span class="arithmatex">\(p\)</span> is the shininess coefficient. The specular component is calculated as follows:</p>
<div class="arithmatex">\[
L_\text{specular} = k_\text{specular} \cdot I \cdot \max(0, cos(\theta))^p
\]</div>
<p>By adjusting the ambient, diffuse, and specular coefficients, different materials can be simulated.</p>
<h3 id="homework4-part5-implementation">Implementation</h3>
<p>In our implementation, we manually choose a set of Bling-Phong shading parameters as follows:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#homework4-part5-__codelineno-0-1"></a><span class="w">  </span><span class="c1">// define ka, kd, ks, la, and p</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#homework4-part5-__codelineno-0-2"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">ka</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ambient reflection coefficient</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#homework4-part5-__codelineno-0-3"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">kd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span><span class="w"> </span><span class="c1">// Diffuse reflection coefficient</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#homework4-part5-__codelineno-0-4"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"> </span><span class="c1">// Specular reflection coefficient</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#homework4-part5-__codelineno-0-5"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Ambient light intensity</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#homework4-part5-__codelineno-0-6"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">32.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Shininess</span>
</span></code></pre></div>
<p>First, the output is initialized as a zero vector and the ambient, diffuse and specular component is added, respectively:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#homework4-part5-__codelineno-1-1"></a><span class="w">  </span><span class="n">out_color</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#homework4-part5-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#homework4-part5-__codelineno-1-3"></a><span class="w">  </span><span class="c1">// ambient reflection</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#homework4-part5-__codelineno-1-4"></a><span class="w">  </span><span class="n">out_color</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ka</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">la</span><span class="p">;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#homework4-part5-__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#homework4-part5-__codelineno-1-6"></a><span class="w">  </span><span class="c1">// diffuse reflection</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#homework4-part5-__codelineno-1-7"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">u_light_pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_position</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#homework4-part5-__codelineno-1-8"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">u_light_pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_position</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#homework4-part5-__codelineno-1-9"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">v_normal</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#homework4-part5-__codelineno-1-10"></a><span class="w">  </span><span class="n">out_color</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">kd</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_light_intensity</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#homework4-part5-__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#homework4-part5-__codelineno-1-12"></a><span class="w">  </span><span class="c1">// specular reflection</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#homework4-part5-__codelineno-1-13"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">u_cam_pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v_position</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#homework4-part5-__codelineno-1-14"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#homework4-part5-__codelineno-1-15"></a><span class="w">  </span><span class="n">out_color</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_light_intensity</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#homework4-part5-__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#homework4-part5-__codelineno-1-17"></a><span class="w">  </span><span class="n">out_color</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="homework4-part5-results">Results</h3>
<p>The following images show the result of Bling Phong shading with ambient only, diffuse only, specular only, and all components combined.</p>
<p><strong>Ambient Only and Diffuse Only</strong></p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_phongambient.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Ambient Only" src="../images/hw4/part5/hw4part5_phongambient.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part5/hw4part5_diffuse.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Diffuse Only" src="../images/hw4/part5/hw4part5_diffuse.png" width="49%" /></a></p>
<p><strong>Specular Only and All Components</strong></p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_specular.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Specular Only" src="../images/hw4/part5/hw4part5_specular.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part5/hw4part5_phongentire.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="All Components" src="../images/hw4/part5/hw4part5_phongentire.png" width="49%" /></a></p>
<h2 id="homework4-part5-task-3-texture-mapping">Task 3: Texture Mapping</h2>
<p>In this part, we implement texture mapping in the fragment shader:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#homework4-part5-__codelineno-2-1"></a><span class="w">  </span><span class="n">out_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">u_texture_1</span><span class="p">,</span><span class="w"> </span><span class="n">v_uv</span><span class="p">);</span>
</span></code></pre></div>
<p>The texture is replaced by an image downloaded from Berkeley Reddit:</p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_texture_1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Texture" src="../images/hw4/part5/hw4part5_texture_1.png" width="49%" /></a></p>
<p>The following image shows the result of texture mapping:</p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_texture.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Texture Mapping" src="../images/hw4/part5/hw4part5_texture.png" /></a></p>
<h2 id="homework4-part5-task-4-bump-mapping-and-displacement-mapping">Task 4: Bump Mapping and Displacement Mapping</h2>
<h3 id="homework4-part5-implementation-of-bump-mapping">Implementation of Bump Mapping</h3>
<p>In this section, we implemented Bump Mapping in the fragment shader by sampling a chosen height map. </p>
<p>First, a local space disturbance vector is created by sampling the height map:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#homework4-part5-__codelineno-3-1"></a><span class="w">  </span><span class="c1">// calculate dU, dV</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#homework4-part5-__codelineno-3-2"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">dU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">vec2</span><span class="p">(</span><span class="n">v_uv</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">u_texture_2_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">v_uv</span><span class="p">.</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="n">v_uv</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_normal_scaling</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_height_scaling</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#homework4-part5-__codelineno-3-3"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">dV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">vec2</span><span class="p">(</span><span class="n">v_uv</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">v_uv</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">u_texture_2_size</span><span class="p">.</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="n">v_uv</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_normal_scaling</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_height_scaling</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#homework4-part5-__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#homework4-part5-__codelineno-3-5"></a><span class="w">  </span><span class="c1">// calculate local space normal</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#homework4-part5-__codelineno-3-6"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">n0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">dU</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">dV</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
</span></code></pre></div>
<p>Then, a <span class="arithmatex">\(TBN\)</span> matrix is created ahead of time to convert local space vectors to object space:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#homework4-part5-__codelineno-4-1"></a><span class="w">  </span><span class="c1">// calculate local space tangent</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#homework4-part5-__codelineno-4-2"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#homework4-part5-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#homework4-part5-__codelineno-4-4"></a><span class="w">  </span><span class="c1">// calculate local space bitangent</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#homework4-part5-__codelineno-4-5"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_normal</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#homework4-part5-__codelineno-4-6"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#homework4-part5-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#homework4-part5-__codelineno-4-8"></a><span class="w">  </span><span class="c1">// calculate TBN matrix</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#homework4-part5-__codelineno-4-9"></a><span class="w">  </span><span class="n">mat3</span><span class="w"> </span><span class="n">TBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mat3</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</span></code></pre></div>
<p>Finally, the normal is transformed from local space to object space:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#homework4-part5-__codelineno-5-1"></a><span class="w">  </span><span class="c1">// calculate normal in world space</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#homework4-part5-__codelineno-5-2"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">nd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n0</span><span class="p">;</span>
</span></code></pre></div>
<p>This normal is then used in the Bling Phong shading model to calculate the final color.</p>
<h3 id="homework4-part5-implementation-of-displacement-mapping">Implementation of Displacement Mapping</h3>
<p>Different from Bump Mapping, in displacement mapping the coordinates of the input vector is also modified in the vertex shader:</p>
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#homework4-part5-__codelineno-6-1"></a><span class="w">  </span><span class="n">v_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">in_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="n">v_uv</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_height_scaling</span><span class="p">;</span>
</span></code></pre></div>
<p>Where <span class="arithmatex">\(h(v_uv)\)</span> is the height map function. The vertex position is moved along the normal direction by the height map value.</p>
<h3 id="homework4-part5-results_1">Results</h3>
<p>A height map from Wikipedia is used in this part:</p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_texture_2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Height Map" src="../images/hw4/part5/hw4part5_texture_2.png" width="49%" /></a></p>
<p>The following images show the result of bump mapping and displacement mapping:</p>
<p><strong>Bump Mapping with Coarseness 16 and 128</strong></p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_bump16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Bump Mapping Coarseness 16" src="../images/hw4/part5/hw4part5_bump16.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part5/hw4part5_bump128.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Bump Mapping Coarseness 128" src="../images/hw4/part5/hw4part5_bump128.png" width="49%" /></a></p>
<p><strong>Displacement Mapping with Coarseness 16 and 128</strong></p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_displacement16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Displacement Mapping Coarseness 16" src="../images/hw4/part5/hw4part5_displacement16.png" width="49%" /></a>
<a class="glightbox" href="../images/hw4/part5/hw4part5_displacement128.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Displacement Mapping Coarseness 128" src="../images/hw4/part5/hw4part5_displacement128.png" width="49%" /></a></p>
<p>According to the figures, the sphere with bump mapping has a smooth round shape despite the rough surface caused by the height map. Different from bump mapping, the sphere with displacement mapping has a rough surface and the shape is distorted. This is because the vertex position is modified in the vertex shader, which changes the shape of the object.</p>
<p>Coarseness also affects the result of bump mapping and displacement mapping. The results with less coarseness have more concentrated and brighter specular reflections, while the highlights are more diffused with more coarseness.</p>
<h2 id="homework4-part5-task-5-environment-mapping">Task 5: Environment Mapping</h2>
<h3 id="homework4-part5-methodology-and-implementation">Methodology and Implementation</h3>
<p>In this part, we simulate mirror reflection by casting a ray from the camera position to the object and then reflecting it to the environment map.</p>
<p>Given the camera position and fragment position, the eye ray direction is calculated as follows:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#homework4-part5-__codelineno-7-1"></a><span class="w">  </span><span class="c1">// Calculate the eye ray direction</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#homework4-part5-__codelineno-7-2"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">eye_ray_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">v_position</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u_cam_pos</span><span class="p">);</span>
</span></code></pre></div></p>
<p>The reflected ray direction is calculated with the help of object normal:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#homework4-part5-__codelineno-8-1"></a><span class="w">  </span><span class="c1">// Calculate the reflection direction</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#homework4-part5-__codelineno-8-2"></a><span class="w">  </span><span class="n">vec3</span><span class="w"> </span><span class="n">reflection_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="n">eye_ray_dir</span><span class="p">,</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">v_normal</span><span class="p">.</span><span class="n">xyz</span><span class="p">));</span>
</span></code></pre></div></p>
<p>Finally, the environmental map is sampled with the same technique in previous tasks:
<div class="language-cpp highlight"><span class="filename">C++</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#homework4-part5-__codelineno-9-1"></a><span class="w">  </span><span class="c1">// sample the environment map</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#homework4-part5-__codelineno-9-2"></a><span class="w">  </span><span class="n">out_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">u_texture_cubemap</span><span class="p">,</span><span class="w"> </span><span class="n">reflection_dir</span><span class="p">);</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#homework4-part5-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#homework4-part5-__codelineno-9-4"></a><span class="w">  </span><span class="n">out_color</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div></p>
<h3 id="homework4-part5-results_2">Results</h3>
<p>The image below shows the result of environment mapping. The object is a sphere with a mirror reflection. The environment map is a skybox with a mountain view.</p>
<p><a class="glightbox" href="../images/hw4/part5/hw4part5_mirror.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Environment Mapping" src="../images/hw4/part5/hw4part5_mirror.png" /></a></p></section><h1 class='nav-section-title-end'>Ended: Homework4</h1></div>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "/", "features": ["header.autohide", "navigation.tabs"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>